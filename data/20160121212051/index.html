<!DOCTYPE html>
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8"><title>入力画面をつくろう</title><meta content="authenticity_token" name="csrf-param">
<meta content="Y2UzkG5GQl5jzIBq3nOdxAEomQen5uuix05BO4pPfYw=" name="csrf-token"><link href="favicon.ico" rel="icon" sizes="16x16 32x32 48x48 128x128 256x256">
<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head>
<body class="ng-scope" ng-app="techMaster"><div class="navbar main_header navbar-fixed-top navbar-default" role="navigation"><div class="container"><div class="navbar-header"><button aria-controls="navbar" aria-expanded="false" class="navbar-toggle collapsed" data-target="#navbar" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="http://master.tech-camp.in/" target="_self"><img src="logo.png"></a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav navbar-right"><li class="text">終了まであと<i class="limit_time">10</i>日</li><li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" id="profileDropdown" style="padding: 10px 7px; cursor: pointer;"><img class="nav-proimg" src="noimage.png">大宅 誠人</a><ul class="dropdown-menu" id="profileDropdown"><li><a class="mypage-link" href="http://master.tech-camp.in/users/mypage" target="_self">マイページを見る</a></li><li><a href="http://master.tech-camp.in/users" target="_self">十三期生一覧</a></li></ul></li></ul></div></div></div><div class=""></div><!-- ngView:  --><div class="ng-scope" ng-view=""><curriculum style="display: inline;" class="ng-scope">
  <div class="container" id="curriculum">
    <div class="row curriculum-inner">
      <div class="col-lg-12 main" ng-init="init()">
        <div ng-show="curriculum.image" class="page-header page" style="background-image: url('main_visual.jpg');">
  <h1 class="ng-binding">
    Railsアプリケーション開発1 第5章<small class="ng-binding">〜入力画面をつくろう〜</small>
  </h1>
  <!-- ngIf: curriculum.image.description.length --><div style="" class="flickr_attr ng-binding ng-scope" ng-if="curriculum.image.description.length">
    香港の観光地となっている山で、夜景の名所として知られる。山頂は通信施設などに占められており一般人は入ることができない。しかしその周囲の山並みにある公園や高級住宅地など、普通「ザ・ピーク」として知られる部分である。<a class="ng-binding" href="https://www.flickr.com/photos/richardfisher/3396057654/" target="_top">Richard Fisher - Hong Kong Island from Victoria Peak</a>
  </div><!-- end ngIf: curriculum.image.description.length -->
</div>
      </div>
      <div class="col-md-9 col-sm-12" id="curriculumMainContainer">
        <div class="curriculum_content">
          <div class="curriculum_text ng-scope" compile-progress-notifier="willCompiledCurriculumText" ng-controller="CurriculumHintController"><h1 id="1" class="ng-scope">学習の目標</h1>

<p class="ng-scope">投稿画面を作成し、投稿した内容を投稿一覧に反映させましょう</p>

<h1 id="2" class="ng-scope">学習キーワード</h1>

<p class="ng-scope">・フォーム<br><br>
・モデル<br><br>
・getリクエスト<br><br>
・postリクエスト<br></p>

<h1 id="3" class="ng-scope">投稿画面を作成する</h1>

<p class="ng-scope">前章までの作業ですべてのツイートが一覧表示されるようになりました。そこで、この章ではツイートの投稿画面を新しく作成し、新しいツイートを投稿できるようにします。</p>

<h2 id="4" class="ng-scope">ルーティングを設定しよう</h2>

<p class="ng-scope">今回の作業ではツイートの投稿画面を作成し投稿内容をデータベースに保存します。そのため、まずはルーティングを設定していきます。ツイートの入力画面は一覧の表示とは別のページを用意するので、以下のようにルーティングを設定しましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> routes.rbを以下のように編集してください</h3>

<ul class="filetree ng-scope">
  <li class="t-folder"> config
    <ul>
      <li class="t-file">routes.rb</li>
    </ul>
  </li>
</ul>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">config/routes.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
    <span class="n">get</span>   <span class="s1">'tweets'</span>      <span class="o">=&gt;</span>  <span class="s1">'tweets#index'</span>     <span class="c1">#ツイート一覧画面</span>
    <span class="n">get</span>   <span class="s1">'tweets/new'</span>  <span class="o">=&gt;</span>  <span class="s1">'tweets#new'</span>       <span class="c1">#ツイート投稿画面</span>
  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="321" action="http://master.tech-camp.in/curriculums/15#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-461" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-461" name="check-461" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">投稿画面のルーティングを定義することができた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope"><code>routes.rb</code>の3行目に注目してください。ルーティングは前半部分がパス、後半部分がコントローラーとアクションを示しています。<br>
つまり、新たに「get 'tweets/new'  =&gt;  'tweets#new’」とルーティングを追記したことによって、「localhost:3000/tweets/new」にアクセスした時にtweetsコントローラーのnewアクションが動くことを示しています。</p>

<p class="ng-scope">新しいページを追加する際には、単にビューファイルを用意するだけでなく、新規ページのためのルーティングも定義する必要があります。</p>

<h2 id="5" class="ng-scope">コントローラーを作成しよう</h2>

<p class="ng-scope">ルーティングの設定の次は、コントローラーの設定が必要です。ツイートの一覧画面を作成した際には、初めてのページ作成だったので新しくコントローラーを作成する必要がありましたが、今回はすでにtweets_controllerがあるのでその中に新しくアクションを定義していきたいと思います。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> tweets_controller.rbを以下のように編集してください</h3>

<ul class="filetree ng-scope">
  <li class="t-folder"> app
    <ul>
      <li class="t-folder"> controllers
        <ul>
          <li class="t-file"> tweets_controller.rb</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controlers/tweets_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">TweetsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@tweets</span> <span class="o">=</span> <span class="no">Tweet</span><span class="o">.</span><span class="n">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
    <span class="k">end</span>

  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="322" action="http://master.tech-camp.in/curriculums/15#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-462" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-462" name="check-462" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">tweets_controllerにnewアクションを定義することが出来た</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope">投稿画面ではモデルを利用した情報の表示などは行わないので、単にnewアクションを定義するだけで構いません。</p>

<h2 id="6" class="ng-scope">ビューファイルを作成しよう</h2>

<p class="ng-scope">最後に投稿画面のビューファイルを作成します。投稿画面ではツイートの投稿を行ないます。そのため、単に情報を表示するページではなく、フォームによる情報の送信機能をつける必要があります。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_322"></i> フォーム</h3>

<p class="ng-scope">フォームとは、ユーザーが情報を入力し、その情報をサーバーに送信するためのものです。HTMLのコードの中にform要素を作成し、その中にフォームを構成する部品のinput要素やtextarea要素を配置することで作成することができます。</p>

<h3 class="ng-scope">【例】</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">sample.html</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/test"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h3&gt;</span>
        サンプルフォーム
      <span class="nt">&lt;/h3&gt;</span>
      <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;label&gt;</span>Name:<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">placeholder=</span><span class="s">"Name"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"name"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;label&gt;</span>E-mail:<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">placeholder=</span><span class="s">"E-mail"</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">id=</span><span class="s">"mail"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;label&gt;</span>Message:<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;textarea</span> <span class="na">placeholder=</span><span class="s">"Message"</span> <span class="na">id=</span><span class="s">"message"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><img src="001.png" alt="フォーム"></p>

<h3 class="ng-scope">
<i class="icon information" id="term_323"></i> form_tag</h3>

<p class="ng-scope">ビューにHTMLのformタグを作成することで、ビューから情報を送信できることは説明しました。しかし、Railsではセキュリティの観点から、HTMLのformタグだけで作成したフォームを使用することは推奨されません。通常、Railsでフォームから情報を送信するためには<code>form_tag</code>を始めとするヘルパーメソッドを使用します。似たメソッドとして<code>form_for</code>もありますが、こちらは後ほど解説します。</p>

<p class="ng-scope">例１：</p>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">sample.html</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/test"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"name"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">例２：<br><br>
例１のフォームを<code>form_tag</code>を使用して記述したものです</p>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">sample.html</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form_tag</span><span class="p">(</span><span class="s1">'/test'</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:post</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"name"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">通常は例１のように記述することでフォームを作成することが出来ます。例２では、例１のフォームを<code>form_tag</code>を使用して記述したものです。<code>action</code>属性は<code>'アクション名'</code>、<code>method</code>属性は<code>method: :メソッド名</code>と記述することで、同様の記述を行なうことができます。また、フォームの場合はフォームの終了時に<code>&lt;/form&gt;</code>で囲んでいましたが、<code>form_tag</code>の場合は<code>&lt;% end %&gt;</code>で囲みます。</p>

<p class="ng-scope"><code>action</code>属性や<code>method</code>属性についてはあとで説明をしますので、今は気にしなくて大丈夫です。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> 「new.html.erb」というファイルを以下のディレクトリに作成してください</h3>

<ul class="filetree ng-scope">
  <li class="t-folder"> app
    <ul>
      <li class="t-folder"> views
        <ul>
          <li class="t-folder"> tweets
            <ul>
              <li class="t-file"> new.html.erb</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 class="ng-scope">
<i class="icon pen"></i> new.html.erbを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/tweets/new.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"contents row"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form_tag</span><span class="p">(</span><span class="s1">'/tweets'</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:post</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;h3&gt;</span>
        投稿する
      <span class="nt">&lt;/h3&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">placeholder=</span><span class="s">"Nickname"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">placeholder=</span><span class="s">"Image Url"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"image"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;textarea</span> <span class="na">cols=</span><span class="s">"30"</span> <span class="na">name=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"text"</span> <span class="na">rows=</span><span class="s">"10"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"SENT"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><i class="icon attention"></i>  このソースコードは長いので、打ち間違いを防ぐためにコピー&amp;ペーストをしてもかまいません</p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="323" action="http://master.tech-camp.in/curriculums/15#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-463" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-463" name="check-463" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">投稿画面のビューファイルを正しく編集することができた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope">以上の作業で投稿画面を作成することができました。それでは実際に確認してみましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> ブラウザで下記のURLにアクセスしてください</h3>

<h4 class="ng-scope"><a href="http://localhost:3000/tweets/new">http://localhost:3000/tweets/new</a></h4>

<p class="ng-scope">※テストサーバーを立ち上げていない場合にはもう一度「rails s」コマンドでサーバーを起動する必要があります。</p>

<p class="ng-scope"><img src="002.png" alt="投稿画面"></p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="324" action="http://master.tech-camp.in/curriculums/15#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-464" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-464" name="check-464" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">投稿画面を正しく作成することができた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="325" action="http://master.tech-camp.in/curriculums/15#">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-465" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-465" name="check-465" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">ウェブページからサーバーに情報を送信するにはフォームを利用する</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-466" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-466" name="check-466" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">Railsでフォームを利用する際にはform_tagを使用する</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h1 id="7" class="ng-scope">投稿機能を実装する</h1>

<p class="ng-scope">投稿画面の作成が終わったので、この章では投稿機能を実装していきたいと思います。入力内容に応じてツイートを新規作成できるように実装していきます。</p>

<h2 id="8" class="ng-scope">ルーティングを設定しよう</h2>

<p class="ng-scope">投稿機能を実装する際にもまずはルーティングを設定します。先ほど編集したビューファイルの２行目の<code>form_tag</code>以降の部分に注目してください。</p>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/tweets/new.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="cp">&lt;%=</span> <span class="n">form_tag</span><span class="p">(</span><span class="s1">'/tweets'</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:post</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;h3&gt;</span>
      投稿する
    <span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">placeholder=</span><span class="s">"Nickname"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">placeholder=</span><span class="s">"Image Url"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"image"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;textarea</span> <span class="na">cols=</span><span class="s">"30"</span> <span class="na">name=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"text"</span> <span class="na">rows=</span><span class="s">"10"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"SENT"</span><span class="nt">&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">最初の<code>'/tweets'</code>の部分は<code>action</code>属性を示しています。これは、フォームに入力された情報がどこに送信されるのかを表しています。<code>method:</code>の部分は入力された情報をどのHTTPメソッドで送信するのかを指定しています。つまり、これは<code>/tweets</code>に<code>post</code>メソッドでフォームに入力された情報を送信することを示しています。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_324"></i> HTTPメソッド</h3>

<p class="ng-scope">以前に、ウェブサイトを閲覧する際にPCからサーバーにリクエストが送られ、それに対してサーバーからレスポンスが返ってくる仕組みについて説明しました。このリクエストにはその目的によっていくつかの種類（メソッドといいます）に分けられます。</p>

<table class="ng-scope">
<thead>
<tr>
<th style="text-align: left;">HTTPメソッド　</th>
<th style="text-align: left;">役割</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">get　　　　　　　　</td>
<td style="text-align: left;">ブラウザからサーバーへ、「サーバーからブラウザに固有の情報を返す」ように命令する。単にウェブサイトを閲覧する際にはこのメソッドが利用されている。</td>
</tr>
<tr>
<td style="text-align: left;">post</td>
<td style="text-align: left;">ブラウザからサーバーに「ある情報」を送信するためのもの。情報の登録などの際、サーバーに情報を送信するために利用される。</td>
</tr>
</tbody>
</table>

<h3 class="ng-scope">
<i class="icon pen"></i> routes.rbを以下のように編集してください</h3>

<ul class="filetree ng-scope">
  <li class="t-folder"> config
    <ul>
      <li class="t-file">routes.rb</li>
    </ul>
  </li>
</ul>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">config/routes.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
    <span class="n">get</span>   <span class="s1">'tweets'</span>      <span class="o">=&gt;</span>  <span class="s1">'tweets#index'</span>     <span class="c1">#ツイート一覧画面</span>
    <span class="n">get</span>   <span class="s1">'tweets/new'</span>  <span class="o">=&gt;</span>  <span class="s1">'tweets#new'</span>       <span class="c1">#ツイート投稿画面</span>
    <span class="n">post</span>  <span class="s1">'tweets'</span>      <span class="o">=&gt;</span>  <span class="s1">'tweets#create'</span>    <span class="c1">#ツイート投稿機能</span>
  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="326" action="http://master.tech-camp.in/curriculums/15#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-467" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-467" name="check-467" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">ツイートを投稿するための新しいルーティングを設定できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope">編集した<code>routes.rb</code>の２行目と４行目の最初の部分の違いに注目してください。２行目の部分は<code>get</code>、４行目の部分は<code>post</code>となっています。これはHTTPリクエストの違いを表しています。今回の作業ではツイートの投稿機能を実装します。ツイートは入力画面から情報としてサーバーに送信されるので、postメソッドでルーティングを設定しました。</p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="327" action="http://master.tech-camp.in/curriculums/15#">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-468" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-468" name="check-468" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">情報を送信する際にはpostメソッドを利用する</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 id="9" class="ng-scope">コントローラーを編集しよう</h2>

<p class="ng-scope">ルーティングを設定した際に一覧画面を作成した時と比較して、もう一つ違いがありました。<code>routes.rb</code>の２行目と４行目の最後の部分の違いに注目してください。</p>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">config/routes.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
    <span class="n">get</span>   <span class="s1">'tweets'</span>      <span class="o">=&gt;</span>  <span class="s1">'tweets#index'</span>     <span class="c1">#ツイート一覧画面</span>
    <span class="n">get</span>   <span class="s1">'tweets/new'</span>  <span class="o">=&gt;</span>  <span class="s1">'tweets#new'</span>       <span class="c1">#ツイート投稿画面</span>
    <span class="n">post</span>  <span class="s1">'tweets'</span>      <span class="o">=&gt;</span>  <span class="s1">'tweets#create'</span>    <span class="c1">#ツイート投稿機能</span>
  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">２行目の部分は<code>index</code>、４行目の部分は<code>create</code>となっています。ルーティングにおいて、右側の#以前の部分はコントローラー名、#以後はそのコントローラーのアクション名を指しています。つまり今回は<code>create</code>アクションを新しく作成して、投稿機能を実装します。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> tweets_controller.rbを以下のように編集してください</h3>

<ul class="filetree ng-scope">
  <li class="t-folder"> app
    <ul>
      <li class="t-folder"> controllers
        <ul>
          <li class="t-file"> tweets_controller.rb</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controlers/tweets_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">TweetsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@tweets</span> <span class="o">=</span> <span class="no">Tweet</span><span class="o">.</span><span class="n">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
    <span class="k">end</span>

  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="328" action="http://master.tech-camp.in/curriculums/15#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-469" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-469" name="check-469" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">createメソッドを作成することができた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope">上記の実装でcreateアクションを作成することができました。しかし、createアクションでは投稿画面でフォームから送信された情報を元にしてツイートを作成する必要があるため、さらに編集を加えていきます。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_325"></i> パラメーター</h3>

<p class="ng-scope">HTTPリクエストをサーバーに送信する際に、「パラメーター」と呼ばれる情報を付加してリクエストを送信することが出来ます。ツイートの投稿の場合だと、ツイートの本文、画像のURL、ニックネームなどがパラメーターとして付加され、リクエストが送信されます。</p>

<p class="ng-scope">サーバーにパラメーターが送信される際には、キーと呼ばれる情報と一緒に送信されます。キーと一緒に送信するのは、複数の情報をパラメーターとして送信した場合、どのデータがどのパラメーターかを判別するためです。先ほど編集したビューファイルを確認しましょう。</p>

<h3 class="ng-scope">【例】</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/tweets/new.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"contents row"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form_tag</span><span class="p">(</span><span class="s1">'/tweets'</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:post</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;h3&gt;</span>
        投稿する
      <span class="nt">&lt;/h3&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">placeholder=</span><span class="s">"Nickname"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">placeholder=</span><span class="s">"Image Url"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"image"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;textarea</span> <span class="na">cols=</span><span class="s">"30"</span> <span class="na">name=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"text"</span> <span class="na">rows=</span><span class="s">"10"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"SENT"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">6〜8行目に注目してください。input要素とtextarea要素の中に<code>name</code>と呼ばれる属性が存在しています。これはパラメーターのキーの名前を示しています。つまり、ニックネームとして入力された情報は<code>name</code>、画像のURLは<code>image</code>、ツイートの本文は<code>text</code>というキーと一緒に送信されているということになります。</p>

<h3 class="ng-scope">【例】</h3>

<p class="ng-scope"><img src="003.png" alt="テスト投稿"></p>

<table class="ng-scope">
<thead>
<tr>
<th style="text-align: left;">キー　</th>
<th style="text-align: left;">バリュー</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">name　　　　　　　</td>
<td style="text-align: left;">田村隆一</td>
</tr>
<tr>
<td style="text-align: left;">image</td>
<td style="text-align: left;"><a href="http://travel.kmusiclife.com/wp-content/uploads/2013/08/DSC_2790.jpg">http://travel.kmusiclife.com/wp-content/uploads/2013/08/DSC_2790.jpg</a></td>
</tr>
<tr>
<td style="text-align: left;">text</td>
<td style="text-align: left;">「帰途」 言葉なんかおぼえるんじゃなかった 言葉のない世界 意味が意味にならない世界に生きていたら どんなによかったか</td>
</tr>
</tbody>
</table>

<h3 class="ng-scope">
<i class="icon information" id="term_326"></i> params</h3>

<p class="ng-scope">ビューでフォームに入力された情報は、コントローラーにキーと一緒にパラメーターとして送られます。このパラメーターは<code>params</code>というメソッドを使うことで取得することが出来ます。<code>params</code>メソッドを使用する際には<code>params[:キー名]</code>という形で使用することが出来ます。</p>

<h3 class="ng-scope">【例】</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controlers/test_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">TestController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

    <span class="k">def</span> <span class="nf">test</span>
      <span class="nb">name</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span>
      <span class="n">image</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:image</span><span class="o">]</span>
      <span class="n">text</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:text</span><span class="o">]</span>
    <span class="k">end</span>

  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<table class="ng-scope">
<thead>
<tr>
<th style="text-align: left;">controller内での変数</th>
<th style="text-align: left;">内容</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">params[:name]　　　　　　　</td>
<td style="text-align: left;">田村隆一</td>
</tr>
<tr>
<td style="text-align: left;">params[:image]</td>
<td style="text-align: left;"><a href="http://travel.kmusiclife.com/wp-content/uploads/2013/08/DSC_2790.jpg">http://travel.kmusiclife.com/wp-content/uploads/2013/08/DSC_2790.jpg</a></td>
</tr>
<tr>
<td style="text-align: left;">params[:text]</td>
<td style="text-align: left;">「帰途」 言葉なんかおぼえるんじゃなかった 言葉のない世界 意味が意味にならない世界に生きていたら どんなによかったか</td>
</tr>
</tbody>
</table>

<p class="ng-scope">さて、<code>create</code>メソッドは、利用したクラスが関連しているテーブルに新たにレコードを作成するメソッドです。その際の引数は、以下のように<strong>(保存するカラム名: 保存したい値, ・・・)</strong>とするのでした。</p>

<h3 class="ng-scope">【例】Tweetクラスにレコードを保存する</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controlers/tweets_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="no">Tweet</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"田村隆一"</span><span class="p">,</span> <span class="ss">image</span><span class="p">:</span> <span class="s2">"http://travel.kmusiclife.com/wp-content/uploads/2013/08/DSC_2790.jpg"</span><span class="p">,</span> <span class="ss">text</span><span class="p">:</span> <span class="s2">"「帰途」 言葉なんか・・・"</span><span class="p">)</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">上記の例では保存したい値を直接書き込んでいますが、毎回この部分を手動で変更するわけにもいきません。パラメーターを受け取っている<code>params</code>から適切なキーを取り出すことで、ユーザーが入力する値をテーブルに保存していけるのです。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> tweets_controller.rbを以下のように編集してください</h3>

<ul class="filetree ng-scope">
  <li class="t-folder"> app
    <ul>
      <li class="t-folder"> controllers
        <ul>
          <li class="t-file"> tweets_controller.rb</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controlers/tweets_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">TweetsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@tweets</span> <span class="o">=</span> <span class="no">Tweet</span><span class="o">.</span><span class="n">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
<span class="hll">      <span class="no">Tweet</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span><span class="p">,</span> <span class="ss">image</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:image</span><span class="o">]</span><span class="p">,</span> <span class="ss">text</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:text</span><span class="o">]</span><span class="p">)</span>
</span>    <span class="k">end</span>

  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="329" action="http://master.tech-camp.in/curriculums/15#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-470" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-470" name="check-470" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">createメソッドとパラメーターを設定することができた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope">以上でパラメーターを使用してツイートを新しく作成するための実装が終了しました。しかし、現状ではパラメーターにどんな情報が含まれていても受け取れる状態になっているため、セキュリティの観点から好ましくない状態にあります。そのため、ストロングパラメーターというものを設定していきたいと思います。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_327"></i> ストロングパラメーター</h3>

<p class="ng-scope">ストロングパラメーターとは、<strong>指定したキーを持つパラメーターのみを受け取るようにするもの</strong>です。もし仮に悪意のあるユーザーが、不正な情報を送信しようとしたときに、ストロングパラメーターを設定しておくと、不正な情報を受け取らずにすみます。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_328"></i> privateメソッド</h3>

<p class="ng-scope">classの内部でprivateとソースコードに書くと、それ以降に定義したメソッドは<strong>classの外部から呼び出せなくなります。</strong></p>

<p class="ng-scope">このようにするメリットは以下の2つです。</p>

<p class="ng-scope"><strong>1.外部から呼ばれたら困るメソッドを守ることができる</strong></p>

<ul class="ng-scope">
<li>メソッドの中には、外部から呼び出されてしまうとエラーを起こすメソッドも存在し得ます。そんな事態を事前に防ぐことができます。</li>
</ul>

<p class="ng-scope"><strong>2.可読性</strong></p>

<ul class="ng-scope">
<li>外部から呼び出されるメソッドを探すときに、private以下の部分は目を通さなくて良くなります。</li>
</ul>

<h3 class="ng-scope">【例】</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controlers/test_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">TestController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

    <span class="k">def</span> <span class="nf">test</span>
      <span class="n">parameter</span> <span class="o">=</span> <span class="n">test_params</span>
    <span class="k">end</span>

    <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">test_params</span>
      <span class="n">params</span><span class="o">.</span><span class="n">permit</span><span class="p">(:</span><span class="err">キー名</span><span class="p">,</span> <span class="p">:</span><span class="err">キー名</span><span class="p">)</span>
    <span class="k">end</span>

  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">ストロングパラメーターを設定する場合、コントローラーの中に「ストロングパラメーター名_params」というメソッドを作成します。この名前はそのパラメーターに適した任意のものであって構いません。メソッドの中には<code>params.permit</code>と記述し、そのあとに受取ることを許可するパラメーターのキー名を記述します。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> tweets_controller.rbを以下のように編集してください</h3>

<ul class="filetree ng-scope">
  <li class="t-folder"> app
    <ul>
      <li class="t-folder"> controllers
        <ul>
          <li class="t-file"> tweets_controller.rb</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controlers/tweets_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">TweetsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@tweets</span> <span class="o">=</span> <span class="no">Tweet</span><span class="o">.</span><span class="n">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
<span class="hll">      <span class="no">Tweet</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">tweet_params</span><span class="p">)</span>
</span>    <span class="k">end</span>

<span class="hll">    <span class="kp">private</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">tweet_params</span>
</span><span class="hll">      <span class="n">params</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:image</span><span class="p">,</span> <span class="ss">:text</span><span class="p">)</span>
</span><span class="hll">    <span class="k">end</span>
</span>
  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">以上のコードの処理の流れを説明します。</p>

<p class="ng-scope">10行目の<code>create</code>アクションがリクエストされると、11行目の処理が行われます。tweetsテーブルにレコードを作成する<code>create</code>メソッドの引数が<code>(tweet_params)</code>となっているので、15行目の<code>tweet_params</code>メソッドが呼び出されます。</p>

<p class="ng-scope">ということは、この部分に入る値は<code>tweet_params</code>メソッドの返り値、ということになりますね。</p>

<p class="ng-scope"><code>tweet_params</code>メソッドの返り値を考えてみましょう。メソッドの返り値は、そのメソッドの中で最後に実行されている式の値でした。なので今回は、tweet_paramsの中での最後の式である<strong>16行目の式の値が<code>tweet_params</code>メソッド自体の返り値となること</strong>がわかります。</p>

<p class="ng-scope">16行目で利用されている<code>permit</code>というメソッドは、ビューから送られてきた情報のハッシュである<code>params</code>の中から<code>:name</code>, <code>:image</code>, <code>:text</code>というキーとそのバリューのセットだけを残した新たなハッシュを生成しています。この新たなハッシュが、<code>tweet_params</code>メソッドの返り値です。</p>

<p class="ng-scope">つまり、11行目の<code>tweet_params</code>の値は、以下のようになっているということです。</p>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controlers/tweets_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="c1">#バリューは例です</span>
<span class="p">{</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"田村隆一"</span><span class="p">,</span> <span class="ss">image</span><span class="p">:</span> <span class="s2">"http://travel.kmusiclife.com/wp-content/uploads/2013/08/DSC_2790.jpg"</span><span class="p">,</span> <span class="ss">text</span><span class="p">:</span> <span class="s2">"「帰途」 言葉なんか・・・"</span><span class="p">}</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">これは、<code>create</code>メソッドが要求する引数の形と一致しています。<code>tweet_params</code>メソッドで、<code>create</code>メソッドの引数をまとめて管理している、と考えることもできますね。</p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="330" action="http://master.tech-camp.in/curriculums/15#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-471" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-471" name="check-471" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">ストロングパラメーターを設定することができた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope">16行目以降に<code>tweet_params</code>というメソッドが定義してあります。これがストロングパラメーターです。このストロングパラメーターでは<code>name</code>と<code>image</code>と<code>text</code>というキーを持ったパラメーターのみを受け取ります。</p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="331" action="http://master.tech-camp.in/curriculums/15#">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-472" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-472" name="check-472" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">リクエストと一緒にパラメーターと呼ばれる情報が送られる</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-473" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-473" name="check-473" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">パラメーターは必ずキーと一緒に送られる</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-474" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-474" name="check-474" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">ストロングパラメーターを設定すると、指定したキーを持つパラメーターのみを受け取ることが出来る</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 id="10" class="ng-scope">ビューファイルを作成しよう</h2>

<p class="ng-scope">以前にコントローラーのアクションひとつに対して、ひとつのビューが存在することを説明しました。そこで、今回新しく作成した<code>create</code>アクションに対してもビューを設定していきたいと思います。</p>

<p class="ng-scope">今回作成するのは<code>create</code>アクションに対してのビューです。このビューが呼び出されるのは、<code>create</code>アクションで処理が行われたあと、つまりツイートが新規作成された後ということになります。そこでこのビューファイルは投稿が完了したことを知らせるようなビューにしていきたいと思います。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> 「create.html.erb」というファイルを以下のディレクトリに作成してください</h3>

<ul class="filetree ng-scope">
  <li class="t-folder"> app
    <ul>
      <li class="t-folder"> views
        <ul>
          <li class="t-folder"> tweets
            <ul>
              <li class="t-file"> create.html.erb</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 class="ng-scope">
<i class="icon pen"></i> create.html.erbを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/tweets/create.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"contents row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"success"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h3&gt;</span>
        投稿が完了しました。
      <span class="nt">&lt;/h3&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn"</span> <span class="na">href=</span><span class="s">"/tweets"</span><span class="nt">&gt;</span>投稿一覧へ戻る<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><i class="icon attention"></i>  このソースコードは長いので、打ち間違いを防ぐためにコピー&amp;ペーストをしてもかまいません</p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="332" action="http://master.tech-camp.in/curriculums/15#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-475" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-475" name="check-475" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">投稿確認画面のビューファイルを作成することができた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h1 id="11" class="ng-scope">動作確認を行なう</h1>

<p class="ng-scope">以上の作業でPicTweetを作成することが出来ました。そこでこれから実際にアプリケーションを動かして、動作の確認を行なっていきたいと思います。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> ブラウザで下記のURLにアクセスしてください</h3>

<h4 class="ng-scope"><a href="http://localhost:3000/tweets">http://localhost:3000/tweets</a></h4>

<p class="ng-scope">※テストサーバーを立ち上げていない場合にはもう一度「rails s」コマンドでサーバーを起動する必要があります。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> 実際に投稿を行なってください</h3>

<h3 class="ng-scope">【例】</h3>

<p class="ng-scope"><img src="009.png" alt="動作確認1"></p>

<p class="ng-scope"><img src="007.png" alt="動作確認2"></p>

<p class="ng-scope"><i class="icon attention"></i> 投稿したツイートは画面の一番下にあります。</p>

<p class="ng-scope"><img src="010.png" alt="動作確認3"></p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="333" action="http://master.tech-camp.in/curriculums/15#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-476" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-476" name="check-476" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">ツイートを投稿することができた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 id="12" class="ng-scope">
<i class="icon world"></i> コラム：卒業生のサービス紹介③</h2>

<p class="ng-scope">こちらのコラムでは、TECH::CAMPを卒業した方が実際に運営しているサービスをご紹介します。ご覧いただければ、TECH::CAMPで学習した知識でどんなことができるかがわかるはずです。これからオリジナルのアプリケーションを作成したい方は、ぜひ参考にしてみてください！</p>

<h4 class="ng-scope">読書の学びを共有しよう</h4>

<p class="ng-scope"><img src="ec23292d35341f38b23e46b9ce5ec0a9.png" alt="https://tech-master.s3.amazonaws.com/uploads/curriculums//ec23292d35341f38b23e46b9ce5ec0a9.png"></p>

<h5 class="ng-scope">サービス名：<a href="https://www.bksrap.net/">Bksrap</a>
</h5>

<h5 class="ng-scope">製作者/期：小笠原泰樹さん/9期1ヶ月コース</h5>

<h5 class="ng-scope">製作期間：1ヶ月</h5>

<p class="ng-scope"><a href="https://www.bksrap.net/">Bksrap</a>は、自分の読んだ本の感想を自分宛てに記録するサービスです。ある本に対して1つの感想を残すのではなく、スポットで感じたことをその文章のページと共に記録し、あとから本ごとに見直すことができます。せっかく読書をして色々感じることがあるのに、それを忘れてしまうという問題を解決するために作ったサービスだそうです。</p>
</div>
          <!-- ngIf: curriculum.short_test --><div ng-if="curriculum.short_test" class="short_test-box ng-scope">
  <div class="short_test-title">
    <h4>
      確認問題
    </h4>
    <p>
      お疲れ様でした！このカリキュラムの終わりに確認問題を解きましょう。
    </p>
  </div>
  <div class="short_test_score" id="shortTestInfo"></div>
  <div class="short_test-button">
    <a class="curriculum-short-test-button" ng-click="showShortTest(curriculum.short_test.id)">確認テストに挑戦する！</a>
  </div>
</div><!-- end ngIf: curriculum.short_test -->
        </div>
      </div>
      <div class="col-md-3 col-sm-12" id="curriculumSideContainer">
        <curriculum-side-wrap id="sideWrap">
          <ul style="max-height: 295px;" class="list-group toc-tree" id="curriculumContents">
  <li class="list-group-item disabled">
    目次
  </li>
  <!-- ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding current" id="contents1" ng-click="clickContent(content.h1.id)">学習の目標</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents2" ng-click="clickContent(content.h1.id)">学習キーワード</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents3" ng-click="clickContent(content.h1.id)">投稿画面を作成する</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents4" ng-click="clickContent(h2.id)">ルーティングを設定しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents5" ng-click="clickContent(h2.id)">コントローラーを作成しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents6" ng-click="clickContent(h2.id)">ビューファイルを作成しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents7" ng-click="clickContent(content.h1.id)">投稿機能を実装する</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents8" ng-click="clickContent(h2.id)">ルーティングを設定しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents9" ng-click="clickContent(h2.id)">コントローラーを編集しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents10" ng-click="clickContent(h2.id)">ビューファイルを作成しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents11" ng-click="clickContent(content.h1.id)">動作確認を行なう</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents12" ng-click="clickContent(h2.id)">
 コラム：卒業生のサービス紹介③</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents -->
</ul>
          <div style="" ng-show="check_count > 0" class="progress_box ng-scope">
  <!-- ngIf: showTroubleShooting() --><p class="terms ng-scope" ng-if="showTroubleShooting()">
    エラーが解決できない時：<br><a href="http://master.tech-camp.in/curriculums/25" target="_brank">トラブルシューティング</a>
  </p><!-- end ngIf: showTroubleShooting() -->
  <!-- ngIf: courseId != 9 && courseId != 10 --><p class="terms ng-scope" ng-if="courseId != 9 &amp;&amp; courseId != 10">
    分からない用語がある時：<br><a href="http://master.tech-camp.in/terms" target="_brank">用語一覧集</a>
  </p><!-- end ngIf: courseId != 9 && courseId != 10 -->
  <h4>
    進捗度<i class="ng-binding" id="numerator">16 / 16<span id="denominaotr"></span></i>
  </h4>
  <div class="progress">
    <div aria-valuemax="100" aria-valuemin="0" aria-valuenow="100" class="pregress-bar progress-bar-info ng-binding" role="progressbar" style="width: 100%;">
      100%
    </div>
  </div>
</div>
          <curriculum-glossary class="ng-hide" ng-show="curriculum.curriculum_type == 2 || curriculum.curriculum_type == 3"></curriculum-glossary>
          <button class="curriculum-report-button" ng-click="show_curriculum_report()">
            <img src="idea.svg" height="20px" width="20px">
            | このカリキュラムへのご要望
          </button>
        </curriculum-side-wrap>
      </div>
    </div>
    <ul style="" class="pager" ng-hide="loading">
  <li class="previous">
    <a style="" class="" ng-click="go_previous()" ng-show="curriculum.previous_id">前のカリキュラム</a>
  </li>
  <li class="next">
    <a style="" class="" ng-class="{ disable: curriculum.short_test.can_see_next_curriculum == false }" ng-click="go_next()" ng-show="curriculum.next_id">次のカリキュラム</a>
  </li>
</ul>
  </div>
</curriculum>
<div style="" class="ng-scope ng-isolate-scope ng-hide" id="loading" ng-show="loading">
  <svg height="44" stroke="#444" viewBox="0 0 44 44" width="44" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" strole-width="2"><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="0s" calcMode="spline" dur="1.8s" keySplines="0.165, 0.84, 0.44, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 20"></animate><animate attributeName="stroke-opacity" begin="0s" calcMode="spline" dur="1.8s" keySplines="0.3, 0.61, 0.355, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 0"></animate></circle><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="-0.9s" calcMode="spline" dur="1.8s" keySplines="0.165, 0.84, 0.44, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 20"></animate><animate attributeName="stroke-opacity" begin="-0.9s" calcMode="spline" dur="1.8s" keySplines="0.3, 0.61, 0.355, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 0"></animate></circle></g></svg>
</div>

<div class="curriculum-image__modal modal ng-scope" id="curriculum-image__modal" role="dialog" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button class="close" data-dismiss="modal" ng-click="close()"><span aria-hidden="true">×</span></button>
      </div>
      <div class="modal-body">
        <div class="curriculum-image__img__body">
          <img class="curriculum-image__img zoom-out" id="curriculum-image__img">
        </div>
      </div>
    </div>
  </div>
</div>


</div><div class="chat-window ng-scope" ng-controller="SupportChatController" ng-init="init('大宅誠人', '/uploads/noimage.png', 1867, 2988, 0, 'accepted_questions', 'machi4271', '2')"><div aria-hidden="true" aria-labelledby="myLargeModalLabel" class="modal fade" id="chats-modal" role="dialog" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="wrapper">
  <header class="chat-header">
    <div class="row">
      <div class="col-md-6 col-xs-12 chat-header-left">
        <h2>
          質問チャット
        </h2>
        <div class="chat-support-state active in-support ng-binding">
          <img src="icn_qsupport.png" width="16">質問受付中
        </div>
      </div>
    </div>
  </header>
  <div class="chat-layout" load-more="load-more">
    <!-- ngRepeat: message in messages -->
  </div>
</div><footer class="chat-footer"><form accept-charset="UTF-8" action="http://master.tech-camp.in/api/chat_messages" class="new_chat_message ng-pristine ng-valid" data-remote="true" enctype="multipart/form-data" id="new_chat_message" method="post" ng_submit="afterSubmitted()"><div style="display: none;"><input name="utf8" value="✓" type="hidden"></div><input id="chat_message_chat_id" name="chat_message[chat_id]" value="2988" type="hidden"><div class="chat-box"><div class="row"><div class="chat-upload col-xs-1"><div class="chat-upload-btn"><img class="chat-upload-icn" src="icn_fileupload.png"><input class="ng-pristine ng-untouched ng-valid" id="chat_message_file" name="chat_message[file]" ng_model="file" onchange="angular.element(this).scope().showSubmitButtonAndHideSkypeButtonAndPreview()" type="file"><div class="chat-uploading-image ng-hide" ng-show="isUploading" ng-style="isUploadingStyle"><div class="image_del ng-hide" ng-click="clearImage()" ng-show="imageDeletable"><img alt="close" src="icon_close_red.svg"></div></div></div></div><div class="chat-textarea col-xs-8"><textarea class="form-control ng-pristine ng-untouched ng-valid" id="chat_message_content" name="chat_message[content]" ng_model="content" placeholder="次のコードの意味がよくわからないので教えていただけないでしょうか？" row="3"></textarea></div><div class="chat-submit col-xs-3"><input style="display: none;" class="submit-btn" id="submit_chat_message" name="commit" value="送信" type="submit"><div class="skype-popup"><a title="" data-original-title="" class="trigger btn btn-default" href="#">Skypeで直接聞く</a><div class="head hide">Skype質問を申請すると<br>担当メンターから着信が届きます。<br>以下の項目をご確認ください。</div><div class="content hide"><p class="ng-binding">あなたのSkypeID:　machi4271<br>質問箇所: <small>※スマートフォン、タブレットでのSkypeはご遠慮ください<br>※通話が始まったらすぐに画面共有をお願いします</small></p><a class="skype-support" href="http://master.tech-camp.in/curriculums/15">Skype質問を申請する</a><div class="close">×</div></div></div></div></div></div></form></footer></div></div></div><div class="chat-dock" ng-click="getMessages(); showModal()">質問サポート<!-- ngIf: unreadSize != 0 --><span class="dock-support-state_text in-support ng-binding"><img class="icn_qsupport" src="icn_qsupport_white.png" width="10">質問受付中</span></div></div></body>
</html>
