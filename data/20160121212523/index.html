<!DOCTYPE html>
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8"><title>発展学習2</title><meta content="authenticity_token" name="csrf-param">
<meta content="Y2UzkG5GQl5jzIBq3nOdxAEomQen5uuix05BO4pPfYw=" name="csrf-token"><link href="favicon.ico" rel="icon" sizes="16x16 32x32 48x48 128x128 256x256">
<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head>
<body class="ng-scope" ng-app="techMaster"><div class="navbar main_header navbar-fixed-top navbar-default" role="navigation"><div class="container"><div class="navbar-header"><button aria-controls="navbar" aria-expanded="false" class="navbar-toggle collapsed" data-target="#navbar" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="http://master.tech-camp.in/" target="_self"><img src="logo.png"></a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav navbar-right"><li class="text">終了まであと<i class="limit_time">10</i>日</li><li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" id="profileDropdown" style="padding: 10px 7px; cursor: pointer;"><img class="nav-proimg" src="noimage.png">大宅 誠人</a><ul class="dropdown-menu" id="profileDropdown"><li><a class="mypage-link" href="http://master.tech-camp.in/users/mypage" target="_self">マイページを見る</a></li><li><a href="http://master.tech-camp.in/users" target="_self">十三期生一覧</a></li></ul></li></ul></div></div></div><div class=""></div><!-- ngView:  --><div class="ng-scope" ng-view=""><curriculum style="display: inline;" class="ng-scope">
  <div class="container" id="curriculum">
    <div class="row curriculum-inner">
      <div class="col-lg-12 main" ng-init="init()">
        <div ng-show="curriculum.image" class="page-header page" style="background-image: url('349380728_f4a754c93a_o.jpg');">
  <h1 class="ng-binding">
    Railsアプリケーション開発1 第7章<small class="ng-binding">〜発展学習2〜</small>
  </h1>
  <!-- ngIf: curriculum.image.description.length --><div style="" class="flickr_attr ng-binding ng-scope" ng-if="curriculum.image.description.length">
    九寨溝は石灰岩質の岷山山脈（びんざんさんみゃく）中、標高3400mから2000mに大小100以上の沼が連なるカルスト地形の淡水の湖水地帯である。谷はY字状に分岐しており、岷山山脈から流れ出た水が滝を作り棚田状に湖沼が連なる。水は透明度が高く、山脈から流れ込んできた石灰岩の成分（炭酸カルシウム）が沼底に沈殿し、日中には青、夕方にはオレンジなど独特の色を放つ。<a class="ng-binding" href="https://www.flickr.com/photos/bengchye_loo/349380728" target="_top">B_cool - 九寨溝</a>
  </div><!-- end ngIf: curriculum.image.description.length -->
</div>
      </div>
      <div class="col-md-9 col-sm-12" id="curriculumMainContainer">
        <div class="curriculum_content">
          <div class="curriculum_text ng-scope" compile-progress-notifier="willCompiledCurriculumText" ng-controller="CurriculumHintController"><h1 id="1" class="ng-scope">Level7：ツイートにユーザー情報を追加しよう</h1>

<p class="ng-scope">現在、ツイートはどのユーザーが投稿したものなのかわからない状態になっています。これがわかるようになると、特定のユーザーがつぶやいたツイート一覧を取得できたり、ツイートの削除を行う際につぶやいた本人しか削除できないように設定できたりと色々便利です。そこで、本項では<strong>ツイートにユーザーの情報を追加して、誰が投稿したツイートなのかが分かる</strong>ようにします。</p>

<h3 class="ng-scope">
<i class="icon dashboard"></i> 作業内容</h3>

<h5 class="ng-scope">１．tweetsテーブルにカラムを追加する</h5>

<h5 class="ng-scope">２．ツイート保存時にユーザー情報を追加する処理を記述する</h5>

<h5 class="ng-scope">3．ツイート保存時にユーザー情報も保存できたか確かめる</h5>

<h2 id="2" class="ng-scope">1.tweetsテーブルにカラムを追加する</h2>

<p class="ng-scope">ツイートにユーザーの情報を追加する場合、tweetsテーブルに新しく<code>user_id</code>というカラムを作成し、そこにツイートを投稿したユーザーのidを入れます。カラムの追加の手順は<code>nickname</code>カラムを追加した際と同様です。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> tweetsテーブルにuser_idカラムをinteger型で追加してみましょう</h3>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td>
<td class="code">
<div class="highlight"><pre> <span class="nv">$ </span>rails g migration AddUserIdToTweets user_id:integer
 <span class="c"># tweetsテーブルにuser_idカラムをinteger型で追加するマイグレーションファイルの作成</span>

 <span class="nv">$ </span>rake db:migrate
 <span class="c"># マイグレーションファイルの実行</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h3 class="ng-scope">
<i class="icon newfile"></i> 新規作成されるファイル</h3>

<ul class="ng-scope">
<li>db/migrate/2014XXXXXXXXXX_add_user_id_to_tweets.rb</li>
</ul>

<h2 id="3" class="ng-scope">2.ツイート保存時にユーザー情報を追加する処理を記述する</h2>

<p class="ng-scope">上記の作業でtweetsテーブルにカラムが追加されました。そこで今回はツイートの保存時に投稿したユーザーのidをテーブルに保存する処理を記述します。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_361"></i> current_user</h3>

<p class="ng-scope">deviseでログイン機能を実装すると、<code>current_user</code>というヘルパーメソッドを使用することができます。これは、現在ログイン中のユーザーのレコードを、userクラスのインスタンスとして取得することができるメソッドです。</p>

<p class="ng-scope">例えば、<code>user_id</code>が<code>1</code>のアカウントでログインしている場合、<code>current_user</code>は<code>User.find(1)</code>と同じ意味を持ちます。この時、<code>current_user.usersテーブルのカラム名</code>とすることで、ログイン中のユーザーの情報として登録されている各カラムの値を取得することができます。</p>

<p class="ng-scope">ツイートを投稿したユーザーとはつまり現在ログインしているユーザーのことです。なので、<code>tweetsテーブルのuser_idカラムに保存すべきなのはcurrent_userのidカラムの値</code>です。</p>

<p class="ng-scope">実際にツイートをテーブルに保存する処理が書かれているのは<code>tweets_controller</code>の<code>create</code>アクションです。現在は、以下のようになっています。</p>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/tweets_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">TweetsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

    <span class="n">before_action</span> <span class="ss">:move_to_index</span><span class="p">,</span> <span class="ss">except</span><span class="p">:</span> <span class="ss">:index</span>

    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@tweets</span> <span class="o">=</span> <span class="no">Tweet</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s2">"created_at DESC"</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
<span class="hll">      <span class="no">Tweet</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">tweet_params</span><span class="p">)</span>
</span>    <span class="k">end</span>

    <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">tweet_params</span>
<span class="hll">      <span class="n">params</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:image</span><span class="p">,</span> <span class="ss">:text</span><span class="p">)</span>
</span>    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">move_to_index</span>
      <span class="n">redirect_to</span> <span class="ss">action</span><span class="p">:</span> <span class="s2">"index"</span> <span class="k">unless</span> <span class="n">user_signed_in?</span>
    <span class="k">end</span>
  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">ツイートを保存する際、<code>name</code>、<code>image</code>、<code>text</code>というビューから送られてくる情報に加えて、<code>user_id</code>カラムにログイン中のユーザーのidを保存しなければいけません。そこで、createメソッドの引数を<code>create(カラム名: 保存する値, カラム名: 保存する値, …)</code>と変更する必要があります。この時、name、image、textを保存する際には<code>tweet_params</code>というストロングパラメーターを使用しましょう。<code>tweet_params</code>はハッシュの形なので、<code>tweet_params[:キーの名前]</code>とすることでそのキーのバリューの値を取ることができます。すると、以下のように書くことができます。</p>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/tweets_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">TweetsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

    <span class="n">before_action</span> <span class="ss">:move_to_index</span><span class="p">,</span> <span class="ss">except</span><span class="p">:</span> <span class="ss">:index</span>

    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@tweets</span> <span class="o">=</span> <span class="no">Tweet</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s2">"created_at DESC"</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
<span class="hll">      <span class="no">Tweet</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="n">tweet_params</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span><span class="p">,</span> <span class="ss">image</span><span class="p">:</span> <span class="n">tweet_params</span><span class="o">[</span><span class="ss">:image</span><span class="o">]</span><span class="p">,</span> <span class="ss">text</span><span class="p">:</span> <span class="n">tweet_params</span><span class="o">[</span><span class="ss">:text</span><span class="o">]</span><span class="p">)</span>
</span>    <span class="k">end</span>

    <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">tweet_params</span>
      <span class="n">params</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:image</span><span class="p">,</span> <span class="ss">:text</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">move_to_index</span>
      <span class="n">redirect_to</span> <span class="ss">action</span><span class="p">:</span> <span class="ss">:index</span> <span class="k">unless</span> <span class="n">user_signed_in?</span>
    <span class="k">end</span>
  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">加えて、user_idに現在ログイン中のユーザーのidを保存する処理を追記しましょう。</p>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題7：ツイートの保存時に、user_idに現在ログイン中のユーザーのidを保存しましょう</h3>
  <div class="challenge_box">
  <h5>作業ファイル：app/controllers/tweets_controller</h5>
  <h5>ヒント：createの引数の形式に注意して、引数の末尾に保存するカラム名と保存したい値を書き加えてください。</h5>

  <curriculum-question-container class="ng-scope" data-order="1"><button style="" class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button style="" class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
  </div>
</div>

<h2 id="4" class="ng-scope">ツイート保存時にユーザー情報も保存できたか確かめる</h2>

<p class="ng-scope">投稿したユーザーのidをテーブルに保存する処理を記述できたら、実際にそれがうまく機能するか確かめましょう。実際にツイートを投稿し、Sequel Proに保存されたレコードを確認しましょう。user_idに現在ログイン中のユーザーのidが保存されていれば成功です。</p>

<p class="ng-scope"><img src="036.png" alt="保存できたか確認"></p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="343" action="http://master.tech-camp.in/curriculums/462#">
  <h4 class="ng-binding">
    <i class="icon check_icon_02"></i>課題チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-486" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-486" name="check-486" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">ツイートにユーザー情報を追加することができた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h1 id="5" class="ng-scope">Level8：マイページを作成しよう</h1>

<p class="ng-scope">現在、ツイートの一覧画面には全ユーザーのツイートが表示されています。そこで、一覧画面とは別に、現在ログイン中のユーザーの投稿のみが表示されているマイページを作成します。</p>

<h3 class="ng-scope">
<i class="icon dashboard"></i> 作業内容</h3>

<h5 class="ng-scope">１．マイページのルーティングを記述する</h5>

<h5 class="ng-scope">２．コントローラーとアクションを作成する</h5>

<h5 class="ng-scope">３．マイページ用のビューファイルを作成する</h5>

<h5 class="ng-scope">４．マイページへのリンクを作成する</h5>

<h2 id="6" class="ng-scope">1.マイページのルーティングを記述する</h2>

<p class="ng-scope">新しくページを作成する場合、まずはルーティングを設定します。マイページへのパスは、usersテーブルでのidが1のユーザーでは<code>/users/1</code>、idが99のユーザーでは<code>/users/99</code>となるようにルーティングを設定します。</p>

<p class="ng-scope">マイページのパスは他のページと違って、ユーザーごとにパスが異なります。その場合、通常とは多少異なるルーティングの記述方法を使います。<br>
マイページを表示する際には<strong>usersコントローラー</strong>の<strong>showアクション</strong>を動かします。<code>show</code>アクションへのルーティングは、以下のように書きます。</p>

<h3 class="ng-scope">【例】</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">config/routes.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
    <span class="n">get</span>     <span class="s1">'/コントローラー名/:id'</span>        <span class="o">=&gt;</span> <span class="s1">'コントローラー名#show'</span>
  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><code>:id</code>の部分には表示するユーザーページのユーザーのidが入ります。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> config/routes.rbを以下のように編集してください。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">config/routes.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
    <span class="n">devise_for</span> <span class="ss">:users</span>
    <span class="n">root</span>  <span class="s1">'tweets#index'</span>
    <span class="n">get</span>   <span class="s1">'tweets'</span>      <span class="o">=&gt;</span>  <span class="s1">'tweets#index'</span>
    <span class="n">get</span>   <span class="s1">'tweets/new'</span>  <span class="o">=&gt;</span>  <span class="s1">'tweets#new'</span>
    <span class="n">post</span>  <span class="s1">'tweets'</span>      <span class="o">=&gt;</span>  <span class="s1">'tweets#create'</span>
<span class="hll">    <span class="n">get</span>   <span class="s1">'users/:id'</span>   <span class="o">=&gt;</span>  <span class="s1">'users#show'</span>    <span class="c1">#Mypageへのルーティング</span>
</span>  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">このようにルーティングを定義することによって、パスの一部をコントローラーにパラメーターというハッシュ形式で値を送る事が出来ます。これはparamsというメソッドを使用することで取得することが出来ます。コントローラー内で<code>params[:id]</code>と記述することにすれば<code>/users/:id</code>の<code>:id</code>部分の情報を使用することができます。後ほどparamsの中身を見ていきます。</p>

<h2 id="7" class="ng-scope">2.コントローラーとアクションを作成する</h2>

<p class="ng-scope">先ほど、マイページを表示するために<strong>usersコントローラー</strong>の<strong>showアクション</strong>を動かすルーティングを設定しました。続いてusersコントローラーを作成し、showアクションを定義していきます。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_362"></i> whereメソッド</h3>

<p class="ng-scope"><code>where</code>メソッドはActiveRecordメソッドのうちの一つです。<code>モデル.where(条件)</code>のように引数部分に条件を指定することで、テーブル内の<strong>条件に一致したレコードのインスタンスを配列型で取得</strong>できます。</p>

<p class="ng-scope">また、<code>where</code>メソッドを連続して記述することによって、複数の条件に一致したレコードを取得することもできます。</p>

<h3 class="ng-scope">【例】</h3>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">コンソール</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="o">[</span>1<span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; Tweet.where<span class="o">(</span><span class="s1">'id &lt; 3'</span><span class="o">)</span>
  <span class="o">=</span>&gt; <span class="o">[</span>＃&lt;Tweet id: 1, image: <span class="s2">"test1.jpg"</span>, text: <span class="s2">"いい景色だ。"</span>, created_at: <span class="s2">"2014-12-06 00:00:00"</span>, updated_at: <span class="s2">"2014-12-06 00:00:00"</span>, user_id: 1&gt;,＃&lt;Tweet id: 2, image: <span class="s2">"test2.jpg"</span>, text: <span class="s2">"Thank you!"</span>, created_at: <span class="s2">"2014-12-07 00:00:00"</span>, updated_at: <span class="s2">"2014-12-07 00:00:00"</span>, user_id: 2&gt;<span class="o">]</span>
  <span class="c"># idが3未満のtweetsテーブルのインスタンスを配列で取得</span>

  <span class="o">[</span>2<span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; Tweet.where<span class="o">(</span><span class="s1">'id &lt; 3'</span><span class="o">)</span>.where<span class="o">(</span>user_id: 1<span class="o">)</span>
  <span class="o">=</span>&gt; <span class="o">[</span>＃&lt;Tweet id: 1, image: <span class="s2">"test1.jpg"</span>, text: <span class="s2">"いい景色だ。"</span>, created_at: <span class="s2">"2014-12-06 00:00:00"</span>, updated_at: <span class="s2">"2014-12-06 00:00:00"</span>, user_id: 1&gt;<span class="o">]</span>
  <span class="c"># idが3未満かつuser_idが1のtweetsテーブルのインスタンスを配列で取得</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h3 class="ng-scope">
<i class="icon pen"></i> 以下の指示に従い、users_controllerを作成してください。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="err">$</span> <span class="n">rails</span> <span class="n">g</span> <span class="n">controller</span> <span class="n">users</span>
  <span class="c1"># users_controllerと関連するファイルを作成</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h3 class="ng-scope">
<i class="icon newfile"></i> 新規作成されるファイル</h3>

<ul class="ng-scope">
<li>app/controllers/users_controller.rb</li>
<li>test/controllers/users_controller_test.rb</li>
<li>app/helpers/users_helper.rb</li>
<li>test/helpers/users_helper_test.rb</li>
<li>app/assets/javascripts/users.js.coffee</li>
<li>app/assets/stylesheets/users.css.scss</li>
</ul>

<p class="ng-scope">続いて、作成したusers_controllerに<code>show</code>アクションを定義します。<code>show</code>アクションで表示するのはユーザーのマイページですが、マイページに必要な情報はニックネームとログイン中のユーザーのツイートの2つです。そこで、showアクションにはユーザーページを表示する際に必要な情報をビューに受け渡す処理を記述します。</p>

<p class="ng-scope">ビューに情報を受け渡す際には<strong>インスタンス変数（@付きの変数）をコントローラーのアクション内で定義</strong>します。今回の場合、必要な情報はニックネームとログイン中のユーザーのツイートの2つです。それぞれを<code>@nickname</code>と<code>@tweets</code>という変数に定義しましょう。</p>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題8：マイページに表示したい情報をshowアクションに定義しましょう</h3>
  <div class="challenge_box">
    <h5>作業ファイル：app/controllers/users_controller</h5>
    <h5>ヒント：@tweetsを定義する際はActiveRecordメソッドのwhereを使用します。</h5>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">users_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td>
<td class="code">
<div class="highlight"><pre> 
  <span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@nickname</span> <span class="o">=</span> <span class="err">現在ログインしているユーザーのニックネーム</span>
      <span class="vi">@tweets</span> <span class="o">=</span> <span class="err">現在ログインしているユーザーが投稿したツイート</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s2">"created_at DESC"</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
 
</pre></div>
</td>
</tr></tbody></table>
</div>

    <curriculum-question-container class="ng-scope" data-order="2"><button style="" class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button style="" class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
  </div>
</div>

<h2 id="8" class="ng-scope">3.マイページ用のビューファイルを作成する</h2>

<p class="ng-scope"><strong>usersコントローラー</strong>に<strong>showアクション</strong>を定義することができたので、アクションに対応するビューファイルを作成していきます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> 以下の指示に従い、app/views/users/show.html.erbを作成してください。</h3>

<h3 class="ng-scope">①ファイルの新規作成</h3>

<p class="ng-scope">先ほどusers_controllerを作成した際にapp/views/usersディレクトリが作成されているので、その中に<code>show.html.erb</code>というファイルを作成してください。</p>

<h3 class="ng-scope">
<i class="icon newfile"></i> 新規作成されるファイル</h3>

<ul class="ng-scope">
<li>app/views/users/show.html.erb</li>
</ul>

<h3 class="ng-scope">②ファイルの編集</h3>

<p class="ng-scope">作成したファイルを、以下のように編集しましょう。</p>

<div class="code-frame ng-scope" data-lang="html">
<div class="code-lang"><span class="bold">app/views/users/show.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="hll">  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"contents row"</span><span class="nt">&gt;</span>
</span><span class="hll">    <span class="nt">&lt;p&gt;</span><span class="err">&lt;</span>%= @nickname %&gt;さんの投稿一覧<span class="nt">&lt;/p&gt;</span>
</span><span class="hll">    <span class="err">&lt;</span>%= render partial: "tweets/tweet", collection: @tweets %&gt;
</span><span class="hll">    <span class="err">&lt;</span>%= paginate(@tweets) %&gt;
</span><span class="hll">  <span class="nt">&lt;/div&gt;</span>
</span></pre></div>
</td>
</tr></tbody></table>
</div>

<h3 class="ng-scope">4.マイページへのリンクを作成する</h3>

<p class="ng-scope">マイページへはPicTweetのページ上部から遷移出来るように実装します。</p>

<p class="ng-scope">本項の<strong>1.マイページのルーティングを記述する</strong>で実装した通り、マイページへのパスは<code>/users/ログイン中のユーザーのid</code>です。こちらをどう記述するかが鍵になります。</p>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題9：マイページへのリンクを作成しましょう</h3>
  <div class="challenge_box">
    <h5>作業ファイル：app/views/layouts/application.html.erb</h5>
    <h5>ヒント：マイページのパスは「/users/ログイン中のユーザーのid」となっています。そのため、ビューファイルもログイン中のユーザーによってリンクが変化するようにRubyタグを使って記述を行ないます。</h5>
    【例】
<div class="code-frame" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/layouts/application.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td>
<td class="code">
<div class="highlight"><pre> 
  <span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">"header"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"header__bar row"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"grid-6"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/"</span><span class="nt">&gt;</span>PicTweet<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">user_signed_in?</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"user_nav grid-6"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span&gt;</span>ログイン中のユーザーのニックネームを記述
            <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"user__info"</span><span class="nt">&gt;</span>
              <span class="nt">&lt;li&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/users/ログイン中のユーザーのid"</span><span class="nt">&gt;</span>マイページ<span class="nt">&lt;/a&gt;</span>
                <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"ログアウト"</span><span class="p">,</span> <span class="n">destroy_user_session_path</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:delete</span> <span class="cp">%&gt;</span>
              <span class="nt">&lt;/li&gt;</span>
            <span class="nt">&lt;/ul&gt;</span>
          <span class="nt">&lt;/span&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"post"</span> <span class="na">href=</span><span class="s">"/tweets/new"</span><span class="nt">&gt;</span>投稿する<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">else</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"grid-6"</span><span class="nt">&gt;</span>
          <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"ログイン"</span><span class="p">,</span> <span class="n">new_user_session_path</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'post'</span> <span class="cp">%&gt;</span>
          <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"新規登録"</span><span class="p">,</span> <span class="n">new_user_registration_path</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'post'</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/header&gt;</span>
 
</pre></div>
</td>
</tr></tbody></table>
</div>
    <curriculum-question-container class="ng-scope" data-order="3"><button style="" class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button style="" class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
  </div>
</div>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="344" action="http://master.tech-camp.in/curriculums/462#">
  <h4 class="ng-binding">
    <i class="icon check_icon_02"></i>課題チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-487" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-487" name="check-487" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">マイページを作成することができた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h3 class="ng-scope">
<i class="icon pen"></i>localhost:3000/users/ ログイン中のユーザーのid にアクセスしてマイページが作成されているか確認しましょう</h3>

<p class="ng-scope"><img src="052.png" alt="マイページ確認"></p>

<p class="ng-scope">最後にルーティングを設定したところで一度触れたパラメーターについて見ていきます。paramsの中を確認するには<a href="http://master.tech-camp.in/curriculums/16#term_214" target="_top">binding.pry</a>を使用します。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> /app/controllers/users_controller.rbのshowアクションを以下のように編集しましょう</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">users_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
<span class="hll">    <span class="nb">binding</span><span class="o">.</span><span class="n">pry</span>
</span>    <span class="vi">@nickname</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">nickname</span>
    <span class="vi">@tweets</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">tweets</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s1">'created_at desc'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">編集したら、<a href="http://localhost:3000/users/%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AEid">http://localhost:3000/users/ログインしているユーザーのid</a> にアクセスします。</p>

<p class="ng-scope">するとサーバーが停止するので、ターミナルを確認します。</p>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td>
<td class="code">
<div class="highlight"><pre>    2: def <span class="nv">show</span>
 <span class="o">=</span>&gt; 3:   binding.pry
    4:   @nickname <span class="o">=</span> current_user.nickname
    5:   @tweets <span class="o">=</span> current_user.tweets.page<span class="o">(</span>params<span class="o">[</span>:page<span class="o">])</span>.per<span class="o">(</span>5<span class="o">)</span>.order<span class="o">(</span><span class="s1">'created_at desc'</span><span class="o">)</span>
    6: end
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">この状態で、<code>params</code>と入力します。</p>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="o">[</span>1<span class="o">]</span> pry<span class="o">(</span><span class="c">#&lt;UsersController&gt;)&gt; params</span>
<span class="o">=</span>&gt; <span class="o">{</span><span class="s2">"controller"</span><span class="o">=</span>&gt;<span class="s2">"users"</span>, <span class="s2">"action"</span><span class="o">=</span>&gt;<span class="s2">"show"</span>, <span class="s2">"id"</span><span class="o">=</span>&gt;<span class="s2">"1"</span><span class="o">}</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">paramsというハッシュの中に<code>"id" =&gt; "1"</code>というルーティングで設定したキーとビューでパスに組み込まれたユーザーのidが追加されているのが確認できます。このparamsがコントローラーに送られてくるのでコントローラー内でparams[:id]とすることでユーザーのidを取得することが出来ます。また、ルーティングで<code>:id</code>を<code>:user_id</code>のように変更すると、以下のようにキーがuser_idになります。</p>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="o">[</span>1<span class="o">]</span> pry<span class="o">(</span><span class="c">#&lt;UsersController&gt;)&gt; params</span>
<span class="o">=</span>&gt; <span class="o">{</span><span class="s2">"controller"</span><span class="o">=</span>&gt;<span class="s2">"users"</span>, <span class="s2">"action"</span><span class="o">=</span>&gt;<span class="s2">"show"</span>, <span class="s2">"user_id"</span><span class="o">=</span>&gt;<span class="s2">"1"</span><span class="o">}</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><i class="icon pen"></i> users_controller.rbに記述したbinding.pryを削除しましょう</p>

<h1 id="9" class="ng-scope">Level9：アソシエーションを利用しよう</h1>

<p class="ng-scope">Railsには<strong>モデル間の関連付けを管理するアソシエーションという機能</strong>があります。今回の作業ではこのアソシエーションという機能を実装します。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_363"></i> アソシエーション</h3>

<p class="ng-scope">アソシエーションとはモデル間の関連付けを管理する機能のことで、定義しておくことで<strong>モデルをまたいだデータの呼び出しをより簡単に行なうことができるようになります</strong>。今回の場合、UserモデルとTweetモデルをアソシエーションで関連付けします。下のヒントを参考にしながら実装を行ないましょう。</p>

<h3 class="ng-scope">
<i class="icon dashboard"></i> 作業内容</h3>

<h5 class="ng-scope">１．アソシエーションを定義する</h5>

<h5 class="ng-scope">２．アソシエーションを実装する</h5>

<h2 id="10" class="ng-scope">1.アソシエーションを定義する</h2>

<p class="ng-scope">アソシエーションを利用するために、まずはモデル間の関係を定義しましょう。アソシエーションを利用するには以下の2つの条件を満たす必要があります。</p>

<h3 class="ng-scope">① モデルクラスに<code>has_many</code>や<code>belongs_to</code>などの定義がされている</h3>

<h3 class="ng-scope">② 所属する側のテーブルに<code>所属するクラス名_id</code>というカラムがある</h3>

<p class="ng-scope">②の実装に関しては<strong>Level7</strong>で行なった(<code>user_id</code>というカラムをtweetsテーブルに追加した)ので、これから①の実装に関しての説明を行ないます。</p>

<p class="ng-scope">現在PicTweetにはサインアップという機能があり、利用者がユーザーを作成してログインを行なうことが出来ます。また、ツイートの投稿に関してはログインしたユーザーのみが行なうことが出来ます。</p>

<p class="ng-scope">つまり、<strong>全てのツイートはいずれかのユーザーが作成したもの</strong>であり、逆に言えば<strong>ユーザーは自分の作成したツイートを複数個所持している状態</strong>といえます。</p>

<p class="ng-scope"><img src="005.png" alt="アソシエーション説明"></p>

<p class="ng-scope">Userモデルの視点で考えると、あるuserの作成したtweetが複数個ある状態と言えます。この状態のことを<strong>has manyの関係</strong>といい、今回の場合には「User has many Tweets」の状態であると言えます。</p>

<p class="ng-scope"><img src="006.png" alt="User_has_many_Tweets"></p>

<p class="ng-scope">この関係をアソシエーションで<strong>定義するためにはUserモデルのモデルファイルを編集</strong>します。「User has many Tweets」の状態を定義するので、Userモデルのモデルファイルに<code>has_many :tweets</code>と追記します。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> 以下の指示に従い、app/models/user.rbを編集してください。</h3>

<div class="code-frame ng-scope" data-lang="ruby"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
    <span class="n">devise</span> <span class="ss">:database_authenticatable</span><span class="p">,</span> <span class="ss">:registerable</span><span class="p">,</span>
           <span class="ss">:recoverable</span><span class="p">,</span> <span class="ss">:rememberable</span><span class="p">,</span> <span class="ss">:trackable</span><span class="p">,</span> <span class="ss">:validatable</span>
<span class="hll">    <span class="n">has_many</span> <span class="ss">:tweets</span>
</span>  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">また、Tweetモデルの視点で考えると、全てのtweetはいずれかのuserに属している状態と言えます。この状態のことを<strong>belongs toの関係</strong>といい、今回の場合は「Tweet belongs to User」の状態であると言えます。</p>

<p class="ng-scope"><img src="007.png" alt="Tweet_belongs_to_User"></p>

<p class="ng-scope">この関係をアソシエーションで定義するためには<strong>Tweetモデルのモデルファイルを編集</strong>します。「Tweet belongs to User」の関係を定義するので、Tweetモデルのモデルファイルに<code>belongs_to :user</code>と追記します。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> 以下の指示に従い、app/models/tweet.rbを編集してください。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/models/tweet.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">Tweet</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="hll">    <span class="n">belongs_to</span> <span class="ss">:user</span>
</span>  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h2 id="11" class="ng-scope">2.アソシエーションを実装する</h2>

<p class="ng-scope">以上の作業でアソシエーションを定義することができました。そこで、実際にアソシエーションを利用して実装を行なっていきます。さきほど編集を行なった<code>users_controller.rb</code>の<code>show</code>アクション部分でのデータの呼び出しにアソシエーションを使用して記述を行ないます。</p>

<p class="ng-scope">アソシエーションを定義すると、モデルをまたいだデータの呼び出しをより直感的に行なうことが出来ます。便利さを実感してもらうために、アソシエーションを使用しない場合とする場合のコードの違いを見てみましょう。</p>

<p class="ng-scope">アソシエーションを使用しない場合は、以下のように現在ログイン中のユーザーが投稿したツイートを取得します。<br>
例としてコンソールからのデータの呼び出しを行ないます。</p>

<h3 class="ng-scope">【例】アソシエーションを使用しない</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="err">$</span> <span class="n">rails</span> <span class="n">c</span>
  <span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="hll">  <span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="no">Tweet</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">user_id</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span>  <span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;Tweet id: 1, image: "http://photo1.jpg", text: "いい景色だ。", created_at: "2014-12-06 09:00:00", updated_at: "2014-12-06 09:00:00", user_id: 1&gt;,</span>
  <span class="c1">#&lt;Tweet id: 1, image: "http://photo2.jpg", text: "楽しい思い出は消えない。", created_at: "2014-12-06 10:00:00", updated_at: "2014-12-06 10:00:00", user_id: 1&gt;]</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">tweetsテーブルに対して、<code>user_id</code>が<code>user</code>のidと等しいレコードを取得しています。</p>

<p class="ng-scope">対して、これと同じことをアソシエーションを利用すると以下のように記述出来ます。</p>

<h3 class="ng-scope">【例】アソシエーションを使用する</h3>

<div class="code-frame ng-scope" data-lang="ruby"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="err">$</span> <span class="n">rails</span> <span class="n">c</span>
  <span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="hll">  <span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">user</span><span class="o">.</span><span class="n">tweets</span>
</span>  <span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;Tweet id: 1, image: "http://photo1.jpg", text: "いい景色だ。", created_at: "2014-12-06 09:00:00", updated_at: "2014-12-06 09:00:00", user_id: 1&gt;,</span>
  <span class="c1">#&lt;Tweet id: 1, image: "http://photo2.jpg", text: "楽しい思い出は消えない。", created_at: "2014-12-06 10:00:00", updated_at: "2014-12-06 10:00:00", user_id: 1&gt;]</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">Userモデルに「User has many Tweets」の状態のアソシエーションを定義したので、<code>Userモデルのインスタンス.tweets</code>と記述するだけで<strong>そのインスタンスが所持しているツイートを取得</strong>することができます。</p>

<p class="ng-scope">早速、users_controllerの<code>show</code>アクション内を編集してアソシエーションを利用してみましょう。</p>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題10：アソシエーションを利用して@tweetsを定義しましょう</h3>
  <div class="challenge_box">
    <h5>作業ファイル：app/controllers/users_controller</h5>
    <h5>ヒント：現在ログイン中のユーザーがつぶやいたツイート達を取得するよう書きます</h5>

        <div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">users_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@nickname</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">nickname</span>
    <span class="vi">@tweets</span> <span class="o">=</span> <span class="err">アソシエーションを使用して記述</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s2">"created_at DESC"</span><span class="p">)</span>
   <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>
    <curriculum-question-container class="ng-scope" data-order="4"><button style="" class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button style="" class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
  </div>
</div>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="345" action="http://master.tech-camp.in/curriculums/462#">
  <h4 class="ng-binding">
    <i class="icon check_icon_02"></i>課題チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-488" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-488" name="check-488" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">アソシエーションを定義して利用することができた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h1 id="12" class="ng-scope">Level10：ツイート一覧画面にニックネームを表示しよう</h1>

<p class="ng-scope">現在、ツイートの一覧画面のツイートの右下には、投稿時に入力した「name」が表示されています。その部分の表示を投稿者の「nickname」を表示するように実装しましょう。</p>

<h3 class="ng-scope">
<i class="icon dashboard"></i> 作業内容</h3>

<h5 class="ng-scope">１．投稿者名を表示するようにビューを変更する</h5>

<h5 class="ng-scope">２．ツイートからユーザー情報を先読みする</h5>

<h5 class="ng-scope">３．投稿画面のビューを変更する</h5>

<h5 class="ng-scope">４．投稿時のコントローラーでの処理を変更する</h5>

<h5 class="ng-scope">５．tweetsテーブルから不要なカラムを削除する</h5>

<h2 id="13" class="ng-scope">1.投稿者名を表示するようにビューを変更する</h2>

<p class="ng-scope">ツイートの右下、tweetsテーブルのレコードの「name」カラムの値が表示されている部分に、ツイートの投稿者の「nickname」が表示されるようにビューの変更を行なっていきます。「nickname」を表示する際にはアソシエーションを利用します。</p>

<p class="ng-scope">Tweetモデルに対して「Tweet belongs to User」という形でアソシエーションを定義しているので、<code>Tweetモデルのインスタンス.user</code>と記述するだけで<strong>そのインスタンスが属しているUserモデルのインスタンスを取得する</strong>ことができます。</p>

<p class="ng-scope">またコンソールを利用して例を見てみましょう。</p>

<h3 class="ng-scope">【例】アソシエーションを利用しない</h3>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nv">$ </span>rails c
  <span class="o">[</span>1<span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; <span class="nv">tweet</span> <span class="o">=</span> Tweet.find<span class="o">(</span>1<span class="o">)</span>
<span class="hll">  <span class="o">[</span>2<span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; User.find<span class="o">(</span>tweet.user_id<span class="o">)</span>
</span>  <span class="o">=</span>&gt; <span class="c">#&lt;;User id: 1, email: "test@gmail.com", encrypted_password: "@@@@@@@@@@@@@@@@@", reset_password_token: nil, reset_password_sent_at: nil, remember_created_at: nil, sign_in_count: 1, current_sign_in_at: "2014-12-06 09:00:00", last_sign_in_at: "2014-12-06 09:00:00", current_sign_in_ip: "127.0.0.1", last_sign_in_ip: "127.0.0.1", created_at: "2014-12-06 09:00:00", updated_at: "2014-12-06 09:00:00", nickname: "test_ruby"&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">usersテーブルに対して、idが<code>tweet</code>の<code>user_id</code>と等しいレコードを取得しています。これと同じことをアソシエーションを利用すると以下のように記述出来ます。</p>

<h3 class="ng-scope">【例】アソシエーションを利用する</h3>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nv">$ </span>rails c
  <span class="o">[</span>1<span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; <span class="nv">tweet</span> <span class="o">=</span> Tweet.find<span class="o">(</span>1<span class="o">)</span>
  <span class="o">[</span>2<span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; tweet.user
  <span class="o">=</span>&gt; <span class="c">#&lt;User id: 1, email: "test@gmail.com", encrypted_password: "@@@@@@@@@@@@@@@@@", reset_password_token: nil, reset_password_sent_at: nil, remember_created_at: nil, sign_in_count: 1, current_sign_in_at: "2014-12-06 09:00:00", last_sign_in_at: "2014-12-06 09:00:00", current_sign_in_ip: "127.0.0.1", last_sign_in_ip: "127.0.0.1", created_at: "2014-12-06 09:00:00", updated_at: "2014-12-06 09:00:00", nickname: "test_ruby"&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">早速実装してみましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> app/views/tweets/_tweet.html.erbを以下のように編集しましょう</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/tweets/_tweet.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"content_post"</span> <span class="na">style=</span><span class="s">"background-image: url(</span><span class="cp">&lt;%=</span> <span class="n">tweet</span><span class="o">.</span><span class="n">image</span> <span class="cp">%&gt;</span><span class="s">);"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">br</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"name"</span><span class="nt">&gt;</span>
<span class="hll">      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">""</span><span class="nt">&gt;</span>
</span><span class="hll">        <span class="nt">&lt;span&gt;</span>投稿者<span class="nt">&lt;/span&gt;</span><span class="cp">&lt;%=</span> <span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">nickname</span> <span class="cp">%&gt;</span>
</span><span class="hll">      <span class="nt">&lt;/a&gt;</span>
</span>    <span class="nt">&lt;/span&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">ビューを確認する前に、以下の注意事項を読んでください。</p>

<p class="ng-scope"><i class="icon attention"></i>Sequel Pro上で、tweetsテーブルにあるレコードのうち<code>user_id</code>カラムが空のものに、現在存在している<strong>usersテーブルのレコードのidを入力</strong>してください。</p>

<p class="ng-scope"><strong>Level7</strong>で、tweetを投稿した際に<strong>user_id</strong>も一緒に保存するようにしましたが、Sequel Proで確認すればわかる通り、それ以前に投稿したtweetは<strong>user_id</strong>が<strong>null</strong>のままになっているはずです。この時<strong>tweet.user</strong>は<strong>nil</strong>となるため、<strong>tweet.user.nickname</strong>と書くと、<strong>null</strong>クラスに対して<strong>nickname</strong>メソッドが実行されてしまいエラーとなります。</p>

<p class="ng-scope"><i class="icon attention"></i> nicknameが表示されているか確認しましょう</p>

<p class="ng-scope"><a href="http://localhost:3000/">localhost:3000</a>にアクセスして、投稿一覧にnickname<br>
が表示されているか確認しましょう。</p>

<p class="ng-scope"><img src="040.png" alt="nicknameの表示確認"></p>

<h2 id="14" class="ng-scope">2.ツイートからユーザー情報を先読みする</h2>

<p class="ng-scope">上記の実装でツイートの一覧画面に投稿者の「nickname」が表示されるようになりました。しかし、ツイートからユーザーの情報を呼び出す際に「n+1問題」という問題が発生しています。そこで、今回はこの問題を解決するためにユーザー情報を先読みするように実装していきます。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_364"></i> n+1問題</h3>

<p class="ng-scope">モデルを利用してデータベースの情報にアクセスする際にはSQLが発行されます。SQLが発行されるたびにデータベースに対して通信が走るので、SQLが大量に発行されれば処理が重くなります。n+1問題とは、データを呼び出す際に大量のSQLが発行されてしまう問題のことです。</p>

<p class="ng-scope">今回の場合、indexアクションで全ツイートを取得する1回に加えて、部分テンプレートである<code>_tweet.html.erb</code>でアソシエーションを利用してツイートの数だけユーザー情報を呼び出しています。つまり、現在の状態だとツイート数＋1回SQLが発行されています。この状態のことをn+1問題と言います。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_365"></i> includesメソッド</h3>

<p class="ng-scope">includesメソッドはn+1問題を解消することができます。指定された関連モデルをまとめて取得することで、SQLの発行回数を減らすことができます。書き方は、<code>includes(:モデル名)</code>とします。引数で、関連モデルをシンボル型(接頭に:がつく型)で指定します。</p>

<p class="ng-scope">今回、usersテーブルとtweetsテーブルの間には以下の図のような関係があります。tweetsテーブルのレコードは必ず1つのusersテーブルのレコードに属しているので、includesメソッドを利用することでtweetsテーブルのレコードを取得する段階で関連するusersテーブルのレコードも一度に取得することができます。</p>

<p class="ng-scope"><img src="101.png" alt="includes"></p>

<h3 class="ng-scope">
<i class="icon pen"></i> app/controllers/tweets_controller.rbを以下のように編集しましょう</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/tweets_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">TweetsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

    <span class="k">def</span> <span class="nf">index</span>
<span class="hll">      <span class="vi">@tweets</span> <span class="o">=</span> <span class="no">Tweet</span><span class="o">.</span><span class="n">includes</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s2">"created_at DESC"</span><span class="p">)</span>
</span>    <span class="k">end</span>

    <span class="c1">#以下省略</span>

  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h2 id="15" class="ng-scope">3.投稿画面のビューを変更する</h2>

<p class="ng-scope">ツイートを表示する際にアソシエーションを利用して投稿者のニックネームが表示されるようになったので、投稿時に「name」を入力する必要がなくなりました。そこで、この実装に合わせたビューの変更を行ないます。投稿時に「name」を入力する必要がなくなったので、「name」の入力フォームを削除します。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> app/views/tweets/new.html.erbを以下のように編集しましょう</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/tweets/new.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"contents row"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form_tag</span><span class="p">(</span><span class="s1">'/tweets'</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:post</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;h3&gt;</span>
        投稿する
      <span class="nt">&lt;/h3&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">placeholder=</span><span class="s">"Image URL"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"image"</span> <span class="na">autofocus=</span><span class="s">"true"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;textarea</span> <span class="na">placeholder=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"text"</span> <span class="na">cols=</span><span class="s">"30"</span> <span class="na">rows=</span><span class="s">"10"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"SENT"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h2 id="16" class="ng-scope">4.投稿時のコントローラーでの処理を変更する</h2>

<p class="ng-scope">投稿時に「name」を入力する必要がなくなったので、それに合わせて<strong>tweetsコントローラー</strong>での処理も変更しましょう。<code>name</code>カラムを使用しないので、ツイートの保存時に<code>name</code>カラムに情報を保存しないように変更を行ないます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> app/controllers/tweets_controller.rbを以下のように編集しましょう</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/tweets_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">TweetsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

    <span class="n">before_action</span> <span class="ss">:move_to_index</span><span class="p">,</span> <span class="ss">except</span><span class="p">:</span> <span class="ss">:index</span>

    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@tweets</span> <span class="o">=</span> <span class="no">Tweet</span><span class="o">.</span><span class="n">includes</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s2">"created_at DESC"</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
<span class="hll">      <span class="no">Tweet</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">image</span><span class="p">:</span> <span class="n">tweet_params</span><span class="o">[</span><span class="ss">:image</span><span class="o">]</span><span class="p">,</span> <span class="ss">text</span><span class="p">:</span> <span class="n">tweet_params</span><span class="o">[</span><span class="ss">:text</span><span class="o">]</span><span class="p">,</span> <span class="ss">user_id</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span>    <span class="k">end</span>

    <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">tweet_params</span>
<span class="hll">      <span class="n">params</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:image</span><span class="p">,</span> <span class="ss">:text</span><span class="p">)</span>
</span>    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">move_to_index</span>
      <span class="n">redirect_to</span> <span class="ss">action</span><span class="p">:</span> <span class="ss">:index</span> <span class="k">unless</span> <span class="n">user_signed_in?</span>
    <span class="k">end</span>
  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h2 id="17" class="ng-scope">5.tweetsテーブルから不要なカラムを削除する</h2>

<p class="ng-scope">ツイートに「name」という情報を保存しなくなったので「name」カラムが不要になりました。<br>
そこで、テーブルからカラムを削除するためのマイグレーションファイルを作成して、カラムの削除を実行しましょう。そのためには、以下のようにコマンドを実行します。</p>

<h3 class="ng-scope">【例】</h3>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nv">$ </span>rails g migration Removeカラム名From削除元テーブル名 削除するカラム名:型
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">今回は、tweetsテーブルから<code>string</code>型の<code>name</code>というカラムを削除します。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> ターミナルから、以下のコマンドを実行してください</h3>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nv">$ </span>rails g migration RemoveNameFromTweets name:string
  <span class="c"># マイグレーションファイルの作成</span>

  <span class="nv">$ </span>rake db:migrate
  <span class="c"># マイグレーションの実行</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><i class="icon attention"></i><code>Removeカラム名From削除元テーブル名</code>の<strong>カラム名</strong>の部分は、Addカラムの際と同様に必ずしも厳密なカラム名を入力する必要はありません。今回はnameというカラムのみを削除するので、<strong>Name</strong>と記述しましょう。対して、<code>削除元テーブル名</code>は正確に記述する必要があります。</p>

<h3 class="ng-scope">
<i class="icon newfile"></i> 新規作成されるファイル</h3>

<ul class="ng-scope">
<li>db/migrate/2015XXXXXXXXXX_remove_name_from_tweets.rb</li>
</ul>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="346" action="http://master.tech-camp.in/curriculums/462#">
  <h4 class="ng-binding">
    <i class="icon check_icon_02"></i>課題チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-489" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-489" name="check-489" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">ツイート一覧画面にニックネームを表示できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h1 id="18" class="ng-scope">Level11：ツイートの削除機能を追加しよう</h1>

<p class="ng-scope">現在の実装では一度投稿したツイートは削除することができません。そこで、ツイートに削除ボタンを追加して、ツイートの削除を行えるようにしましょう。ツイートを削除する流れは、下記の図のような流れで実行されます。</p>

<p class="ng-scope"><img src="014.png" alt="delete.png"></p>

<p class="ng-scope">作業手順はルーティングを設定することでビューに削除のパスを指定できるため、ルーティングの編集から始まります。</p>

<h3 class="ng-scope">
<i class="icon dashboard"></i> 作業内容</h3>

<h5 class="ng-scope">１．ツイートを削除するためのルーティングを設定する</h5>

<h5 class="ng-scope">２．削除ボタンをビューに追加する</h5>

<h5 class="ng-scope">３．destroyアクションをコントローラーに定義する</h5>

<h5 class="ng-scope">４．削除後のビューを追加する</h5>

<h2 id="19" class="ng-scope">1.ツイートを削除するためのルーティングを設定する</h2>

<p class="ng-scope">ツイート削除機能を実装するためにまずはルーティングを定義していきます。ツイートを削除する際にはツイートごとに固有のパスが発行されるので、ユーザーのマイページを作成したときと同様に少し特別なルーティングが必要になります。</p>

<p class="ng-scope">また、ツイートの削除を行なう際には<code>delete</code>というHTTPメソッドを利用します。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_366"></i> deleteメソッド</h3>

<p class="ng-scope">HTTPリクエストにはいくつかの種類があり、これまでに<code>get</code>メソッドと<code>post</code>メソッドを学習しました。</p>

<p class="ng-scope"><code>delete</code>メソッドは<strong>情報の削除を行なう際に利用するHTTPメソッド</strong>です。今回の場合、ツイートの削除を行なうので<code>delete</code>メソッドを利用します。また、<br>
ツイートの削除を行なう際には、<strong>tweetsコントローラー</strong>の<strong>destroyアクション</strong>を動かします。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> config/routes.rbを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">config/routes.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
    <span class="n">devise_for</span> <span class="ss">:users</span>
    <span class="n">root</span>  <span class="s1">'tweets#index'</span>
    <span class="n">get</span>   <span class="s1">'tweets'</span>      <span class="o">=&gt;</span>  <span class="s1">'tweets#index'</span>
    <span class="n">get</span>   <span class="s1">'tweets/new'</span>  <span class="o">=&gt;</span>  <span class="s1">'tweets#new'</span>
    <span class="n">post</span>  <span class="s1">'tweets'</span>      <span class="o">=&gt;</span>  <span class="s1">'tweets#create'</span>
<span class="hll">    <span class="n">delete</span>  <span class="s1">'tweets/:id'</span>  <span class="o">=&gt;</span> <span class="s1">'tweets#destroy'</span>
</span>    <span class="n">get</span>   <span class="s1">'users/:id'</span>  <span class="o">=&gt;</span>  <span class="s1">'users#show'</span>
  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">リクエストする箇所(ビュー)では、パスの<code>:id</code>の部分に<strong>削除するツイートのid</strong>が入るように記述します。すると、パラメーターがコントローラーに渡る際<code>params</code>のキーに<code>id</code>が追加され、そのバリューはリクエストの際に<code>:id</code>の部分に記述された値になります。つまり、<code>:id</code>の部分に記述された値はコントローラー上で<code>params[:id]</code>とすることで取得できます。</p>

<h2 id="20" class="ng-scope">2.削除ボタンをビューに追加する</h2>

<p class="ng-scope">ツイートを削除するためにビューファイルを編集して削除ボタンを追加します。今回は、<a href="http://master.tech-camp.in/curriculums/16#term_213">link_to</a>メソッドを使用しましょう。削除ボタンはツイートの表示画面の右上に配置されます。また、自分が投稿したツイートにのみ表示されるようにします。</p>

<p class="ng-scope"><code>link_to</code>メソッドを実装する際には<code>rake routes</code>コマンドを使用して、パスを確認する必要があります。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_367"></i> rake routes</h3>

<p class="ng-scope">このコマンドは現在定義しているルーティングを表示してくれるコマンドです。ターミナルで入力することで、<code>config/routes.rb</code>に記述したルーティングを表示してくれます。</p>

<h3 class="ng-scope">【例】</h3>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nv">$ </span>rake routes
</pre></div>
</td>
</tr></tbody></table>
</div>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">出力結果</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td>
<td class="code">
<div class="highlight"><pre>                  <span class="no">Prefix</span> <span class="no">Verb</span>   <span class="no">URI</span> <span class="no">Pattern</span>                    <span class="no">Controller</span><span class="c1">#Action</span>
        <span class="n">new_user_session</span> <span class="no">GET</span>    <span class="sr">/users/si</span><span class="n">gn_in</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>       <span class="n">devise</span><span class="o">/</span><span class="n">sessions</span><span class="c1">#new</span>
            <span class="n">user_session</span> <span class="no">POST</span>   <span class="sr">/users/si</span><span class="n">gn_in</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>       <span class="n">devise</span><span class="o">/</span><span class="n">sessions</span><span class="c1">#create</span>
    <span class="n">destroy_user_session</span> <span class="no">DELETE</span> <span class="sr">/users/si</span><span class="n">gn_out</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>      <span class="n">devise</span><span class="o">/</span><span class="n">sessions</span><span class="c1">#destroy</span>
           <span class="n">user_password</span> <span class="no">POST</span>   <span class="sr">/users/</span><span class="n">password</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>      <span class="n">devise</span><span class="o">/</span><span class="n">passwords</span><span class="c1">#create</span>
       <span class="n">new_user_password</span> <span class="no">GET</span>    <span class="sr">/users/</span><span class="n">password</span><span class="o">/</span><span class="kp">new</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>  <span class="n">devise</span><span class="o">/</span><span class="n">passwords</span><span class="c1">#new</span>
      <span class="n">edit_user_password</span> <span class="no">GET</span>    <span class="sr">/users/</span><span class="n">password</span><span class="o">/</span><span class="n">edit</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span> <span class="n">devise</span><span class="o">/</span><span class="n">passwords</span><span class="c1">#edit</span>
                         <span class="no">PATCH</span>  <span class="sr">/users/</span><span class="n">password</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>      <span class="n">devise</span><span class="o">/</span><span class="n">passwords</span><span class="c1">#update</span>
                         <span class="no">PUT</span>    <span class="sr">/users/</span><span class="n">password</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>      <span class="n">devise</span><span class="o">/</span><span class="n">passwords</span><span class="c1">#update</span>
<span class="n">cancel_user_registration</span> <span class="no">GET</span>    <span class="sr">/users/</span><span class="n">cancel</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>        <span class="n">devise</span><span class="o">/</span><span class="n">registrations</span><span class="c1">#cancel</span>
       <span class="n">user_registration</span> <span class="no">POST</span>   <span class="sr">/users(.:format)               devise/</span><span class="n">registrations</span><span class="c1">#create</span>
   <span class="n">new_user_registration</span> <span class="no">GET</span>    <span class="sr">/users/si</span><span class="n">gn_up</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>       <span class="n">devise</span><span class="o">/</span><span class="n">registrations</span><span class="c1">#new</span>
  <span class="n">edit_user_registration</span> <span class="no">GET</span>    <span class="sr">/users/e</span><span class="n">dit</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>          <span class="n">devise</span><span class="o">/</span><span class="n">registrations</span><span class="c1">#edit</span>
                         <span class="no">PATCH</span>  <span class="sr">/users(.:format)               devise/</span><span class="n">registrations</span><span class="c1">#update</span>
                         <span class="no">PUT</span>    <span class="sr">/users(.:format)               devise/</span><span class="n">registrations</span><span class="c1">#update</span>
                         <span class="no">DELETE</span> <span class="sr">/users(.:format)               devise/</span><span class="n">registrations</span><span class="c1">#destroy</span>
                    <span class="n">root</span> <span class="no">GET</span>    <span class="o">/</span>                              <span class="n">tweets</span><span class="c1">#index</span>
                  <span class="n">tweets</span> <span class="no">GET</span>    <span class="sr">/tweets(.:format)              tweets#index</span>
<span class="sr">                         POST   /</span><span class="n">tweets</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>              <span class="n">tweets</span><span class="c1">#create</span>
               <span class="n">new_tweet</span> <span class="no">GET</span>    <span class="sr">/tweets/ne</span><span class="n">w</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>          <span class="n">tweets</span><span class="c1">#new</span>
                   <span class="n">tweet</span> <span class="no">DELETE</span> <span class="sr">/tweets/</span><span class="ss">:id</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>          <span class="n">tweets</span><span class="c1">#destroy</span>
                    <span class="n">user</span> <span class="no">GET</span>    <span class="sr">/users/</span><span class="ss">:id</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>           <span class="n">users</span><span class="c1">#show</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><code>rake routes</code>コマンドを実行すると例えば上記のような出力結果が表示されます。（完全に同様の出力結果でなくても構いません。）この出力結果は以下のような意味を持っています。</p>

<table class="ng-scope">
<thead>
<tr>
<th style="text-align: left;">項目名</th>
<th style="text-align: left;">意味</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Prefix</td>
<td style="text-align: left;">「Prefix」はルーティングの名前を表しています。「Prefix」は設定を行わなくても、自動的に割り当てられますが、自ら設定することもできます。</td>
</tr>
<tr>
<td style="text-align: left;">Verb</td>
<td style="text-align: left;">「Verb」はHTTPメソッドを表しています。右側に表示されているパスにどのHTTPメソッドでアクセスするかを示しています。</td>
</tr>
<tr>
<td style="text-align: left;">URI Pattern</td>
<td style="text-align: left;">「URI Pattern」はルーティングのパスを表しています。このパスにアクセスされた際に、指定のコントローラーとアクションで処理が行われます。</td>
</tr>
<tr>
<td style="text-align: left;">Controller#Action</td>
<td style="text-align: left;">「Controller#Action」は指定したパスにアクセスした際に処理が行われるコントローラーとアクションを表しています。#以前がコントローラー名、#以後がアクション名を示しています。</td>
</tr>
</tbody>
</table>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題11：削除ボタンを作成しましょう</h3>
  <div class="challenge_box">
    <h5>作業ファイル：app/views/tweets/_tweet.html.erb</h5>
    <h5>ヒント1：下記の例をもとに、link_toメソッドを利用しましょう。</h5>
    <h5>ヒント2：rake routesで確認した、tweetsコントローラーのdestroyメソッドを動かすhttpメソッド/パスの組み合わせを書きましょう</h5>
    <h5>ヒント3：Rubyタグの中の文字列内で変数を使いたい場合は式展開#{}を使用します。詳しくは<a href="http://master.tech-camp.in/curriculums/25">トラブルシューティング(Rails編)</a>で確認しましょう。</h5>
    <h5>ヒント4：削除したいツイートを投稿したユーザーのidは変数`tweet`を使用して取得します。</h5>
    【例】
   <div class="code-frame" data-lang="rhtml">
<div class="code-lang"><span class="bold">_tweet.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"content_post"</span> <span class="na">style=</span><span class="s">"background-image: url(</span><span class="cp">&lt;%=</span> <span class="n">tweet</span><span class="o">.</span><span class="n">image</span> <span class="cp">%&gt;</span><span class="s">);"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">if</span> <span class="err">ユーザーがログインしているか？</span> <span class="err">かつ</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="err">削除したいツイートを投稿したユーザーの</span><span class="nb">id</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"more"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span&gt;</span><span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="s1">'arrow_top.png'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"more_list"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;li&gt;</span>
            <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'削除'</span><span class="p">,</span> <span class="s2">"/tweets/削除したいツイートのid"</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:HTTP</span><span class="err">メソッドを指定</span> <span class="cp">%&gt;</span>
         <span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">br</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"name"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/users/</span><span class="cp">&lt;%=</span> <span class="n">tweet</span><span class="o">.</span><span class="n">user_id</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span&gt;</span>投稿者<span class="nt">&lt;/span&gt;</span><span class="cp">&lt;%=</span> <span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">nickname</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/span&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>
    <curriculum-question-container class="ng-scope" data-order="5"><button style="" class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button style="" class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
  </div>
</div>

<h2 id="21" class="ng-scope">3.destroyアクションをコントローラーに定義する</h2>

<p class="ng-scope">ツイートを削除する際には<strong>tweetsコントローラー</strong>の<strong>destroyアクション</strong>を動かします。そこで、このアクションをコントローラーに定義していきましょう。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_368"></i> destroyメソッド</h3>

<p class="ng-scope">ActiveRecordメソッドのうちの一つで、インスタンスに対してそのレコードを削除する際に使うことができます。ターミナルで実行して確認してみましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> 以下の指示に従い、ターミナルからコマンドを実行しましょう</h3>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nv">$ </span>rails c
  <span class="o">[</span>1<span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; <span class="nv">tweet</span> <span class="o">=</span> Tweet.find<span class="o">(</span>今あるtweetsテーブルのid<span class="o">)</span>
  <span class="o">=</span>&gt; <span class="c">#&lt;Tweet:0x007ff621357720 id: 1, name: "george", text: "いい景色だ", image: "http://photo1.jpg", created_at: Thu, 16 Apr 2015 05:41:20 UTC +00:00, updated_at: Thu, 16 Apr 2015 05:41:20 UTC +00:00, user_id: 1&gt;]</span>
<span class="hll">  <span class="o">[</span>2<span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; tweet.destroy
</span></pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">すると、以下のような結果になり、レコードが削除されます。</p>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td>
<td class="code">
<div class="highlight"><pre>     <span class="o">(</span>0.2ms<span class="o">)</span>  BEGIN
    SQL <span class="o">(</span>1.6ms<span class="o">)</span>  DELETE FROM <span class="sb">`</span>tweets<span class="sb">`</span> WHERE <span class="sb">`</span>tweets<span class="sb">`</span>.<span class="sb">`</span>id<span class="sb">`</span> <span class="o">=</span> 1
     <span class="o">(</span>0.3ms<span class="o">)</span>  <span class="nv">COMMIT</span>
  <span class="o">=</span>&gt; <span class="c">#&lt;Tweet:0x007ff621357720 id: 1, name: "george", text: "いい景色だ", image: "http://photo1.jpg", created_at: Thu, 16 Apr 2015 05:41:20 UTC +00:00, updated_at: Thu, 16 Apr 2015 05:41:20 UTC +00:00, user_id: 1&gt;]</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">では、<code>tweets_controller</code>に<code>destroy</code>アクションを実装していきます。 ツイートを削除する際には<code>destroy</code>メソッドを使いましょう。また、パラメーターを使用する際には<code>params[:id]</code>を使用しましょう。</p>

<p class="ng-scope">削除を行えるのは、そのツイートを投稿したユーザーのみです。そのため、別のユーザーが削除をできないように条件をつける必要があります。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> app/controllers/tweets_controller.rbを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/tweets_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">TweetsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

    <span class="n">before_action</span> <span class="ss">:move_to_index</span><span class="p">,</span> <span class="ss">except</span><span class="p">:</span> <span class="ss">:index</span>

    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@tweets</span> <span class="o">=</span> <span class="no">Tweet</span><span class="o">.</span><span class="n">includes</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s2">"created_at DESC"</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="no">Tweet</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">image</span><span class="p">:</span> <span class="n">tweet_params</span><span class="o">[</span><span class="ss">:image</span><span class="o">]</span><span class="p">,</span> <span class="ss">text</span><span class="p">:</span> <span class="n">tweet_params</span><span class="o">[</span><span class="ss">:text</span><span class="o">]</span><span class="p">,</span> <span class="ss">user_id</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">end</span>

<span class="hll">    <span class="k">def</span> <span class="nf">destroy</span>
</span><span class="hll">      <span class="n">tweet</span> <span class="o">=</span> <span class="no">Tweet</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class="hll">      <span class="k">if</span> <span class="n">tweet</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span>
</span><span class="hll">        <span class="n">tweet</span><span class="o">.</span><span class="n">destroy</span>
</span><span class="hll">      <span class="k">end</span>
</span><span class="hll">    <span class="k">end</span>
</span>
    <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">tweet_params</span>
      <span class="n">params</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:image</span><span class="p">,</span> <span class="ss">:text</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">move_to_index</span>
      <span class="n">redirect_to</span> <span class="ss">action</span><span class="p">:</span> <span class="ss">:index</span> <span class="k">unless</span> <span class="n">user_signed_in?</span>
    <span class="k">end</span>
  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h2 id="22" class="ng-scope">4.削除後のビューを追加する</h2>

<p class="ng-scope">ルーティングとコントローラーの編集が終わったので、続いてビューファイルの追加を行ないます。このビューファイルはツイートの削除を行なったあとに呼び出されるビューファイルになります。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> 以下の指示に従い、app/views/tweets/destroy.html.erbを作成してください</h3>

<h3 class="ng-scope">①ファイルの新規作成</h3>

<p class="ng-scope">app/views/tweetsディレクトリの中に<code>destroy.html.erb</code>というファイルを作成してください</p>

<h3 class="ng-scope">②ファイルの編集</h3>

<p class="ng-scope">作成したファイルを、以下のように編集しましょう。</p>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/tweets/destroy.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="hll">  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"contents row"</span><span class="nt">&gt;</span>
</span><span class="hll">    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"success"</span><span class="nt">&gt;</span>
</span><span class="hll">      <span class="nt">&lt;h3&gt;</span>
</span><span class="hll">        削除が完了しました。
</span><span class="hll">      <span class="nt">&lt;/h3&gt;</span>
</span><span class="hll">      <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn"</span> <span class="na">href=</span><span class="s">"/"</span><span class="nt">&gt;</span>投稿一覧へ戻る<span class="nt">&lt;/a&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/div&gt;</span>
</span><span class="hll">  <span class="nt">&lt;/div&gt;</span>
</span></pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><i class="icon attention"></i>  このソースコードは、打ち間違いを防ぐためにコピー&amp;ペーストをしてもかまいません。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <a href="http://localhost:3000/">localhost:3000</a>にアクセスして、削除機能を試してみましょう</h3>

<p class="ng-scope">① ログインします。</p>

<p class="ng-scope">② ログインしたユーザーでツイートの投稿をします。一番上に表示されます。</p>

<p class="ng-scope"><img src="044.png" alt="投稿確認"></p>

<p class="ng-scope">③ 削除ボタンをクリックします。</p>

<p class="ng-scope"><img src="045.png" alt="削除ボタンを押す"></p>

<p class="ng-scope">④ 削除完了画面が表示されます。</p>

<p class="ng-scope"><img src="046.png" alt="削除確認画面"></p>

<p class="ng-scope">⑤ トップページに戻り、②のツイートがなくなっていれば、削除機能は実装完了です。</p>

<p class="ng-scope"><img src="047.png" alt="投稿一覧画面"></p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="347" action="http://master.tech-camp.in/curriculums/462#">
  <h4 class="ng-binding">
    <i class="icon check_icon_02"></i>課題チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-490" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-490" name="check-490" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">ツイートの削除機能を実装することができた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h1 id="23" class="ng-scope">Level12：ツイートの編集機能を追加しよう</h1>

<p class="ng-scope">今回の作業ではツイートの編集機能を実装します。編集を行なう際には編集ページを用意して、そのページから編集を行なうようにします。</p>

<h3 class="ng-scope">
<i class="icon dashboard"></i> 作業内容</h3>

<h5 class="ng-scope">１．ツイート編集画面のルーティングを設定する</h5>

<h5 class="ng-scope">２．編集ボタンをビューに追加する</h5>

<h5 class="ng-scope">３．editアクションをコントローラーに定義する</h5>

<h5 class="ng-scope">４．編集画面のビューファイルを作成する</h5>

<h5 class="ng-scope">５．ツイートの更新を行なうためのルーティングを設定する</h5>

<h5 class="ng-scope">６．updateアクションをコントローラーに定義する</h5>

<h5 class="ng-scope">７．更新後のビューファイルを追加する</h5>

<h2 id="24" class="ng-scope">1.ツイート編集画面のルーティングを設定する</h2>

<p class="ng-scope">ツイートを編集する際は、ツイートを編集するための画面に遷移したあとに、ツイートの編集を行ないます。今回の作業では、編集画面へ遷移するためのルーティングを設定します。</p>

<p class="ng-scope">編集画面への遷移にはコントローラー<strong>tweetsコントローラー</strong>の<strong>editアクション</strong>を動かします。また、編集画面のパスはツイートごとに異なるものになるので、destroyメソッドの時と同じように<code>:id</code>のような書き方を利用します。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> config/routes.rbを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">config/routes.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
    <span class="n">devise_for</span> <span class="ss">:users</span>
    <span class="n">root</span>  <span class="s1">'tweets#index'</span>
    <span class="n">get</span>   <span class="s1">'tweets'</span>      <span class="o">=&gt;</span>  <span class="s1">'tweets#index'</span>
    <span class="n">get</span>   <span class="s1">'tweets/new'</span>  <span class="o">=&gt;</span>  <span class="s1">'tweets#new'</span>
    <span class="n">post</span>  <span class="s1">'tweets'</span>      <span class="o">=&gt;</span>  <span class="s1">'tweets#create'</span>
    <span class="n">delete</span>  <span class="s1">'tweets/:id'</span>  <span class="o">=&gt;</span> <span class="s1">'tweets#destroy'</span>
<span class="hll">    <span class="n">get</span>   <span class="s1">'tweets/:id/edit'</span>  <span class="o">=&gt;</span> <span class="s1">'tweets#edit'</span>
</span>    <span class="n">get</span>   <span class="s1">'users/:id'</span>  <span class="o">=&gt;</span>  <span class="s1">'users#show'</span>
  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h2 id="25" class="ng-scope">2.編集ボタンをビューに追加する</h2>

<p class="ng-scope">ツイートを編集する画面に遷移するためのボタンを作成します。編集ボタンは、削除ボタンの上に表示されるようにしましょう。削除ボタンと同じように、<code>link_to</code>メソッドを使用します。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> app/views/tweets/_tweet.html.erbを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/tweets/_tweet.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"content_post"</span> <span class="na">style=</span><span class="s">"background-image: url(</span><span class="cp">&lt;%=</span> <span class="n">tweet</span><span class="o">.</span><span class="n">image</span> <span class="cp">%&gt;</span><span class="s">);"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">user_signed_in?</span> <span class="o">&amp;&amp;</span> <span class="n">tweet</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"more"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span&gt;</span><span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="s1">'arrow_top.png'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"more_list"</span><span class="nt">&gt;</span>
<span class="hll">          <span class="nt">&lt;li&gt;</span>
</span><span class="hll">            <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'編集'</span><span class="p">,</span> <span class="s2">"/tweets/</span><span class="si">#{</span><span class="n">tweet</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">/edit"</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:get</span> <span class="cp">%&gt;</span>
</span><span class="hll">          <span class="nt">&lt;/li&gt;</span>
</span>          <span class="nt">&lt;li&gt;</span>
            <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'削除'</span><span class="p">,</span> <span class="s2">"/tweets/</span><span class="si">#{</span><span class="n">tweet</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:delete</span> <span class="cp">%&gt;</span>
          <span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">br</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"name"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/users/</span><span class="cp">&lt;%=</span> <span class="n">tweet</span><span class="o">.</span><span class="n">user_id</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span&gt;</span>投稿者<span class="nt">&lt;/span&gt;</span><span class="cp">&lt;%=</span> <span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">nickname</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/span&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h2 id="26" class="ng-scope">3.editアクションをコントローラーに定義する</h2>

<p class="ng-scope">ツイートを編集する画面を表示する際には<strong>tweetsコントローラー</strong>の<strong>editアクション</strong>を使用します。そこで、コントローラーにeditアクションを作成していきます。</p>

<p class="ng-scope">現在実装している<strong>編集して更新</strong>、という流れは、<strong>入力して新規投稿</strong>、という流れと似ています。新規作成時と違うのは、編集→更新の場合は<strong>既に存在しているレコードを選択して中身を書き換える</strong>という点です。そのため、<code>edit</code>アクションでは編集したいレコードを<code>@tweet</code>に代入し、編集画面で利用できるようにします。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> app/controllers/tweets_controllerを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/tweets_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">TweetsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

    <span class="n">before_action</span> <span class="ss">:move_to_index</span><span class="p">,</span> <span class="ss">except</span><span class="p">:</span> <span class="ss">:index</span>

    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@tweets</span> <span class="o">=</span> <span class="no">Tweet</span><span class="o">.</span><span class="n">includes</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s2">"created_at DESC"</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="no">Tweet</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">image</span><span class="p">:</span> <span class="n">tweet_params</span><span class="o">[</span><span class="ss">:image</span><span class="o">]</span><span class="p">,</span> <span class="ss">text</span><span class="p">:</span> <span class="n">tweet_params</span><span class="o">[</span><span class="ss">:text</span><span class="o">]</span><span class="p">,</span> <span class="ss">user_id</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">destroy</span>
      <span class="n">tweet</span> <span class="o">=</span> <span class="no">Tweet</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
      <span class="n">tweet</span><span class="o">.</span><span class="n">destroy</span> <span class="k">if</span> <span class="n">tweet</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span>
    <span class="k">end</span>

<span class="hll">    <span class="k">def</span> <span class="nf">edit</span>
</span><span class="hll">      <span class="vi">@tweet</span> <span class="o">=</span> <span class="no">Tweet</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class="hll">    <span class="k">end</span>
</span>
    <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">tweet_params</span>
      <span class="n">params</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:image</span><span class="p">,</span> <span class="ss">:text</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">move_to_index</span>
      <span class="n">redirect_to</span> <span class="ss">action</span><span class="p">:</span> <span class="ss">:index</span> <span class="k">unless</span> <span class="n">user_signed_in?</span>
    <span class="k">end</span>
  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h2 id="27" class="ng-scope">4.編集画面のビューファイルを作成する</h2>

<p class="ng-scope">ルーティングとコントローラーの編集が終わったので、ビューファイルを作成します。このビューはツイートを編集するためのビューファイルです。そのため、ツイートの投稿画面と同様に情報を入力するためのフォームが必要になります。</p>

<p class="ng-scope">入力情報の送信先は<code>/tweets/編集するツイートのid</code>となります。また、情報を送信する際には<code>patch</code>というHTTPメソッドを使用します。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_369"></i> patchメソッド</h3>

<p class="ng-scope">HTTPリクエストには<code>get</code>、<code>post</code>、<code>delete</code>メソッドがあることは学習しました。<code>patch</code>メソッドは情報の更新を行なう際に使用します。今回はツイート情報を更新する機能を実装するので、<code>patch</code>メソッドを使用します。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_370"></i> HTTPリクエスト</h3>

<p class="ng-scope">これまでに4種類のHTTPリクエストのメソッドについて学習しました。Railsではこれら4つのメソッドを利用して開発を行ないます。役割や機能を以下の表にまとめたので再度確認しましょう。</p>

<table class="ng-scope">
<thead>
<tr>
<th style="text-align: left;">メソッド</th>
<th style="text-align: left;">役割</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">get</td>
<td style="text-align: left;">サーバーからブラウザに情報を返す。<strong>単にウェブサイトを閲覧する</strong>際にはこのメソッドが利用されている。</td>
</tr>
<tr>
<td style="text-align: left;">post</td>
<td style="text-align: left;">ブラウザからサーバーに情報を送信し、サーバーに情報を保存する。<strong>情報の登録</strong>などの際に、サーバーに情報を送信するために利用される。</td>
</tr>
<tr>
<td style="text-align: left;">delete</td>
<td style="text-align: left;">ブラウザからサーバーに情報を送信し、サーバーの情報を削除する。<strong>アカウントの削除</strong>などの際に、サーバー内のデータを削除するために利用される。</td>
</tr>
<tr>
<td style="text-align: left;">patch</td>
<td style="text-align: left;">ブラウザからサーバーに情報を送信し、サーバー内の情報を置き換える。<strong>登録情報の更新</strong>などの際に、サーバー内のデータを更新するために利用される。</td>
</tr>
<tr>
<td style="text-align: left;">put</td>
<td style="text-align: left;">メソッド名は違うが、patchと同じ役割を持っている。rails3まではputを使っていたが、rails4からはpatchに移行したためカリキュラム内では使用しない。</td>
</tr>
</tbody>
</table>

<p class="ng-scope">フォームを作成する際には<strong>フォームの初期値として、編集前のツイート情報を表示</strong>します。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> 以下の指示に従い、app/views/tweets/edit.html.erbを作成してください</h3>

<h3 class="ng-scope">①ファイルの新規作成</h3>

<p class="ng-scope">app/views/tweetsディレクトリの中に<code>edit.html.erb</code>というファイルを作成してください</p>

<h3 class="ng-scope">②ファイルの編集</h3>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題12：編集画面を作成しましょう</h3>
  <div class="challenge_box">
    <h5>作業ファイル：app/views/tweets/edit.html.erb</h5>
    <h5>ヒント1：下記の例をもとに編集画面を作成しましょう。</h5>
    <h5>ヒント2：このビューでは、コントローラーで定義した@tweetを利用できます。@tweetには、編集したいレコードが代入されています。</h5>
    <h5>ヒント3：form_tagメソッドのあたりは、tweetsのnewアクションのビューを参考にしましょう。</h5>
    <h5>ヒント4：編集前の値を表示するには、タグを利用する必要があります。</h5>
    【例】
    <div class="code-frame" data-lang="rhtml">
<div class="code-lang"><span class="bold">edit.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"contents row"</span><span class="nt">&gt;</span>
    form_tagメソッドを使って「/tweets/編集するツイートのid」に「patch」メソッドで情報を送信
      <span class="nt">&lt;h3&gt;</span>
        編集する
      <span class="nt">&lt;/h3&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">placeholder=</span><span class="s">"Image Url"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"image"</span> <span class="na">value=</span><span class="s">編集前の初期値を表示</span> <span class="na">autofocus=</span><span class="s">"true"</span><span class="nt">&gt;&lt;/input&gt;</span>
      <span class="nt">&lt;textarea</span> <span class="na">cols=</span><span class="s">"30"</span> <span class="na">name=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"text"</span> <span class="na">rows=</span><span class="s">"10"</span><span class="nt">&gt;</span>編集前の初期値を表示<span class="nt">&lt;/textarea&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"SENT"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>
    <curriculum-question-container class="ng-scope" data-order="6"><button style="" class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button style="" class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
  </div>
</div>

<h2 id="28" class="ng-scope">5.ツイートの更新を行なうためのルーティングを設定する</h2>

<p class="ng-scope">ツイートの編集画面を作成することができたので、続いてツイートの更新機能を実装していきます。まずはツイートの更新を行なうためのルーティングを設定していきます。</p>

<p class="ng-scope">ツイートを更新する際には<code>/tweets/編集するツイートのid</code>に<code>patch</code>メソッドでアクセスします。このパスにアクセスした際に<strong>tweetsコントローラー</strong>の<strong>updateアクション</strong>が動くようにします。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> config/routes.rbを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">config/routes.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
    <span class="n">devise_for</span> <span class="ss">:users</span>
    <span class="n">root</span>  <span class="s1">'tweets#index'</span>
    <span class="n">get</span>   <span class="s1">'tweets'</span>      <span class="o">=&gt;</span>  <span class="s1">'tweets#index'</span>
    <span class="n">get</span>   <span class="s1">'tweets/new'</span>  <span class="o">=&gt;</span>  <span class="s1">'tweets#new'</span>
    <span class="n">post</span>  <span class="s1">'tweets'</span>      <span class="o">=&gt;</span>  <span class="s1">'tweets#create'</span>
    <span class="n">delete</span>  <span class="s1">'tweets/:id'</span>  <span class="o">=&gt;</span> <span class="s1">'tweets#destroy'</span>
<span class="hll">    <span class="n">patch</span>   <span class="s1">'tweets/:id'</span>  <span class="o">=&gt;</span> <span class="s1">'tweets#update'</span>
</span>    <span class="n">get</span>   <span class="s1">'tweets/:id/edit'</span>  <span class="o">=&gt;</span> <span class="s1">'tweets#edit'</span>
    <span class="n">get</span>   <span class="s1">'users/:id'</span>  <span class="o">=&gt;</span>  <span class="s1">'users#show'</span>
  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h2 id="29" class="ng-scope">6.updateアクションをコントローラーに定義する</h2>

<p class="ng-scope">ツイートを更新する際には<strong>tweetsコントローラー</strong>の<strong>updateアクション</strong>を使用します。updateアクション内ではActiveRecordメソッドの<code>update</code>を使用します。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_371"></i> updateメソッド</h3>

<p class="ng-scope"><code>update</code>はActiveRecordメソッドのうちの一つです。<code>update</code>メソッドはモデルのインスタンスに対して使用することで、引数内の情報にレコードを更新することができます。</p>

<h3 class="ng-scope">【例】</h3>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">コンソール</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="o">[</span>1<span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; <span class="nv">tweet</span> <span class="o">=</span> Tweet.create<span class="o">(</span>user_id: 1, text: <span class="s2">"Hello"</span>, image: <span class="s2">"test.jpg"</span><span class="o">)</span>
<span class="hll">  <span class="o">=</span>&gt; ＃&lt;Tweet id: 1, user_id: 1, text: <span class="s2">"Hello"</span>, image: <span class="s2">"test.jpg"</span>, created_at: <span class="s2">"2014-12-10 00:00:00"</span>, updated_at: <span class="s2">"2014-12-10 00:00:00"</span>&gt;
</span>  <span class="o">[</span>2<span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; tweet.update<span class="o">(</span>text: <span class="s2">"Thank you!"</span><span class="o">)</span>
  <span class="o">=</span>&gt; <span class="nb">true</span>
  <span class="o">[</span>3<span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; <span class="nv">tweet</span>
<span class="hll">  <span class="o">=</span>&gt; ＃&lt;Tweet id: 1, user_id: 1, text: <span class="s2">"Thank you!"</span>, image: <span class="s2">"test.jpg"</span>, created_at: <span class="s2">"2014-12-10 00:00:00"</span>, updated_at: <span class="s2">"2014-12-10 00:01:00"</span>&gt;
</span></pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><code>update</code>メソッドの引数は、<code>update(カラム名: 更新する情報)</code>という形で指定します。同時に複数の情報を更新する場合には<code>update(カラム1: 更新情報1, カラム2: 更新情報2)</code>という形で使用することができます。<code>create</code>メソッドと似ていますね。</p>

<div class="challenge ng-scope">

  <h3>
<i class="icon crown"></i> 問題13：updateアクションを実装しましょう</h3>
  <div class="challenge_box">
    <h5>作業ファイル：app/controllers/tweets_controller</h5>
    <h5>ヒント1：destroyアクションの実装の時と同じような流れです。</h5>
    <h5>ヒント2：ツイートを更新する際にはActiveRecordメソッドのupdateメソッドを使用しましょう。また、updateメソッドの引数にはtweet_paramsを使用しましょう。</h5>

    <curriculum-question-container class="ng-scope" data-order="7"><button style="" class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button style="" class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
  </div>
</div>

<h2 id="30" class="ng-scope">7.更新後のビューファイルを追加する</h2>

<p class="ng-scope">ルーティングとコントローラーの編集が終わったので、続いてビューファイルの追加を行ないます。このビューファイルはツイートの更新を行なったあとに呼び出されるビューファイルになります。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> 以下の指示に従い、app/views/tweets/update.html.erbを作成してください。</h3>

<h3 class="ng-scope">①ファイルの新規作成</h3>

<p class="ng-scope">app/views/tweetsディレクトリの中に<code>update.html.erb</code>というファイルを作成してください。</p>

<h3 class="ng-scope">
<i class="icon newfile"></i> 新規作成されるファイル</h3>

<ul class="ng-scope">
<li>app/views/tweets/update.html.erb</li>
</ul>

<h3 class="ng-scope">②ファイルの編集</h3>

<ul class="ng-scope">
<li>作成したファイルを、以下のように編集しましょう。</li>
</ul>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/tweets/update.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="hll">  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"contents row"</span><span class="nt">&gt;</span>
</span><span class="hll">    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"success"</span><span class="nt">&gt;</span>
</span><span class="hll">      <span class="nt">&lt;h3&gt;</span>
</span><span class="hll">        更新が完了しました。
</span><span class="hll">      <span class="nt">&lt;/h3&gt;</span>
</span><span class="hll">      <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn"</span> <span class="na">href=</span><span class="s">"/"</span><span class="nt">&gt;</span>投稿一覧へ戻る<span class="nt">&lt;/a&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/div&gt;</span>
</span><span class="hll">  <span class="nt">&lt;/div&gt;</span>
</span></pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="348" action="http://master.tech-camp.in/curriculums/462#">
  <h4 class="ng-binding">
    <i class="icon check_icon_02"></i>課題チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-491" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-491" name="check-491" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">ツイートの更新機能を実装することができた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h3 class="ng-scope">
<i class="icon pen"></i> <a href="http://localhost:3000/">localhost3000</a>にアクセスして編集機能を試しましょう</h3>

<p class="ng-scope">① ログインします。</p>

<p class="ng-scope">② ツイートを投稿します。</p>

<p class="ng-scope">③ ②で投稿したツイートは一番上にあります。そのツイートの編集ボタンをクリックします。</p>

<p class="ng-scope"><img src="048.png" alt="編集ボタン"></p>

<p class="ng-scope">④ 編集画面が表示されるので、テキストを変更しましょう。</p>

<p class="ng-scope"><img src="049.png" alt="編集画面"></p>

<p class="ng-scope">⑤ 更新完了画面が表示されます。</p>

<p class="ng-scope"><img src="050.png" alt="投稿完了画面"></p>

<p class="ng-scope">⑥ トップページに戻り、一番上のツイートのテキストが変更されていることを確認します。</p>

<p class="ng-scope"><img src="051.png" alt="投稿一覧画面"></p>

<p class="ng-scope">⑦ これで編集機能実装は完了です。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_372"></i> Railsのリソースの7つのアクション</h3>

<p class="ng-scope">今までのPicTweetの製作を通じて下記の7つのアクションを使ってきました。Railsでは、7つの基本アクションへのリクエストが下記の通りデフォルトで設定されています。これらのリクエストは、<code>routes.rb</code>に<code>resources :ルーティングを設定したいコントローラー名</code>と書くだけで反映させることができます。</p>

<p class="ng-scope">アプリケーションの作成において何か機能を追加したい時は、まずはこの7つのアクションに当てはまる機能かを考え、そうであれば積極的に利用しましょう。ルーティングを楽に設定できると同時に、他の人がコードを読む際わかりやすいという利点があります。</p>

<table class="ng-scope">
<thead>
<tr>
<th style="text-align: left;">Railsのリソースの7つのアクション</th>
<th style="text-align: left;">役割</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">index</td>
<td style="text-align: left;">リソースの一覧を表示する。</td>
</tr>
<tr>
<td style="text-align: left;">show</td>
<td style="text-align: left;">リソースの内容を表示する。</td>
</tr>
<tr>
<td style="text-align: left;">new</td>
<td style="text-align: left;">リソースを追加する。</td>
</tr>
<tr>
<td style="text-align: left;">create</td>
<td style="text-align: left;">リソースを追加し、作成する。</td>
</tr>
<tr>
<td style="text-align: left;">edit</td>
<td style="text-align: left;">リソースを更新するためのフォームを表示する。</td>
</tr>
<tr>
<td style="text-align: left;">update</td>
<td style="text-align: left;">リソースを更新する。</td>
</tr>
<tr>
<td style="text-align: left;">destroy</td>
<td style="text-align: left;">リソースを削除する。</td>
</tr>
</tbody>
</table>

<h1 id="31" class="ng-scope">以上で、Ruby on Rails 1章のカリキュラムは全て終了です</h1>

<p class="ng-scope">お疲れ様でした。これでRuby on Railsの基礎知識の学習は終わりです。<br><br>
最後に見本のソースコードをダウンロードして自分のソースコードと照らし合わせてみましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <a href="http://master.tech-camp.in/files/rails1/pictweet.zip" target="_top">こちらのリンク</a>から見本のソースコードをダウンロードしましょう。</h3>

<p class="ng-scope">Rails 1章を通して学んだ中で、まだ完全に理解ができていないところもあると思います。<br>
この状況から脱するためには、薄塗りでも良いのでひたすら量をこなすことが有効です。<br>
ですので、ここまでで理解が不足していると思う方や応用カリキュラムに進み理解が追いつかないと感じてきた方は、もう一度<a href="http://master.tech-camp.in/curriculums/10">Rails1-0</a>から取り組んでみましょう。<br>
そうすることで、プログラミングに対する理解はさらに深まります。</p>

<h1 id="32" class="ng-scope">アプリケーション開発に挑戦</h1>

<p class="ng-scope">さて、Nekotter開発もいよいよ佳境です。こちらもキチンと完成させることができれば、Railsの基礎は身についたといっても過言ではありません。<br>
<a href="http://master.tech-camp.in/curriculums/347" target="_top">Nekotter開発③</a></p>

<h3 class="ng-scope">動画で開発の様子を確認</h3>

<p class="ng-scope">問題を解き終えたら、実際にNekotterを開発しつつRailsのポイントに関して解説している動画を見て、理解を深めましょう。</p>

<p class="ng-scope"><a href="http://master.tech-camp.in/curriculums/362" target="_top">Nekotter開発動画カリキュラム③</a></p>

<h1 id="33" class="ng-scope">今後のカリキュラムの進め方</h1>

<h3 class="ng-scope">これで、基本カリキュラムは終了となります</h3>

<p class="ng-scope">ここまで本当にお疲れ様でした。</p>

<p class="ng-scope">皆さんはこれで「RailsによってWebアプリケーションを作成できるだけの技術力」を身につけました。</p>

<p class="ng-scope"><strong>TECH::CAMPの目標を、見事達成したことになります！</strong></p>

<p class="ng-scope">既に、実際に世の中にあるサービスがどのような仕組みで動いているのかをある程度推測することができると思います。</p>

<p class="ng-scope">あとは実践あるのみです。</p>

<h2 id="34" class="ng-scope">応用カリキュラムに進もう</h2>

<p class="ng-scope">応用カリキュラムでは、学習の目的に応じて様々な内容を学ぶことができます。オリジナルアプリケーションを作ったり、さらに応用的なWebアプリケーションの作り方を学ぶカリキュラムなどがあります。</p>

<p class="ng-scope"><strong>全てのカリキュラムを順番に進める必要はありません。目的に応じて、学ぶカリキュラムを選択してください。</strong></p>

<h3 class="ng-scope">応用カリキュラムの内容紹介</h3>

<p class="ng-scope">応用カリキュラムの内容を紹介します。</p>

<h4 class="ng-scope">Lesson1 Railsアプリケーション2</h4>

<p class="ng-scope">Pictweetよりもさらに応用的な内容を学びます。オリジナルアプリケーションを作成する上で参考になる実装もたくさん含まれています。</p>

<h4 class="ng-scope">Lesson2 Git</h4>

<p class="ng-scope">プログラマーがアプリケーションを作成していく際にあると便利な<strong>Git</strong>というツールを学びます。簡単に言えば、コードを書いていく中で「セーブポイント」を作ることができるツールです。作ったセーブポイントには、いつでも戻ることができます。思わぬバグが起こった時などに便利です。</p>

<h4 class="ng-scope">Lesson3 オリジナルアプリケーション作成</h4>

<p class="ng-scope">オリジナルアプリケーションを作成するための手順が書かれています。オリジナルアプリケーションを作成する際は、必ず読むようにしましょう。なお、オリジナルアプリケーション作成の際は必ずメンターに相談していただきます。こちらの方法も、このカリキュラム内にかかれています。</p>

<h4 class="ng-scope">Lesson4 Javascript基礎</h4>

<p class="ng-scope">Javascriptという新しい言語を学びます。リッチな見た目を作成することが可能になります。</p>

<h4 class="ng-scope">Lesson5 Railsアプリケーション3</h4>

<p class="ng-scope">TwitterやFacebookなどと同じ、SNSに分類されるWebアプリケーションを作成します。さらに複雑な実装を含んでいるので、作成したいオリジナルアプリケーションの内容によってはこちらの学習をおすすめする場合があります。</p>

<h3 class="ng-scope">応用カリキュラムの進め方</h3>

<h3 class="ng-scope">作りたいオリジナルアプリケーションがある場合</h3>

<p class="ng-scope">おすすめの進め方は、まず以下のカリキュラムを参考にオリジナルアプリケーションの作成を考えてみることです。</p>

<p class="ng-scope"><a href="http://master.tech-camp.in/curriculums/205">オリジナルアプリケーション作成の手引</a></p>

<p class="ng-scope">自分で企画を考え、実装の方法を考えることが一番の勉強方法だからです。<strong>わからないことがあれば、ご遠慮無くメンターに質問してください。</strong></p>

<h3 class="ng-scope">作りたいものが見つからない、または知見として技術を身につけたい場合</h3>

<p class="ng-scope">まずは<a href="http://master.tech-camp.in/curriculums/17">Lesson1 Railsアプリケーション2</a>に取り組み、もうひとつRailsアプリケーションを作ってみましょう。Pictweetでは触れなかった様々なバリエーションの実装を体験することができます。</p>
</div>
          <!-- ngIf: curriculum.short_test --><div ng-if="curriculum.short_test" class="short_test-box ng-scope">
  <div class="short_test-title">
    <h4>
      確認問題
    </h4>
    <p>
      お疲れ様でした！このカリキュラムの終わりに確認問題を解きましょう。
    </p>
  </div>
  <div class="short_test_score" id="shortTestInfo"></div>
  <div class="short_test-button">
    <a class="curriculum-short-test-button" ng-click="showShortTest(curriculum.short_test.id)">確認テストに挑戦する！</a>
  </div>
</div><!-- end ngIf: curriculum.short_test -->
        </div>
      </div>
      <div class="col-md-3 col-sm-12" id="curriculumSideContainer">
        <curriculum-side-wrap id="sideWrap">
          <ul style="max-height: 347px;" class="list-group toc-tree" id="curriculumContents">
  <li class="list-group-item disabled">
    目次
  </li>
  <!-- ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding current" id="contents1" ng-click="clickContent(content.h1.id)">Level7：ツイートにユーザー情報を追加しよう</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents2" ng-click="clickContent(h2.id)">1.tweetsテーブルにカラムを追加する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents3" ng-click="clickContent(h2.id)">2.ツイート保存時にユーザー情報を追加する処理を記述する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents4" ng-click="clickContent(h2.id)">ツイート保存時にユーザー情報も保存できたか確かめる</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents5" ng-click="clickContent(content.h1.id)">Level8：マイページを作成しよう</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents6" ng-click="clickContent(h2.id)">1.マイページのルーティングを記述する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents7" ng-click="clickContent(h2.id)">2.コントローラーとアクションを作成する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents8" ng-click="clickContent(h2.id)">3.マイページ用のビューファイルを作成する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents9" ng-click="clickContent(content.h1.id)">Level9：アソシエーションを利用しよう</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents10" ng-click="clickContent(h2.id)">1.アソシエーションを定義する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents11" ng-click="clickContent(h2.id)">2.アソシエーションを実装する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents12" ng-click="clickContent(content.h1.id)">Level10：ツイート一覧画面にニックネームを表示しよう</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents13" ng-click="clickContent(h2.id)">1.投稿者名を表示するようにビューを変更する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents14" ng-click="clickContent(h2.id)">2.ツイートからユーザー情報を先読みする</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents15" ng-click="clickContent(h2.id)">3.投稿画面のビューを変更する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents16" ng-click="clickContent(h2.id)">4.投稿時のコントローラーでの処理を変更する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents17" ng-click="clickContent(h2.id)">5.tweetsテーブルから不要なカラムを削除する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents18" ng-click="clickContent(content.h1.id)">Level11：ツイートの削除機能を追加しよう</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents19" ng-click="clickContent(h2.id)">1.ツイートを削除するためのルーティングを設定する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents20" ng-click="clickContent(h2.id)">2.削除ボタンをビューに追加する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents21" ng-click="clickContent(h2.id)">3.destroyアクションをコントローラーに定義する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents22" ng-click="clickContent(h2.id)">4.削除後のビューを追加する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents23" ng-click="clickContent(content.h1.id)">Level12：ツイートの編集機能を追加しよう</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents24" ng-click="clickContent(h2.id)">1.ツイート編集画面のルーティングを設定する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents25" ng-click="clickContent(h2.id)">2.編集ボタンをビューに追加する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents26" ng-click="clickContent(h2.id)">3.editアクションをコントローラーに定義する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents27" ng-click="clickContent(h2.id)">4.編集画面のビューファイルを作成する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents28" ng-click="clickContent(h2.id)">5.ツイートの更新を行なうためのルーティングを設定する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents29" ng-click="clickContent(h2.id)">6.updateアクションをコントローラーに定義する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents30" ng-click="clickContent(h2.id)">7.更新後のビューファイルを追加する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents31" ng-click="clickContent(content.h1.id)">以上で、Ruby on Rails 1章のカリキュラムは全て終了です</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents32" ng-click="clickContent(content.h1.id)">アプリケーション開発に挑戦</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents33" ng-click="clickContent(content.h1.id)">今後のカリキュラムの進め方</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents34" ng-click="clickContent(h2.id)">応用カリキュラムに進もう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents -->
</ul>
          <div style="" ng-show="check_count > 0" class="progress_box ng-scope">
  <!-- ngIf: showTroubleShooting() -->
  <!-- ngIf: courseId != 9 && courseId != 10 --><p class="terms ng-scope" ng-if="courseId != 9 &amp;&amp; courseId != 10">
    分からない用語がある時：<br><a href="http://master.tech-camp.in/terms" target="_brank">用語一覧集</a>
  </p><!-- end ngIf: courseId != 9 && courseId != 10 -->
  <h4>
    進捗度<i class="ng-binding" id="numerator">6 / 6<span id="denominaotr"></span></i>
  </h4>
  <div class="progress">
    <div aria-valuemax="100" aria-valuemin="0" aria-valuenow="100" class="pregress-bar progress-bar-info ng-binding" role="progressbar" style="width: 100%;">
      100%
    </div>
  </div>
</div>
          <curriculum-glossary class="ng-hide" ng-show="curriculum.curriculum_type == 2 || curriculum.curriculum_type == 3"></curriculum-glossary>
          <button class="curriculum-report-button" ng-click="show_curriculum_report()">
            <img src="idea.svg" height="20px" width="20px">
            | このカリキュラムへのご要望
          </button>
        </curriculum-side-wrap>
      </div>
    </div>
    <ul style="" class="pager" ng-hide="loading">
  <li class="previous">
    <a style="" class="" ng-click="go_previous()" ng-show="curriculum.previous_id">前のカリキュラム</a>
  </li>
  <li class="next">
    <a class="ng-hide" ng-class="{ disable: curriculum.short_test.can_see_next_curriculum == false }" ng-click="go_next()" ng-show="curriculum.next_id">次のカリキュラム</a>
  </li>
</ul>
  </div>
</curriculum>
<div style="" class="ng-scope ng-isolate-scope ng-hide" id="loading" ng-show="loading">
  <svg height="44" stroke="#444" viewBox="0 0 44 44" width="44" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" strole-width="2"><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="0s" calcMode="spline" dur="1.8s" keySplines="0.165, 0.84, 0.44, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 20"></animate><animate attributeName="stroke-opacity" begin="0s" calcMode="spline" dur="1.8s" keySplines="0.3, 0.61, 0.355, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 0"></animate></circle><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="-0.9s" calcMode="spline" dur="1.8s" keySplines="0.165, 0.84, 0.44, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 20"></animate><animate attributeName="stroke-opacity" begin="-0.9s" calcMode="spline" dur="1.8s" keySplines="0.3, 0.61, 0.355, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 0"></animate></circle></g></svg>
</div>

<div class="curriculum-image__modal modal ng-scope" id="curriculum-image__modal" role="dialog" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button class="close" data-dismiss="modal" ng-click="close()"><span aria-hidden="true">×</span></button>
      </div>
      <div class="modal-body">
        <div class="curriculum-image__img__body">
          <img class="curriculum-image__img zoom-out" id="curriculum-image__img">
        </div>
      </div>
    </div>
  </div>
</div>


</div><div class="chat-window ng-scope" ng-controller="SupportChatController" ng-init="init('大宅誠人', '/uploads/noimage.png', 1867, 2988, 0, 'accepted_questions', 'machi4271', '2')"><div aria-hidden="true" aria-labelledby="myLargeModalLabel" class="modal fade" id="chats-modal" role="dialog" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="wrapper">
  <header class="chat-header">
    <div class="row">
      <div class="col-md-6 col-xs-12 chat-header-left">
        <h2>
          質問チャット
        </h2>
        <div class="chat-support-state active in-support ng-binding">
          <img src="icn_qsupport.png" width="16">質問受付中
        </div>
      </div>
    </div>
  </header>
  <div class="chat-layout" load-more="load-more">
    <!-- ngRepeat: message in messages -->
  </div>
</div><footer class="chat-footer"><form accept-charset="UTF-8" action="http://master.tech-camp.in/api/chat_messages" class="new_chat_message ng-pristine ng-valid" data-remote="true" enctype="multipart/form-data" id="new_chat_message" method="post" ng_submit="afterSubmitted()"><div style="display: none;"><input name="utf8" value="✓" type="hidden"></div><input id="chat_message_chat_id" name="chat_message[chat_id]" value="2988" type="hidden"><div class="chat-box"><div class="row"><div class="chat-upload col-xs-1"><div class="chat-upload-btn"><img class="chat-upload-icn" src="icn_fileupload.png"><input class="ng-pristine ng-untouched ng-valid" id="chat_message_file" name="chat_message[file]" ng_model="file" onchange="angular.element(this).scope().showSubmitButtonAndHideSkypeButtonAndPreview()" type="file"><div class="chat-uploading-image ng-hide" ng-show="isUploading" ng-style="isUploadingStyle"><div class="image_del ng-hide" ng-click="clearImage()" ng-show="imageDeletable"><img alt="close" src="icon_close_red.svg"></div></div></div></div><div class="chat-textarea col-xs-8"><textarea class="form-control ng-pristine ng-untouched ng-valid" id="chat_message_content" name="chat_message[content]" ng_model="content" placeholder="次のコードの意味がよくわからないので教えていただけないでしょうか？" row="3"></textarea></div><div class="chat-submit col-xs-3"><input style="display: none;" class="submit-btn" id="submit_chat_message" name="commit" value="送信" type="submit"><div class="skype-popup"><a title="" data-original-title="" class="trigger btn btn-default" href="#">Skypeで直接聞く</a><div class="head hide">Skype質問を申請すると<br>担当メンターから着信が届きます。<br>以下の項目をご確認ください。</div><div class="content hide"><p class="ng-binding">あなたのSkypeID:　machi4271<br>質問箇所: <small>※スマートフォン、タブレットでのSkypeはご遠慮ください<br>※通話が始まったらすぐに画面共有をお願いします</small></p><a class="skype-support" href="http://master.tech-camp.in/curriculums/462">Skype質問を申請する</a><div class="close">×</div></div></div></div></div></div></form></footer></div></div></div><div class="chat-dock" ng-click="getMessages(); showModal()">質問サポート<!-- ngIf: unreadSize != 0 --><span class="dock-support-state_text in-support ng-binding"><img class="icn_qsupport" src="icn_qsupport_white.png" width="10">質問受付中</span></div></div></body>
</html>
