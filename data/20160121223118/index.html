<!DOCTYPE html>
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8"><title>Ajaxで非同期通信をしよう</title><meta content="authenticity_token" name="csrf-param">
<meta content="Y2UzkG5GQl5jzIBq3nOdxAEomQen5uuix05BO4pPfYw=" name="csrf-token"><link href="favicon.ico" rel="icon" sizes="16x16 32x32 48x48 128x128 256x256">
<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head>
<body class="ng-scope" ng-app="techMaster"><div class="navbar main_header navbar-fixed-top navbar-default" role="navigation"><div class="container"><div class="navbar-header"><button aria-controls="navbar" aria-expanded="false" class="navbar-toggle collapsed" data-target="#navbar" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="http://master.tech-camp.in/" target="_self"><img src="logo.png"></a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav navbar-right"><li class="text">終了まであと<i class="limit_time">10</i>日</li><li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" id="profileDropdown" style="padding: 10px 7px; cursor: pointer;"><img class="nav-proimg" src="noimage.png">大宅 誠人</a><ul class="dropdown-menu" id="profileDropdown"><li><a class="mypage-link" href="http://master.tech-camp.in/users/mypage" target="_self">マイページを見る</a></li><li><a href="http://master.tech-camp.in/users" target="_self">十三期生一覧</a></li></ul><div class="popover bottom" id="profilePopover"><div class="arrow"></div><h3 class="popover-title" id="popover-bottom">プロフィールを完成させませんか？<a class="anchorjs-link" href="#popover-bottom"><span class="anchorjs-icon"></span></a></h3><div class="popover-content">「<a href="http://master.tech-camp.in/users/1867/edit" target="_self">プロフィール編集</a>」から、必須の項目を設定しましょう！</div></div></li></ul></div></div></div><!-- ngView:  --><div class="ng-scope" autoscroll="" ng-view=""><curriculum style="display: inline;" class="ng-scope">
  <div class="container" id="curriculum">
    <div class="row curriculum-inner">
      <div class="col-lg-12 main" ng-init="init()">
        <div ng-show="curriculum.image" class="page-header page" style="background-image: url('main_visual.jpg');">
  <h1 class="ng-binding">
    JavaScript基礎<small class="ng-binding">〜Ajaxで非同期通信をしよう〜</small>
  </h1>
  <!-- ngIf: curriculum.image.description.length --><div style="" class="flickr_attr ng-binding ng-scope" ng-if="curriculum.image.description.length">
    アタカマ砂漠は、チリのアンデス山脈と太平洋の間にある砂漠です。高地に位置するため夜空が暗く、世界一綺麗な星空が見える場所と言われます。<a class="ng-binding" href="https://www.flickr.com/photos/esoastronomy/13986527890/in/photolist-niWBsA-9RWW5S-9RU98n-9RUNqX-9RXbhJ-9RUMvX-47BDw7-onQDNm-9RUy8T-9RXyPu-9RXiff-9RUHbi-8bPUZM-9RX2bf-8bTeJU-8c2AEm-bsCpeF-8bTdtb-8bTeAm-nWv9qK-bsD6xR-jJPu8Y-7zP7Nd-at8FU1-dQb1dy-9RXDWh-bsDmuF-duGeP8-gRvpEh-97dYJy-97tzBW-47BEru-fAJ72g-97LaZG-9RWUY7-ekZRSx-bj6ycv-7PQDuo-oeYH5x-47xxgv-at63Dv-9RUQGk-7itxT3-duGfzV-479Z9u-5zE7g-47xx2x-47xBLa-47xBwe-47BGsy" target="_top">European Southern Observatory - Atacama Desert</a>
  </div><!-- end ngIf: curriculum.image.description.length -->
</div>
      </div>
      <div class="col-md-9 col-sm-12" id="curriculumMainContainer">
        <div class="curriculum_content">
          <div class="curriculum_text ng-scope" compile-progress-notifier="willCompiledCurriculumText" ng-controller="CurriculumHintController"><h1 id="1" class="ng-scope">学習の目標</h1>

<p class="ng-scope">非同期通信を用いた機能を実装することを通じて、Railsにおける非同期通信の実装の仕方を学びます。</p>

<h1 id="2" class="ng-scope">非同期通信とは</h1>

<p class="ng-scope">「はじめに」のカリキュラムにて説明していますが、改めて説明します。</p>

<p class="ng-scope">ブラウザがサーバにリクエストを送り、サーバがリクエストに応じた処理をし、レスポンスをブラウザにHTMLという形で返し、ブラウザがそれを表示する、という通常の流れとは別に、JavaScriptがサーバとする通信のことを非同期通信と呼びます。また、その通信をする仕組みのことをAjaxと呼びます。</p>

<p class="ng-scope">Ajaxを用いることで、画面遷移することなく、サーバと通信することができます。画面遷移しない分、ユーザに快適なブラウジングを提供することができます。レスポンスに応じて、HTMLの要素を書き換えることもできるため、ブラウザとの通信の後にビューにちょっとした変化しか無い場合はAjaxを使うことを検討しましょう。</p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="1550" action="http://master.tech-camp.in/curriculums/291#">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-2193" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-2193" name="check-2193" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">JavaScript上で行うサーバとの通信を非同期通信と呼び、非同期通信を実現する仕組みをAjaxと呼ぶ。</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-2194" ng-repeat="check in checkbox.checks"><input checked="checked" class="ng-pristine ng-untouched ng-valid" id="check-2194" name="check-2194" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">Ajaxを用いることで、画面遷移することなくサーバと通信し、諸々の処理を行うことができる。</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h1 id="3" class="ng-scope">非同期通信を使った一行メモアプリ</h1>

<p class="ng-scope">今回作るのは以下のような、次々と一行のメモを残すことの出来るアプリです。</p>

<p class="ng-scope"><img src="df8fc96b9c0dc6321387a96f070be873.gif" alt="https://tech-master.s3.amazonaws.com/uploads/curriculums//df8fc96b9c0dc6321387a96f070be873.gif"></p>

<p class="ng-scope">画面遷移することなくメモを投稿することができ、また、データベースにも保存されます。</p>

<h1 id="4" class="ng-scope">Ajaxを使わずに実装する</h1>

<p class="ng-scope">まずは、Ajaxを用いずに、メモを投稿する機能と、表示する機能を実装しましょう。</p>

<p class="ng-scope">大まかに以下のような手順で実装します。</p>

<p class="ng-scope">① アプリケーションを作成する（bundle installも実行される）<br>
② Memoモデルを作成する<br>
③ Memosコントローラーを作成し、トップページに対応するindexアクションを定義する<br>
④ indexアクションに対応するビューファイルを作成する<br>
⑤ indexアクションに対応するルーティングを追加する<br>
⑥ 投稿に対応するアクションを定義する（トップページにリダイレクトさせる）<br>
⑦ 投稿に対応するルーティングを追加する</p>

<p class="ng-scope">順に実装していきましょう。<br>
JavaScriptの実装がメインであるため、やや駆け足で説明します。</p>

<h2 id="5" class="ng-scope">① アプリケーションを作成しよう</h2>

<p class="ng-scope">PicTweetと同じように作成しましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> 適当なディレクトリで以下のコマンドを実行してください</h3>

<div class="code-frame ng-scope" data-lang="bash"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nv">$ </span>rails new memo-app -d mysql
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">これにより、memo-appという名前のアプリケーションが作成されました。</p>

<p class="ng-scope">さて、「WebページでJavaScriptを使ってみよう」のカリキュラムでやったように、mysql2の最新バージョンには問題があるため、Gemfileの記述を変更し、bundle installする必要があります。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> Gemfileを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="ruby"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="c1"># 7行目付近のmysql2の記述を以下のように書き換える</span>
<span class="n">gem</span> <span class="s1">'mysql2'</span><span class="p">,</span> <span class="s1">'0.3.18'</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">これにより、使うmysql2のバージョンを指定することができました。それではbundle installしましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> 以下のコマンドを実行し、gemのインストールをしてください。</h3>

<p class="ng-scope">※なお、以下の操作は全てアプリケーションのディレクトリで行って下さい。</p>

<div class="code-frame ng-scope" data-lang="bash"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nv">$ </span>bundle install
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">また、データベースの作成も行いましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> 以下のコマンドを実行し、データベースを作成してください</h3>

<div class="code-frame ng-scope" data-lang="bash"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nv">$ </span>rake db:create
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">これにより、データベースが作成され、Sequel Proからアクセスできるようになりました。</p>

<h2 id="6" class="ng-scope">② Memoモデルを作成しよう</h2>

<p class="ng-scope">メモを投稿するため、そのモデル（テーブル）を用意しないといけませんね。メモの中身を表すtextカラムをstring型で定義しましょう。</p>

<p class="ng-scope">※なお、これ以降のコマンドは全てアプリケーションのルートディレクトリで行って下さい。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> 以下のコマンドを実行し、Memoモデルを作成してください</h3>

<div class="code-frame ng-scope" data-lang="bash"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nv">$ </span>rails g model memo text:string
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">これにより、Memoモデルが作成され、同時に、memosテーブルを作成するマイグレーションファイルが作成されました。</p>

<p class="ng-scope">次に、memosテーブルを作成するために<code>rake db:migrate</code>を実行しましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> 以下のコマンドを実行し、memosテーブルを作成してください</h3>

<div class="code-frame ng-scope" data-lang="bash"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nv">$ </span>rake db:migrate
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">これで、memosテーブルが作られました。</p>

<h2 id="7" class="ng-scope">③ Memosコントローラーを作成し、トップページに対応するアクションを定義しよう</h2>

<h3 class="ng-scope">
<i class="icon pen"></i> 以下のコマンドを実行し、Memosコントローラーを作成してください</h3>

<div class="code-frame ng-scope" data-lang="bash"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nv">$ </span>rails g controller memos
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">これにより、Memosコントローラーが作成されます。次に、トップページに対応するアクションとしてindexアクションを定義しましょう。</p>

<p class="ng-scope">indexアクションでは、メモの一覧を表示するので、全てのメモを取得しましょう。</p>

<p class="ng-scope">また、投稿フォームのform_forメソッドの引数として用いるインスタンスを定義しておきましょう。こちらについては、後ほど説明します。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> app/controllers/memos_controller.rbを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="ruby"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">MemosController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@memos</span> <span class="o">=</span> <span class="no">Memo</span><span class="o">.</span><span class="n">all</span>
    <span class="vi">@memo</span> <span class="o">=</span> <span class="no">Memo</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">これでindexアクションが定義されました。<br>
ビューではメモの一覧を表示するので、取得しておきましょう。</p>

<h2 id="8" class="ng-scope">④ indexアクションに対応するビューファイルを作成しよう</h2>

<p class="ng-scope">indexアクションに対応するビューファイルでは、メモの一覧が表示されます。<br>
PicTweet同様、部分テンプレートを用いて実装しましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> app/views/memos/にindex.html.erbを作成し、以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="rhtml"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@memos</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">次に、部分テンプレートを作成します。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> app/views/memos/に_memo.html.erbを作成し、以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="rhtml"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nt">&lt;li&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">memo</span><span class="o">.</span><span class="n">text</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/li&gt;</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">また、投稿フォームも追加しましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> app/views/memos/index.html.erbを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="rhtml"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">form_for</span> <span class="vi">@memo</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:text</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s1">'投稿'</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@memos</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>
</td>
</tr></tbody></table></div>

<h3 class="ng-scope">
<i class="icon information" id="term_526"></i> form_forメソッド</h3>

<p class="ng-scope"><code>form_for</code>はProfyでも使いましたが、とても大事な所なので一度復習しておきましょう。</p>

<p class="ng-scope">そもそも、html.erbファイルは、rubyの記述が許されたHTMLファイルです。html.erbファイルは、rubyの処理が行われた後、HTMLレスポンスとしてブラウザに返されます。</p>

<p class="ng-scope"><code>form_for</code>はヘルパーメソッドであり、html.erbファイルがHTMLに変換される際にformタグに変換されます。formタグは、送信ボタンを押した時のリクエスト送信先のURLの情報と、リクエストを送る時のHTTPメソッドとして何を用いるか、という情報を持ちます。<br>
<code>form_for</code>は、引数にモデルのインスタンスを取ります。このインスタンスに応じて、URLとHTTPメソッドを柔軟に変更します。</p>

<p class="ng-scope">引数として、まだレコードに追加されていない新しいインスタンスが渡された時は、そのインスタンスを生成する、すなわちそのインスタンスのcreateアクションに対応するURLとHTTPメソッドを情報として持ちます。<br>
一方、引数として、レコードに追加された既に作成済みのインスタンスを渡した時は、そのインスタンスを編集する、すなわちそのインスタンスのupdateアクションに対応するURLとHTTPメソッドを情報として持ちます。</p>

<p class="ng-scope">今回は、コントローラーで定義した@memoインスタンスを引数としています。@memoインスタンスには、まだレコードに追加されていない（saveされていない）、新しいMemoモデルのインスタンスが入っています。そのため、この<code>form_for</code>は、Memoモデルを新規作成するアクション、すなわちMemosControllerのcreateアクションに対応するURLとHTTPメソッドを持ちます。</p>

<p class="ng-scope">今はまだ、createアクションとそのルーティングを定義していないため、この<code>form_for</code>を含むページを表示させるとエラーが起こります。</p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="1551" action="http://master.tech-camp.in/curriculums/291#">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-2195" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-2195" name="check-2195" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">form_forはモデルと紐付くデータを入力するフォームを生成するときに用いる。</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-2196" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-2196" name="check-2196" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">form_forは、引数のインスタンスに応じて、URLとHTTPメソッドを変える。</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 id="9" class="ng-scope">⑤ indexアクションに対応するルーティングを追加しよう</h2>

<h3 class="ng-scope">
<i class="icon pen"></i> config/routes.rbを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="ruby"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s1">'memos#index'</span>
<span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">これにより、ルートパス、すなわちトップページにアクセスされると、memosコントローラのindexアクションが実行され、それに対応するindex.html.erbが表示されることとなります。</p>

<h2 id="10" class="ng-scope">⑥ 投稿に対応するアクションを定義しよう</h2>

<p class="ng-scope"><code>form_for</code>を経て送信されたパラメータは、paramsのそのモデル名をキーとする値に、ハッシュとして定義されています。<br>
以下のように二重のハッシュ構造になっているということですね。</p>

<div class="code-frame ng-scope" data-lang="ruby"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="n">params</span> <span class="c1"># =&gt; {.., :memo =&gt; {:text =&gt; "入力した内容"}, ..}</span>
<span class="n">params</span><span class="o">[</span><span class="ss">:memo</span><span class="o">]</span> <span class="c1"># =&gt; {:text =&gt; "入力した内容"}</span>
<span class="n">params</span><span class="o">[</span><span class="ss">:memo</span><span class="o">][</span><span class="ss">:text</span><span class="o">]</span> <span class="c1"># =&gt; "入力した内容"</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">よって、まずparamsの<code>require</code>メソッドにより、「memoキーに対応する値であるハッシュ」を取り出します。</p>

<div class="code-frame ng-scope" data-lang="ruby"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:memo</span><span class="p">)</span> <span class="c1"># =&gt; {:text =&gt; "入力した内容"}</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">さらに、ストロングパラメータとしてキーを指定すれば良いのでした。</p>

<div class="code-frame ng-scope" data-lang="ruby"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:memo</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:text</span><span class="p">)</span> <span class="c1"># =&gt; {:text =&gt; "入力した内容"}</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">それでは実際にコントローラーにアクションを追加しましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> app/controllers/memos_controller.rbを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="ruby"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">MemosController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@memos</span> <span class="o">=</span> <span class="no">Memo</span><span class="o">.</span><span class="n">all</span>
    <span class="vi">@memo</span> <span class="o">=</span> <span class="no">Memo</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="no">Memo</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">memo_params</span><span class="p">)</span>
    <span class="n">redirect_to</span> <span class="ss">:root</span>
  <span class="k">end</span>

  <span class="kp">private</span>
  <span class="k">def</span> <span class="nf">memo_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:memo</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:text</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">これにより、<code>form_for</code>を経てcreateアクションが実行された際に、新しくMemoのレコードを追加し、トップページにリダイレクトさせることができるようになりました。</p>

<h2 id="11" class="ng-scope">⑦ 投稿に対応するルーティングを追加しよう</h2>

<p class="ng-scope">PicTweetの時と同様に、以下のように記述しても構いません。</p>

<div class="code-frame ng-scope" data-lang="ruby"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="n">post</span> <span class="s1">'memos'</span> <span class="o">=&gt;</span> <span class="s1">'memos#create'</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">しかしRailsでは、index, new, create, show, edit, update, destroyといった、いわゆる基本的なルーティングに関しては、より綺麗に記述できる仕組みが用意されています。</p>

<p class="ng-scope">上記のルーティングは、以下のように記述しても同じ意味になります。</p>

<div class="code-frame ng-scope" data-lang="ruby"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="n">resources</span> <span class="ss">:memos</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="ss">:create</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">可能な限り、この書き方をすることを心がけましょう。また、上記の7つのアクションのみを使って諸々の機能を実装するように心がけましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> config/routes.rbを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="ruby"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s1">'memos#index'</span>
  <span class="n">resources</span> <span class="ss">:memos</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">これにより、Memoのcreateアクションに対応するルーティングが定義されたため、<code>form_for</code>のエラーが無くなり、トップページにアクセスすることができるようになります。</p>

<p class="ng-scope">実際にフォームに投稿し、メモが表示されることを確認しましょう。</p>

<p class="ng-scope">以上により、メモを投稿し、表示するアプリケーションが出来上がりました。</p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="1552" action="http://master.tech-camp.in/curriculums/291#">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-2197" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-2197" name="check-2197" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">通常のメモアプリとしての機能を作ることができた。</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h1 id="12" class="ng-scope">Ajaxを用いて、非同期通信で投稿できるようにする</h1>

<p class="ng-scope">それではいよいよ、Ajaxを用いて非同期通信を実装します。</p>

<p class="ng-scope">以下のような仕様を実装します。</p>

<p class="ng-scope">・form_forで非同期通信によってリクエストを送る<br>
・サーバはリクエストを受け取ったら、レコードを作成し、一覧を書き直すJavaScriptの処理をレスポンスとして返す<br>
・ブラウザはレスポンスを受け取ったら、そのJavaScriptを実行し、画面上の要素を書き換える</p>

<p class="ng-scope">順番に見て行きましょう。</p>

<h2 id="13" class="ng-scope">form_forで非同期通信によりリクエストを送るようにしよう</h2>

<p class="ng-scope"><code>form_for</code>は、デフォルトでは同期通信です。すなわち、リクエストを送り、レスポンスをHTMLとして受け取り、画面を再描画します。</p>

<p class="ng-scope">これを非同期通信、すなわち画面遷移させずにリクエストを送るようにするためには、<code>form_for</code>に<code>remote: true</code>というオプションをつけます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> app/views/memos/index.html.erbを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="rhtml"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">form_for</span> <span class="vi">@memo</span><span class="p">,</span> <span class="ss">remote</span><span class="p">:</span> <span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:text</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s1">'投稿'</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@memos</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">実際にブラウザで投稿してみましょう。投稿ボタンを押しても画面遷移はされなくなりました。画面遷移はされなくても、確かにレコードは追加されています。すなわち、確かにリクエストが送られていて、createアクションが実行されていることがわかります。</p>

<p class="ng-scope">これにより、非同期通信が実現できました。<br>
Railsでは、非同期通信がいとも簡単に実装できるようになっているのです。</p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="1554" action="http://master.tech-camp.in/curriculums/291#">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-2198" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-2198" name="check-2198" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">remote: trueというオプションをつけることにより、非同期通信によりリクエストが送られるようになる。</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 id="14" class="ng-scope">createアクションのレスポンスを作ろう</h2>

<p class="ng-scope">さて、これで非同期通信により投稿ができるようになったものの、実際に一覧が更新されなくてはあまり意味がありません。</p>

<p class="ng-scope">remote: trueオプションをつけると、アクションを実行した後、「（アクション名）.js.erb」ファイルを探し、あればそれをレスポンスとしてブラウザに返します。html.erb同様、これはコントローラーで定義したインスタンス変数を使うことができ、また、rubyタグを使うこともできるJavaScriptファイルです。最終的には純粋なjsファイルに変換された後で、ブラウザにレスポンスとして返されます。</p>

<p class="ng-scope">今回は、createアクションに対応するレスポンスを作れば良いので、create.js.erbというファイルを作成すれば良いことになります。</p>

<p class="ng-scope">そのファイルの中では、</p>

<p class="ng-scope">・入力フォームの初期化<br>
・一覧の再描画</p>

<p class="ng-scope">を行いましょう。一覧の再描画をするためには、一覧を取得しなくてはなりません。後ほど、コントローラーで@memos変数に一覧を代入するようにしましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> app/views/memos/create.js.erbを新規作成し、以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="javascript"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="s2">"#memo_text"</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span> <span class="c1">// 入力フォームを空欄にする処理</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"ul"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">"&lt;%= j(render @memos) %&gt;"</span><span class="p">);</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">1行目は、入力フォームの初期化を表します。<code>form_for</code>内の<code>text_field</code>タグで生成したinputタグは、「（モデル名）_（カラム名）」といったidが適用されています。そのため、上記のようにすることでその入力フォームをjQueryオブジェクトとして取得することができます。</p>

<p class="ng-scope">valはjQueryオブジェクトのメソッドで、そのjQueryオブジェクトの中のテキストを、引数で渡した文字列に書き換えます。<br>
今回は、空欄にしたいため、空の文字列を引数に渡しています。</p>

<p class="ng-scope">2行目に関しては、「ulタグの中身を &lt;%= render @memos %&gt;で書き換え直す」という意味であると考えて下さい。</p>

<h2 id="15" class="ng-scope">createアクションを修正しよう</h2>

<p class="ng-scope">さて、レスポンスは、createアクションで@memos変数に一覧を取得することを前提に作成しました。</p>

<p class="ng-scope">そこで、コントローラーで、インスタンス変数としてメモの一覧を取得するようにしましょう。また、ルートパスにリダイレクトさせる処理は、非同期通信においては不要なので削除しましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> app/controllers/memos_controller.rbを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="ruby"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">MemosController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@memos</span> <span class="o">=</span> <span class="no">Memo</span><span class="o">.</span><span class="n">all</span>
    <span class="vi">@memo</span> <span class="o">=</span> <span class="no">Memo</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="no">Memo</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">memo_params</span><span class="p">)</span>
    <span class="vi">@memos</span> <span class="o">=</span> <span class="no">Memo</span><span class="o">.</span><span class="n">all</span>
  <span class="k">end</span>

  <span class="kp">private</span>
  <span class="k">def</span> <span class="nf">memo_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:memo</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:text</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">以上により、フォームから非同期通信でリクエストを送りレコードを作成した後、「入力フォームの内容を空にする」そして「一覧を更新する」という処理が記述されたJavaScriptファイルがレスポンスとしてブラウザに返されるようになりました。<br>
ブラウザはそのレスポンスを受け取るとすぐに実行します。</p>

<p class="ng-scope">実際に投稿して挙動を確認してみましょう。無事、画面遷移せずに一覧の更新がされていることがわかります。</p>

<p class="ng-scope">以上でRailsにおけるAjaxの実装は完了です。Railsでは物凄く簡単に非同期通信によるリクエストの送信、そしてレスポンスの受け取りと実行ができるようになっています。</p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="1564" action="http://master.tech-camp.in/curriculums/291#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-2209" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-2209" name="check-2209" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">Ajaxを用いて、非同期通信で投稿できるようにすることができた。</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form><br>
<form class="ng-pristine ng-valid ng-scope" data-id="1555" action="http://master.tech-camp.in/curriculums/291#">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-2199" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-2199" name="check-2199" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">remote: trueをつけた場合、レスポンスとしてjs.erbがブラウザに返され、JavaScriptとして実行される。</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h1 id="16" class="ng-scope">Ajaxを用いて、非同期通信で削除できるようにする</h1>

<p class="ng-scope">練習のため、各メモを削除できる機能もAjaxにより実装してみましょう。</p>

<p class="ng-scope"><img src="efd71f57222e5d73125956aafa6bd1ac.gif" alt="https://tech-master.s3.amazonaws.com/uploads/curriculums//efd71f57222e5d73125956aafa6bd1ac.gif"></p>

<p class="ng-scope">以下のような手順で実装します。</p>

<p class="ng-scope">① メモの削除に対応するdestroyアクションを定義する<br>
② 削除に対応するレスポンス（destroy.js.erb）を作成する<br>
③ 削除に対応するルーティングを設定する<br>
④ トップページに削除ボタンを実装する</p>

<h2 id="17" class="ng-scope">① destroyアクションを定義しよう</h2>

<p class="ng-scope">destroyアクションは、一件のMemoを削除します。そのため、どのMemoを削除するか、という情報が必要になります。</p>

<p class="ng-scope">適切なルーティングを用いると、削除したいメモのレコードのidはparams[:id]によって取得できます。</p>

<p class="ng-scope">メモを削除した後は、create同様に一覧の再描画をしたいので、メモの一覧を取得しておき、レスポンスのjs.erbから取得できるようにしておきます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> app/controllers/memos_controller.rbを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="ruby"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">MemosController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@memos</span> <span class="o">=</span> <span class="no">Memo</span><span class="o">.</span><span class="n">all</span>
    <span class="vi">@memo</span> <span class="o">=</span> <span class="no">Memo</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="no">Memo</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">memo_params</span><span class="p">)</span>
    <span class="vi">@memos</span> <span class="o">=</span> <span class="no">Memo</span><span class="o">.</span><span class="n">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="no">Memo</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">destroy</span>
    <span class="vi">@memos</span> <span class="o">=</span> <span class="no">Memo</span><span class="o">.</span><span class="n">all</span>
  <span class="k">end</span>

  <span class="kp">private</span>
  <span class="k">def</span> <span class="nf">memo_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:memo</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:text</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table></div>

<h2 id="18" class="ng-scope">② destroyアクションのレスポンスを作ろう</h2>

<p class="ng-scope">create.js.erbと全く同様の処理を行えば良いですね。<br>
ただ今回は、テキストフォームに値を入力して送信したわけではないので、テキストフォームの中身を空にする記述は不要でしょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> app/views/memos/にdestroy.js.erbを作成し、以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="javascript"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="s2">"ul"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">"&lt;%= j(render @memos) %&gt;"</span><span class="p">)</span>
</pre></div>
</td>
</tr></tbody></table></div>

<h2 id="19" class="ng-scope">③ destroyアクションに対応するルーティングを追加しよう</h2>

<p class="ng-scope">上述の通り、destroyアクション等の基本アクションのルーティングは、Railsが用意してくれている書き方により定義できます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> config/routes.rbを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="ruby"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s1">'memos#index'</span>
  <span class="n">resources</span> <span class="ss">:memos</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:create</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">先程はcreateアクション一つでしたが、今回destroyアクションを追加したため、配列を用いています。</p>

<p class="ng-scope">上記は、以下とほぼ同じ意味になります。<br>
※ただし以下のコードではprefixを生成しないので、厳密には少し異なります。<strong>ここでは必ず、上記のコードのように編集するようにしましょう。</strong></p>

<div class="code-frame ng-scope" data-lang="ruby"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="n">root</span> <span class="s1">'memos#index'</span>
<span class="n">post</span> <span class="s1">'memos'</span> <span class="o">=&gt;</span> <span class="s1">'memos#create'</span>
<span class="n">delete</span> <span class="s1">'memos/:id'</span> <span class="o">=&gt;</span> <span class="s1">'memos#destroy'</span>
</pre></div>
</td>
</tr></tbody></table></div>

<h2 id="20" class="ng-scope">④ 削除ボタンを実装しよう</h2>

<p class="ng-scope">それではトップページに削除ボタンを実装しましょう。</p>

<p class="ng-scope">削除ボタンは、Ajaxを用いない場合、どのように実装するでしょうか。PicTweetでは、<code>link_to</code>メソッドにより削除ボタンを実装していました。</p>

<p class="ng-scope">ここでも<code>link_to</code>メソッドにより削除ボタンを記述してみましょう。<code>form_for</code>同様、<code>remote: true</code>オプションをつけます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> app/views/memos/_memo.html.erbを以下のように編集してください</h3>

<div class="code-frame ng-scope" data-lang="rhtml"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nt">&lt;li&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">memo</span><span class="o">.</span><span class="n">text</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'削除'</span><span class="p">,</span> <span class="n">memo_path</span><span class="p">(</span><span class="n">memo</span><span class="p">),</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:delete</span><span class="p">,</span> <span class="ss">remote</span><span class="p">:</span> <span class="kp">true</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/li&gt;</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">link_toメソッドは第二引数に、リンク先のパスを記述しました。<br>
パスの指定の仕方が見慣れないかもしれません。これは、以下と同じ意味です。</p>

<div class="code-frame ng-scope" data-lang="rhtml"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'削除'</span><span class="p">,</span> <span class="s2">"/memos/</span><span class="si">#{</span><span class="n">memo</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:delete</span><span class="p">,</span> <span class="ss">remote</span><span class="p">:</span> <span class="kp">true</span> <span class="cp">%&gt;</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope"><code>resources</code>を用いて記述したルーティングには、Prefixと呼ばれる、パスの名前が付与されます。</p>

<p class="ng-scope"><code>rake routes</code>と実行することでPrefixを確認することができます。</p>

<div class="code-frame ng-scope" data-lang="bash"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td>
<td class="code">
<div class="highlight"><pre>Prefix Verb   URI Pattern          Controller#Action
  root GET    /                    memos#index
 memos POST   /memos<span class="o">(</span>.:format<span class="o">)</span>     memos#create
  memo DELETE /memos/:id<span class="o">(</span>.:format<span class="o">)</span> memos#destroy
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">この記述から、memos#destroyに対応するパスに「memo」というPrefixが付与されていることがわかります。<br>
<code>link_to</code>の第二引数を<code>(Prefix名)_path</code>とすると、そのPrefixに対応するパスをリンク先として指定することができます。</p>

<p class="ng-scope">今回であれば<code>memo_path</code>とすれば良いことになりますね。</p>

<p class="ng-scope">destroyのように、パラメータとしてidが必要になる場合、<code>(Prefix名)_path</code>の後に括弧をつけて、そのインスタンスを渡します。今回、部分テンプレートの性質から、削除したいmemoレコードは変数memoに入っています。そのため、<code>memo_path(memo)</code>とすれば良いことになります。</p>

<p class="ng-scope">さて、これで削除ボタンの実装も完了し、Ajaxを使って削除する一連の流れが出来上がりました。</p>

<p class="ng-scope">実際に挙動を確認してみると、画面遷移せずにメモが削除できていることがわかります。</p>

<p class="ng-scope"><code>link_to</code>、<code>form_for</code>、<code>form_tag</code>は<code>remote: true</code>オプションを使うことが出来ます。これらに対しては、今回学んだ知識を用いて非同期通信を実装することができます。</p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="1565" action="http://master.tech-camp.in/curriculums/291#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-2210" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-2210" name="check-2210" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">Ajaxを用いて、非同期通信で削除できるようにすることができた。</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form><br>
<form class="ng-pristine ng-valid ng-scope" data-id="1556" action="http://master.tech-camp.in/curriculums/291#">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-2200" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-2200" name="check-2200" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">link_to、form_for、form_tag等はremote: trueオプションをつけることにより、非同期通信をさせることが可能である。</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h1 id="21" class="ng-scope">終わりに</h1>

<p class="ng-scope">以上でJavaScriptカリキュラムは終了です。</p>

<p class="ng-scope">簡単なJavaScriptの文法から、DOMオブジェクト・jQueryオブジェクトとしてのHTML要素の取得・書き換え、そしてAjaxまでをざっくりと学びました。</p>

<p class="ng-scope">実際JavaScriptはとても奥が深く、文法だけでもしっかり学ぶとなると骨が折れます。</p>

<p class="ng-scope">しかし本カリキュラムで学んだ知識があれば、ネット上のやや高尚な内容も遥かに楽に理解できるようになっているでしょう。</p>

<p class="ng-scope">これからは、自分で実装したい機能を調べ、実際に自分のRailsアプリケーションに取り入れることを通じ、JavaScriptの知識を深めましょう。</p>
</div>
          <!-- ngIf: curriculum.short_test --><div ng-if="curriculum.short_test" class="short_test-box ng-scope">
  <div class="short_test-title">
    <h4>
      確認問題
    </h4>
    <p>
      お疲れ様でした！このカリキュラムの終わりに確認問題を解きましょう。
    </p>
  </div>
  <div class="short_test_score" id="shortTestInfo"></div>
  <div class="short_test-button">
    <a class="curriculum-short-test-button" ng-click="showShortTest(curriculum.short_test.id)">確認テストに挑戦する！</a>
  </div>
</div><!-- end ngIf: curriculum.short_test -->
        </div>
      </div>
      <div class="col-md-3 col-sm-12" id="curriculumSideContainer">
        <curriculum-side-wrap id="sideWrap">
          <ul style="max-height: 347px;" class="list-group toc-tree" id="curriculumContents">
  <li class="list-group-item disabled">
    目次
  </li>
  <!-- ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding current" id="contents1" ng-click="clickContent(content.h1.id)">学習の目標</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents2" ng-click="clickContent(content.h1.id)">非同期通信とは</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents3" ng-click="clickContent(content.h1.id)">非同期通信を使った一行メモアプリ</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents4" ng-click="clickContent(content.h1.id)">Ajaxを使わずに実装する</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents5" ng-click="clickContent(h2.id)">① アプリケーションを作成しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents6" ng-click="clickContent(h2.id)">② Memoモデルを作成しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents7" ng-click="clickContent(h2.id)">③ Memosコントローラーを作成し、トップページに対応するアクションを定義しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents8" ng-click="clickContent(h2.id)">④ indexアクションに対応するビューファイルを作成しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents9" ng-click="clickContent(h2.id)">⑤ indexアクションに対応するルーティングを追加しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents10" ng-click="clickContent(h2.id)">⑥ 投稿に対応するアクションを定義しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents11" ng-click="clickContent(h2.id)">⑦ 投稿に対応するルーティングを追加しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents12" ng-click="clickContent(content.h1.id)">Ajaxを用いて、非同期通信で投稿できるようにする</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents13" ng-click="clickContent(h2.id)">form_forで非同期通信によりリクエストを送るようにしよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents14" ng-click="clickContent(h2.id)">createアクションのレスポンスを作ろう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents15" ng-click="clickContent(h2.id)">createアクションを修正しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents16" ng-click="clickContent(content.h1.id)">Ajaxを用いて、非同期通信で削除できるようにする</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents17" ng-click="clickContent(h2.id)">① destroyアクションを定義しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents18" ng-click="clickContent(h2.id)">② destroyアクションのレスポンスを作ろう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents19" ng-click="clickContent(h2.id)">③ destroyアクションに対応するルーティングを追加しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents20" ng-click="clickContent(h2.id)">④ 削除ボタンを実装しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents21" ng-click="clickContent(content.h1.id)">終わりに</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents -->
</ul>
          <div style="" ng-show="check_count > 0" class="progress_box ng-scope">
  <!-- ngIf: showTroubleShooting() -->
  <!-- ngIf: courseId != 9 && courseId != 10 --><p class="terms ng-scope" ng-if="courseId != 9 &amp;&amp; courseId != 10">
    分からない用語がある時：<br><a href="http://master.tech-camp.in/terms" target="_brank">用語一覧集</a>
  </p><!-- end ngIf: courseId != 9 && courseId != 10 -->
  <h4>
    進捗度<i class="ng-binding" id="numerator">2 / 10<span id="denominaotr"></span></i>
  </h4>
  <div class="progress">
    <div aria-valuemax="100" aria-valuemin="0" aria-valuenow="20" class="pregress-bar progress-bar-info ng-binding" role="progressbar" style="width: 20%;">
      20%
    </div>
  </div>
</div>
          <curriculum-glossary class="ng-hide" ng-show="curriculum.curriculum_type == 2 || curriculum.curriculum_type == 3"></curriculum-glossary>
          <button class="curriculum-report-button" ng-click="show_curriculum_report()">
            <img src="idea.svg" height="20px" width="20px">
            | このカリキュラムへのご要望
          </button>
        </curriculum-side-wrap>
      </div>
    </div>
    <ul style="" class="pager" ng-hide="loading">
  <li class="previous">
    <a style="" class="" ng-click="go_previous()" ng-show="curriculum.previous_id">前のカリキュラム</a>
  </li>
  <li class="next">
    <a class="ng-hide" ng-class="{ disable: curriculum.short_test.can_see_next_curriculum == false }" ng-click="go_next()" ng-show="curriculum.next_id">次のカリキュラム</a>
  </li>
</ul>
  </div>
</curriculum>
<div style="" class="ng-scope ng-isolate-scope ng-hide" id="loading" ng-show="loading">
  <svg height="44" stroke="#444" viewBox="0 0 44 44" width="44" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" strole-width="2"><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="0s" calcMode="spline" dur="1.8s" keySplines="0.165, 0.84, 0.44, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 20"></animate><animate attributeName="stroke-opacity" begin="0s" calcMode="spline" dur="1.8s" keySplines="0.3, 0.61, 0.355, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 0"></animate></circle><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="-0.9s" calcMode="spline" dur="1.8s" keySplines="0.165, 0.84, 0.44, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 20"></animate><animate attributeName="stroke-opacity" begin="-0.9s" calcMode="spline" dur="1.8s" keySplines="0.3, 0.61, 0.355, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 0"></animate></circle></g></svg>
</div>

<div class="curriculum-image__modal modal ng-scope" id="curriculum-image__modal" role="dialog" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button class="close" data-dismiss="modal" ng-click="close()"><span aria-hidden="true">×</span></button>
      </div>
      <div class="modal-body">
        <div class="curriculum-image__img__body">
          <img class="curriculum-image__img zoom-out" id="curriculum-image__img">
        </div>
      </div>
    </div>
  </div>
</div>


</div><div class="chat-window ng-scope" ng-controller="SupportChatController" ng-init="init('大宅誠人', '/uploads/noimage.png', 1867, 2988, 0, 'accepted_questions', 'machi4271', '2')"><div aria-hidden="true" aria-labelledby="myLargeModalLabel" class="modal fade" id="chats-modal" role="dialog" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="wrapper">
  <header class="chat-header">
    <div class="row">
      <div class="col-md-6 col-xs-12 chat-header-left">
        <h2>
          質問チャット
        </h2>
        <div class="chat-support-state active in-support ng-binding">
          <img src="icn_qsupport.png" width="16">質問受付中
        </div>
      </div>
    </div>
  </header>
  <div class="chat-layout" load-more="load-more">
    <!-- ngRepeat: message in messages -->
  </div>
</div><footer class="chat-footer"><form accept-charset="UTF-8" action="http://master.tech-camp.in/api/chat_messages" class="new_chat_message ng-pristine ng-valid" data-remote="true" enctype="multipart/form-data" id="new_chat_message" method="post" ng_submit="afterSubmitted()"><div style="display: none;"><input name="utf8" value="✓" type="hidden"></div><input id="chat_message_chat_id" name="chat_message[chat_id]" value="2988" type="hidden"><div class="chat-box"><div class="row"><div class="chat-upload col-xs-1"><div class="chat-upload-btn"><img class="chat-upload-icn" src="icn_fileupload.png"><input class="ng-pristine ng-untouched ng-valid" id="chat_message_file" name="chat_message[file]" ng_model="file" onchange="angular.element(this).scope().showSubmitButtonAndHideSkypeButtonAndPreview()" type="file"><div class="chat-uploading-image ng-hide" ng-show="isUploading" ng-style="isUploadingStyle"><div class="image_del ng-hide" ng-click="clearImage()" ng-show="imageDeletable"><img alt="close" src="icon_close_red.svg"></div></div></div></div><div class="chat-textarea col-xs-8"><textarea class="form-control ng-pristine ng-untouched ng-valid" id="chat_message_content" name="chat_message[content]" ng_model="content" placeholder="次のコードの意味がよくわからないので教えていただけないでしょうか？" row="3"></textarea></div><div class="chat-submit col-xs-3"><input style="display: none;" class="submit-btn" id="submit_chat_message" name="commit" value="送信" type="submit"><div class="skype-popup"><a title="" data-original-title="" class="trigger btn btn-default" href="#">Skypeで直接聞く</a><div class="head hide">Skype質問を申請すると<br>担当メンターから着信が届きます。<br>以下の項目をご確認ください。</div><div class="content hide"><p class="ng-binding">あなたのSkypeID:　machi4271<br>質問箇所: <small>※スマートフォン、タブレットでのSkypeはご遠慮ください<br>※通話が始まったらすぐに画面共有をお願いします</small></p><a class="skype-support" href="http://master.tech-camp.in/curriculums/291">Skype質問を申請する</a><div class="close">×</div></div></div></div></div></div></form></footer></div></div></div><div class="chat-dock" ng-click="getMessages(); showModal()">質問サポート<!-- ngIf: unreadSize != 0 --><span class="dock-support-state_text in-support ng-binding"><img class="icn_qsupport" src="icn_qsupport_white.png" width="10">質問受付中</span></div></div></body>
</html>
