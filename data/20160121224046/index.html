<!DOCTYPE html>
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8"><title>タイムラインをつくろう１</title><meta content="authenticity_token" name="csrf-param">
<meta content="Y2UzkG5GQl5jzIBq3nOdxAEomQen5uuix05BO4pPfYw=" name="csrf-token"><link href="favicon.ico" rel="icon" sizes="16x16 32x32 48x48 128x128 256x256">
<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head>
<body class="ng-scope" ng-app="techMaster"><div class="navbar main_header navbar-fixed-top navbar-default" role="navigation"><div class="container"><div class="navbar-header"><button aria-controls="navbar" aria-expanded="false" class="navbar-toggle collapsed" data-target="#navbar" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="http://master.tech-camp.in/" target="_self"><img src="logo.png"></a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav navbar-right"><li class="text">終了まであと<i class="limit_time">10</i>日</li><li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" id="profileDropdown" style="padding: 10px 7px; cursor: pointer;"><img class="nav-proimg" src="noimage.png">大宅 誠人</a><ul class="dropdown-menu" id="profileDropdown"><li><a class="mypage-link" href="http://master.tech-camp.in/users/mypage" target="_self">マイページを見る</a></li><li><a href="http://master.tech-camp.in/users" target="_self">十三期生一覧</a></li></ul></li></ul></div></div></div><div class=""></div><!-- ngView:  --><div class="ng-scope" ng-view=""><curriculum style="display: inline;" class="ng-scope">
  <div class="container" id="curriculum">
    <div class="row curriculum-inner">
      <div class="col-lg-12 main" ng-init="init()">
        <div ng-show="curriculum.image" class="page-header page" style="background-image: url('visual_image.jpg');">
  <h1 class="ng-binding">
    Railsアプリケーション開発3 第4章<small class="ng-binding">〜タイムラインをつくろう１〜</small>
  </h1>
  <!-- ngIf: curriculum.image.description.length --><div style="" class="flickr_attr ng-binding ng-scope" ng-if="curriculum.image.description.length">
    広島県にある、厳島神社。本柱に計４本の控え柱を持つ「両部大鳥居」の形式である。境内の沖合約200mにあるこの大鳥居を建立するにあたっては、巨木探しに20年近い歳月を要したといいます。<a class="ng-binding" href="http://master.tech-camp.in/curriculums/149" target="_top"> - </a>
  </div><!-- end ngIf: curriculum.image.description.length -->
</div>
      </div>
      <div class="col-md-9 col-sm-12" id="curriculumMainContainer">
        <div class="curriculum_content">
          <div class="curriculum_text ng-scope" compile-progress-notifier="willCompiledCurriculumText" ng-controller="CurriculumHintController"><h1 id="1" class="ng-scope">開発するタイムラインについて理解する</h1>

<p class="ng-scope">profyのメイン機能となるタイムラインを実装していきます。<br>
開発するタイムラインは以下の様なイメージです。</p>

<p class="ng-scope"><img src="timeline-image.png" alt="text"></p>

<p class="ng-scope">質問と回答それぞれが時系列でトップページに表示されます。一度に作るのは難しいのでステップを踏んで開発していきましょう。</p>

<h1 id="2" class="ng-scope">質問のタイムラインを作る</h1>

<p class="ng-scope">タイムラインは質問と回答によってなりたっていますが、まずは質問がないと回答できないので<br>
質問を投稿できるようにします。</p>

<h2 id="3" class="ng-scope">質問用のモデルを生成し、アソシエーションをそれぞれ定義する</h2>

<p class="ng-scope">質問は、「本文」に加えて「どのグループ」で「誰が」投稿したのかという情報を保存する必要があります。<br>
そのためgroup_idとuser_idをカラムに加えます。</p>

<table class="ng-scope">
<thead>
<tr>
<th style="text-align: center;">カラム名</th>
<th style="text-align: center;">型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">text</td>
<td style="text-align: center;">Text</td>
</tr>
<tr>
<td style="text-align: center;">user_id</td>
<td style="text-align: center;">Integer</td>
</tr>
<tr>
<td style="text-align: center;">group_id</td>
<td style="text-align: center;">Integer</td>
</tr>
</tbody>
</table>

<p class="ng-scope">これからアソシエーションを以下の図のように設定していきます。</p>

<p class="ng-scope"><img src="association-image.png" alt="アソシエーション"></p>

<div class="challenge ng-scope">
<h3>
<i class="icon crown"></i> 問題1：questionモデルを作成し各カラムを追加しましょう。そしてアソシエーションもそれぞれ設定してみましょう。</h3>

   <h5>作業場所：ターミナル,question.rb,group.rb,user.rb,2015xxxxxxxxxx_create_questions.rb</h5>
   <h5>ヒント1： カラム名と型を編集した後は bundle exec rake db:migrate を実行しましょう</h5>
   <h5>ヒント2： 上記のフローを元にアソシエーションを定義しましょう</h5>
   <h5>ヒント3： 複数のquestionをもつモデルにはアソシエーションを has_many :questions, -&gt;{ order("created_at DESC") } と記述してオプションを付けるとよいでしょう。</h5>

<curriculum-question-container class="ng-scope" data-order="1"><button style="" class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button style="" class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
</div>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="541" action="http://master.tech-camp.in/curriculums/149#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-769" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-769" name="check-769" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">質問用のモデルを生成できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h3 class="ng-scope">
<i class="icon pen"></i> モデルにバリデーションを定義しましょう</h3>

<h3 class="ng-scope">
<i class="icon information" id="term_501"></i> validates_presence_of</h3>

<p class="ng-scope">値が空でないかを検証します。空のまま保存したくないプロパティを指定することで、空のまま保存されることを防ぐことができます。</p>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/models/question.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Question</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>

  <span class="c1">#association</span>
  <span class="n">belongs_to</span> <span class="ss">:user</span>
  <span class="n">belongs_to</span> <span class="ss">:group</span>

<span class="hll">  <span class="c1">#validation</span>
</span><span class="hll">  <span class="n">validates_presence_of</span> <span class="ss">:user_id</span><span class="p">,</span> <span class="ss">:text</span><span class="p">,</span> <span class="ss">:group_id</span>
</span>
<span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="542" action="http://master.tech-camp.in/curriculums/149#">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-770" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-770" name="check-770" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">validates_presence_ofで値が空でないかを検証できる</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="562" action="http://master.tech-camp.in/curriculums/149#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-771" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-771" name="check-771" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">questionモデルにバリデーションを定義できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 id="4" class="ng-scope">質問を投稿できるようにする</h2>

<p class="ng-scope">質問を実際に質問できるようにしていきましょう。今回はフォームは別ページを用意するのではなくトップページに作成していきます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>config/routes.rb</code>を以下のように更新してください。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">config/routes.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">devise_for</span> <span class="ss">:users</span>
  <span class="n">resources</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
  <span class="n">root</span> <span class="ss">to</span><span class="p">:</span> <span class="s2">"top#index"</span>
  <span class="n">resources</span> <span class="ss">:groups</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
<span class="hll">  <span class="n">resources</span> <span class="ss">:questions</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:create</span><span class="o">]</span>
</span></pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">今回は投稿のアクションのみを設定しました。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/controllers/top_controller.rb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/top_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">TopController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
<span class="hll">    <span class="vi">@question</span> <span class="o">=</span> <span class="no">Question</span><span class="o">.</span><span class="n">new</span>
</span>  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">ここではindexアクションを定義しました。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/top/index.html.erb</code>を以下のように更新してください。</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/top/index.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="cp">&lt;%</span> <span class="k">unless</span> <span class="n">current_user</span><span class="o">.</span><span class="n">full_profile?</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">"header_top panel panel-default col-lg-12 no-profile"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;</span>まずは、あなたの基本プロフィールを登録しましょう！<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;p&gt;</span>Profyは友達の質問に答えながらプロフィールを作るサービスです！<span class="nt">&lt;/p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'プロフィールを登録する'</span><span class="p">,</span> <span class="n">edit_user_path</span><span class="p">(</span><span class="n">current_user</span><span class="p">),</span> <span class="p">{</span><span class="ss">class</span><span class="p">:</span> <span class="s1">'btn btn-lg btn-primary withripple'</span> <span class="p">}</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/header&gt;</span>
<span class="cp">&lt;%</span> <span class="k">else</span> <span class="cp">%&gt;</span>
<span class="hll">  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"posting_form top_content"</span><span class="nt">&gt;</span>
</span><span class="hll">    <span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">"posting_header"</span><span class="nt">&gt;</span>
</span><span class="hll">      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"posting_image icon_image"</span> <span class="na">style=</span><span class="s">"background-image: url(</span><span class="cp">&lt;%=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">avatar</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="ss">:medium</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="s">);"</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class="hll">      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"posting_user_info user_info"</span><span class="nt">&gt;</span>
</span><span class="hll">        <span class="cp">&lt;%=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span>
</span><span class="hll">      <span class="nt">&lt;/div&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/header&gt;</span>
</span><span class="hll">    <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@question</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
</span><span class="hll">      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:text</span><span class="p">,</span> <span class="ss">placeholder</span><span class="p">:</span> <span class="s2">"例：好きな食べ物は？"</span> <span class="cp">%&gt;</span>
</span><span class="hll">      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">"質問する"</span> <span class="cp">%&gt;</span>
</span><span class="hll">    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</span><span class="hll">  <span class="nt">&lt;/div&gt;</span>
</span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">モデルに紐付いたフォームはform_forメソッドを利用します。コントローラーからインスタンスを渡していないとエラーになるので気をつけてください。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>localhost:3000</code>にアクセスして下の画像のようにフォームが作成されたことを確認してみましょう。</h3>

<p class="ng-scope"><img src="top-page-question-only.png" alt="text"></p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="543" action="http://master.tech-camp.in/curriculums/149#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-772" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-772" name="check-772" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">config/routes.rbを編集できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-773" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-773" name="check-773" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/controllers/top_controller.rbを編集できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-774" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-774" name="check-774" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/views/top/index.html.erbを編集できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-775" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-775" name="check-775" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">localhost:3000にアクセスしてフォームが作成されたことを確認できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope">次に実際に投稿できるようにquestionsコントローラーと投稿用のアクションを設定していきます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> ターミナルで以下のコマンドを実行し、questionsコントローラーを作成しましょう。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="err">$</span> <span class="n">rails</span> <span class="n">g</span> <span class="n">controller</span> <span class="n">questions</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">app/controllers/questions_controller.rbのように、questionsコントローラーが作成されましたね。<br>
続いて、textカラムに加え、user_idカラムとgroup_idカラムをストロングパラメーターに追加しましょう。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_502"></i> mergeメソッド</h3>

<p class="ng-scope">mergeメソッドは２つのハッシュを統合する時に使います。</p>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">例</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="n">hash1</span> <span class="o">=</span> <span class="p">{</span><span class="ss">question</span><span class="p">:</span> <span class="s2">"Who is your favorite artist?"</span><span class="p">}</span>
<span class="n">hash2</span> <span class="o">=</span> <span class="p">{</span><span class="ss">group</span><span class="p">:</span> <span class="s2">"tech_camp"</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s2">"abe"</span><span class="p">}</span>
<span class="n">hash1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">hash2</span><span class="p">)</span>
<span class="c1">#=&gt; {:question=&gt;"Who is your favorite artist?", :group=&gt;"tech_camp", :name=&gt;"abe"}</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">今までは、アクションに<code>Question.create(text: create_params[:text], user_id: current_user.id, group_id: current_user.group_id)</code>のようにハッシュのキーと値をそれぞれ書いてい<br>
ました。今回はmergeメソッドを使うことによって、ストロングパラメーター(create_params)が生成される際にuser_idとgroup_idのキーと値を持つハッシュを追加することができます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/controllers/questions_controller.rb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/questions_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">QuestionsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
<span class="hll">  <span class="k">def</span> <span class="nf">create</span>
</span><span class="hll">    <span class="no">Question</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">create_params</span><span class="p">)</span>
</span><span class="hll">    <span class="n">redirect_to</span> <span class="ss">:root</span> <span class="ow">and</span> <span class="k">return</span>
</span><span class="hll">  <span class="k">end</span>
</span>
<span class="hll">  <span class="kp">private</span>
</span><span class="hll">  <span class="k">def</span> <span class="nf">create_params</span>
</span><span class="hll">    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:question</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:text</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="ss">user_id</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="ss">group_id</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">group_id</span><span class="p">)</span>
</span><span class="hll">  <span class="k">end</span>
</span><span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">quisionsをcreateしたあとはトップページにリダイレクトするように設定しました。<br>
<code>redirect_to :root and return</code>のand returnの部分に注目して下さい。<br>
<code>redirect_to :root</code>を書くだけではアクション内の処理は終了せず次の行のコードを実行していってしまいます。<br>
今回のケースでは下に続く処理がないので問題ないのですが、慣習的につけるようにするのがベターです。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> それでは、実際に投稿してデータベースに正しく保存されることを確認してみましょう。</h3>

<p class="ng-scope"><img src="post_question_after.png" alt="text"></p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="544" action="http://master.tech-camp.in/curriculums/149#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-776" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-776" name="check-776" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">qustions_controller.rbを作成し、編集することができた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-777" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-777" name="check-777" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">実際に投稿してデータベースに正しく保存されることを確認できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 id="5" class="ng-scope">質問をタイムラインに表示する</h2>

<div class="challenge ng-scope">
<h3>
<i class="icon crown"></i> 問題2：@questionsに、現在ログインしているユーザーが所属するグループの質問を全て取得しましょう。</h3>

 <h5>ファイル：app/controllers/top_controller.rb</h5>
 <h5>ヒント： アソシエーションを活用しましょう</h5>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/top_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">TopController</span> 
</pre></div>
</td>
</tr></tbody></table>
</div>

<curriculum-question-container class="ng-scope" data-order="2"><button style="" class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button style="" class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
</div>

<p class="ng-scope">アソシエーションを利用して同じグループの質問を全て取得しています。<br>
Groupモデルのアソシエーションのオプションに<code>-&gt;{ order("created_at DESC") }</code>をしているためcreated_atでソートされて取得できます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/top/index.html.erb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/top/index.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"posting_form top_content"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">"posting_header"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"posting_image icon_image"</span> <span class="na">style=</span><span class="s">"background-image: url(</span><span class="cp">&lt;%=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">avatar</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="ss">:medium</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="s">);"</span><span class="nt">&gt;&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"posting_user_info user_info"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@question</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:text</span><span class="p">,</span> <span class="ss">placeholder</span><span class="p">:</span> <span class="s2">"例：好きな食べ物は？"</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">"質問する"</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

<span class="hll">  <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial</span><span class="p">:</span> <span class="s2">"questions/question"</span><span class="p">,</span> <span class="ss">collection</span><span class="p">:</span> <span class="vi">@questions</span> <span class="cp">%&gt;</span>
</span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">21行目<code>&lt;%= render partial: "questions/question", collection: @questions %&gt;</code>で部分テンプレートを利用しています。<br>
renderメソッドでこのように指定するとアンダーバーをつけて単数形にしたファイルが部分テンプレートとして読まれることは既に学習しましたね。<br>
部分テンプレートを作成していきましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> アンダーバーをつけて単数形にしたファイル<code>app/views/questions/_question.html.erb</code>を作成してください。</h3>

<ul class="filetree ng-scope">
  <li class="t-folder"> app
    <ul>
      <li class="t-folder"> views
        <ul>
          <li class="t-folder"> questions
            <ul>
              <li class="t-file">_question.html.erb</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/questions/_question.html.erb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/questions/_question.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"question_content top_content"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">"question_header"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"question_image icon_image"</span> <span class="na">style=</span><span class="s">"background-image: url(</span><span class="cp">&lt;%=</span> <span class="n">question</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">avatar</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="ss">:medium</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="s">);"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"question_user_info user_info"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">question</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">user_path</span><span class="p">(</span><span class="n">question</span><span class="o">.</span><span class="n">user</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;time&gt;</span><span class="cp">&lt;%=</span> <span class="n">time_ago_in_words</span> <span class="n">question</span><span class="o">.</span><span class="n">created_at</span> <span class="cp">%&gt;</span><span class="nt">&lt;/time&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/header&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"question_body"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"question_box"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"q"</span><span class="nt">&gt;</span>Q<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"question_text"</span><span class="nt">&gt;</span><span class="cp">&lt;%=</span> <span class="n">question</span><span class="o">.</span><span class="n">text</span> <span class="cp">%&gt;</span><span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">6行目のtime_agoメソッドで 時間表示を変更しています。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_503"></i> time_ago_in_words</h3>

<p class="ng-scope">投稿時間を「○○時間前」のようにしたい場合に利用するビューヘルパーメソッドです。<br>
特にgemを追加する必要なく利用することができます。デフォルトだと英語なのでrailsの環境設定を日本語で表示したい場合は、<code>config/application.rb</code>の言語設定を日本語（<code>config.i18n.default_locale = :ja</code>）にしておく必要があります。また、日本語の文言表示のために<code>config/locales</code>以下に<code>ja.yml</code>を配置しておきましょう。</p>

<p class="ng-scope">※日本語設定は前章で終了しています。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>localhost:3000</code>にアクセスして質問が表示されることを確認してみましょう。</h3>

<p class="ng-scope"><img src="add-question-to-top.png" alt="text"></p>

<p class="ng-scope">続いて、追加で質問を投稿して表示を確認してみましょう。</p>

<p class="ng-scope"><img src="add-question-to-top2.png" alt="text"></p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="546" action="http://master.tech-camp.in/curriculums/149#">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-781" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-781" name="check-781" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">time_ago_in_wordsで「○○時間前」のように表示することができる</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="545" action="http://master.tech-camp.in/curriculums/149#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-778" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-778" name="check-778" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/controllers/top_controller.rbを編集できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-779" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-779" name="check-779" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/views/top/index.html.erbを編集できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-780" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-780" name="check-780" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/views/top/_question.html.erbを作成し、編集できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-782" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-782" name="check-782" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">localhost:3000にアクセスして質問が表示される</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h1 id="6" class="ng-scope">質問に回答できるようにする</h1>

<p class="ng-scope">質問ばかりでもつまらないですよね。回答できるようにしていきましょう。</p>

<h2 id="7" class="ng-scope">回答用のモデルを生成する</h2>

<p class="ng-scope">回答は、「本文」に加えて「どの質問」に対して「誰が」投稿したのかという情報を保存する必要があります。<br>
そのためuser_idとquestion_idとをカラムに加えます。どのグループで投稿したのかという情報はリレーション先のquestionsテーブルに保存されているためanswersテーブルには必要はありません。</p>

<table class="ng-scope">
<thead>
<tr>
<th style="text-align: center;">カラム名</th>
<th style="text-align: center;">型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">question_id</td>
<td style="text-align: center;">Integer</td>
</tr>
<tr>
<td style="text-align: center;">user_id</td>
<td style="text-align: center;">Integer</td>
</tr>
<tr>
<td style="text-align: center;">text</td>
<td style="text-align: center;">Text</td>
</tr>
</tbody>
</table>

<div class="challenge ng-scope">
<h3>
<i class="icon crown"></i> 問題3：answerモデルを作成し、各カラムを追加しましょう。</h3>
<h5>作業場所：ターミナル,db/migrate/2015xxxxxxxxxx_create_answers.rb</h5>
<h5>ヒント： なし</h5>

<curriculum-question-container class="ng-scope" data-order="3"><button style="" class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button style="" class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
</div>

<h3 class="ng-scope">
<i class="icon pen"></i> モデルにアソシエーションを定義しましょう</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/models/question.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Question</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>

  <span class="c1">#association</span>
  <span class="n">belongs_to</span> <span class="ss">:user</span>
  <span class="n">belongs_to</span> <span class="ss">:group</span>
<span class="hll">  <span class="n">has_many</span> <span class="ss">:answers</span>
</span>
  <span class="c1">#validation</span>
  <span class="n">validates_presence_of</span> <span class="ss">:user_id</span><span class="p">,</span> <span class="ss">:text</span><span class="p">,</span> <span class="ss">:group_id</span>
<span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/models/user.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>

  <span class="c1">#accessor</span>
  <span class="kp">attr_accessor</span> <span class="ss">:group_key</span>

  <span class="c1"># Include default devise modules. Others available are:</span>
  <span class="c1"># :confirmable, :lockable, :timeoutable and :omniauthable</span>
  <span class="n">devise</span> <span class="ss">:database_authenticatable</span><span class="p">,</span> <span class="ss">:registerable</span><span class="p">,</span>
         <span class="ss">:recoverable</span><span class="p">,</span> <span class="ss">:rememberable</span><span class="p">,</span> <span class="ss">:trackable</span><span class="p">,</span> <span class="ss">:validatable</span><span class="p">,</span> <span class="ss">:confirmable</span><span class="p">,</span> <span class="ss">:authentication_keys</span> <span class="o">=&gt;</span> <span class="o">[</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:group_key</span> <span class="o">]</span>

  <span class="c1">#validation</span>
  <span class="n">before_validation</span> <span class="ss">:group_key_to_id</span><span class="p">,</span> <span class="k">if</span><span class="p">:</span> <span class="ss">:has_group_key?</span>

  <span class="c1">#association</span>
  <span class="n">belongs_to</span> <span class="ss">:group</span>
  <span class="n">has_many</span> <span class="ss">:questions</span><span class="p">,</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="n">order</span><span class="p">(</span><span class="s2">"created_at DESC"</span><span class="p">)</span> <span class="p">}</span>
<span class="hll">  <span class="n">has_many</span> <span class="ss">:answers</span><span class="p">,</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="n">order</span><span class="p">(</span><span class="s2">"updated_at DESC"</span><span class="p">)</span> <span class="p">}</span>
</span></pre></div>
</td>
</tr></tbody></table>
</div>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/models/answer.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Answer</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="hll">  <span class="n">belongs_to</span> <span class="ss">:question</span>
</span><span class="hll">  <span class="n">belongs_to</span> <span class="ss">:user</span>
</span> <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<hr class="ng-scope">

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="547" action="http://master.tech-camp.in/curriculums/149#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-783" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-783" name="check-783" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">回答用のモデルを生成できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-784" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-784" name="check-784" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">ぞれぞれにアソシエーションを定義できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 id="8" class="ng-scope">質問に回答ボタンをつける</h2>

<p class="ng-scope">回答の情報を扱うモデルを定義することができました。<br>
実際に投稿できるようにしていきましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>config/routes.rb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">config/routes.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">devise_for</span> <span class="ss">:users</span>
  <span class="n">resources</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
  <span class="n">root</span> <span class="ss">to</span><span class="p">:</span> <span class="s2">"top#index"</span>
  <span class="n">resources</span> <span class="ss">:groups</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
  <span class="n">resources</span> <span class="ss">:questions</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:create</span><span class="o">]</span>
<span class="hll">  <span class="n">resources</span> <span class="ss">:answers</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:new</span><span class="p">,</span> <span class="ss">:create</span><span class="o">]</span>
</span></pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">質問の表示箇所から直接回答できるように、先ほど作成した部分テンプレートに回答ボタンをつけていきます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/questions/_question.html.erb</code>を以下のように更新し、回答ボタンを追加しましょう。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/views/questions/_question.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">"question_content top_content"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">header</span> <span class="n">class</span><span class="o">=</span><span class="s2">"question_header"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">"question_image icon_image"</span> <span class="n">style</span><span class="o">=</span><span class="s2">"background-image: url(&lt;%= question.user.avatar.url(:medium) %&gt;);"</span><span class="o">&gt;&lt;</span><span class="sr">/div&gt;</span>
<span class="sr">    &lt;div class="question_user_info user_info"&gt;</span>
<span class="sr">      &lt;span&gt;&lt;%= question.user.name %&gt;&lt;/s</span><span class="n">pan</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">time</span><span class="o">&gt;&lt;</span><span class="sx">%= time_ago_in_words question.created_at %&gt;&lt;/time&gt;</span>
<span class="sx">    &lt;/div&gt;</span>
<span class="sx">  &lt;/header&gt;</span>
<span class="sx">  &lt;div class=</span><span class="s2">"question_body"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">"question_box"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">"q"</span><span class="o">&gt;</span><span class="n">Q</span><span class="o">&lt;</span><span class="sr">/span&gt;</span>
<span class="sr">      &lt;span class="question_text"&gt;&lt;%= question.text %&gt;&lt;/s</span><span class="n">pan</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="sr">/div&gt;</span>
<span class="hll"><span class="sr">    &lt;div class="questioned"&gt;</span>
</span><span class="hll"><span class="sr">      &lt;span&gt;回答&lt;%= question.answers.count %&gt;件&lt;/s</span><span class="n">pan</span><span class="o">&gt;</span>
</span><span class="hll">    <span class="o">&lt;</span><span class="sr">/div&gt;</span>
</span><span class="hll"><span class="sr">    &lt;%= form_tag(new_answer_path, method: :get, class: "question_submit") do %&gt;</span>
</span><span class="hll"><span class="sr">      &lt;%= hidden_field_tag(:question_id, question.id) %&gt;</span>
</span><span class="hll"><span class="sr">      &lt;%= submit_tag("回答する") %&gt;</span>
</span><span class="hll"><span class="sr">    &lt;% end %&gt;</span>
</span><span class="sr">  &lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="sr">/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<ul class="ng-scope">
<li>18行目に注目してください。</li>
</ul>

<p class="ng-scope">form_tagメソッド内に、hidden_field_tag という見慣れない表記があります。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_504"></i> hidden_field_tag</h3>

<p class="ng-scope">hidden_field_tag は、ユーザーが入力する必要の無い自明のデータをパラメーターとして送信したい時に利用します。</p>

<p class="ng-scope">上記では、:question_id というキーに対して個別のquestionのidを値として設定しています。<br>
このことにより、パラメーターが送られた先では、params[:question_id] とするだけで簡単に対応する質問のidを取得することができます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>localhost:3000</code>にアクセスして回答ボタンが追加されたこと確認しましょう。</h3>

<p class="ng-scope"><img src="add-answer-to-top.png" alt="text"></p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="548" action="http://master.tech-camp.in/curriculums/149#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-785" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-785" name="check-785" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">config/routes.rbを編集できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-786" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-786" name="check-786" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/views/questions/_question.html.erbを編集できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-787" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-787" name="check-787" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">localhost:3000にアクセスして回答ボタンが追加されたこと確認できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 id="9" class="ng-scope">回答ページを作成する</h2>

<p class="ng-scope">トップページの「回答する」ボタンを押したときの遷移先を作成していきます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> ターミナルで以下のコマンドを実行しanswersコントローラーを作成しましょう。</h3>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nv">$ </span>rails g controller answers
</pre></div>
</td>
</tr></tbody></table>
</div>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/controllers/answers_controller.rb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/answers_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">AnswersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

<span class="hll">  <span class="k">def</span> <span class="nf">new</span>
</span><span class="hll">    <span class="vi">@question</span> <span class="o">=</span> <span class="no">Question</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:question_id</span><span class="o">]</span><span class="p">)</span>
</span><span class="hll">    <span class="vi">@answer</span> <span class="o">=</span> <span class="no">Answer</span><span class="o">.</span><span class="n">new</span>
</span><span class="hll">    <span class="vi">@answer</span><span class="o">.</span><span class="n">question_id</span> <span class="o">=</span> <span class="vi">@question</span><span class="o">.</span><span class="n">id</span>
</span><span class="hll">  <span class="k">end</span>
</span>
<span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<ul class="ng-scope">
<li>6行目に注目してください。</li>
</ul>

<p class="ng-scope">回答を新規登録する際には、その回答に対応するquestionのidも関連付けて保存したいため、@answerのプロパティ値としてあらかじめセットしています。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/answers/new.html.erb</code>を作成してください。</h3>

<ul class="filetree ng-scope">
  <li class="t-folder"> app
    <ul>
      <li class="t-folder"> views
        <ul>
          <li class="t-folder"> answers
            <ul>
              <li class="t-file"> new.html.erb</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/answers/new.html.erb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/answers/new.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row form"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-12"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@answer</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;h3&gt;&lt;span&gt;</span>Q<span class="nt">&lt;/span&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@question</span><span class="o">.</span><span class="n">text</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h3&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_area</span> <span class="ss">:text</span><span class="p">,</span> <span class="ss">placeholder</span><span class="p">:</span> <span class="s2">"回答を入力してください"</span><span class="p">,</span> <span class="ss">cols</span><span class="p">:</span><span class="s2">"30"</span><span class="p">,</span> <span class="ss">rows</span><span class="p">:</span><span class="s2">"10"</span><span class="p">,</span> <span class="ss">autofocus</span><span class="p">:</span><span class="s2">"true"</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span><span class="s2">"form-control"</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">hidden_field</span> <span class="ss">:question_id</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">"回答する"</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span><span class="s2">"btn btn-primary withripple"</span><span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<ul class="ng-scope">
<li>8行目に注目してください。</li>
</ul>

<p class="ng-scope">ここでも hidden_field を用いて、ユーザーが入力する必要の無い自明の値がパラメーターとして設定されています。<br>
hidden_fieldをform_forメソッド内で使用する際には <code>f.hidden_field :カラム名</code> の形で指定します。</p>

<p class="ng-scope">form_forメソッドを利用してどのようなHTMLが生成されているかは、ブラウザの「要素を検証」で確認しておきましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> 質問回答画面の表示を確認してみましょう。</h3>

<p class="ng-scope"><img src="answer-page.png" alt="text"></p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="549" action="http://master.tech-camp.in/curriculums/149#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-788" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-788" name="check-788" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">answers_controller.rbを作成・編集できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-789" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-789" name="check-789" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/views/answers以下にnew.html.erbを作成・編集できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-790" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-790" name="check-790" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/views/questions/new.html.erbを編集できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-791" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-791" name="check-791" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/views/answers/new.html.erbを作成・編集できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-792" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-792" name="check-792" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">質問回答画面の表示を確認できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 id="10" class="ng-scope">回答を投稿できるようにする</h2>

<p class="ng-scope">回答を保存する処理を記述していきましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/controllers/answers_controller.rb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/answers_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">AnswersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@question</span> <span class="o">=</span> <span class="no">Question</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:question_id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@answer</span> <span class="o">=</span> <span class="no">Answer</span><span class="o">.</span><span class="n">new</span>
    <span class="vi">@answer</span><span class="o">.</span><span class="n">question_id</span> <span class="o">=</span> <span class="vi">@question</span><span class="o">.</span><span class="n">id</span>
  <span class="k">end</span>

<span class="hll">  <span class="k">def</span> <span class="nf">create</span>
</span><span class="hll">    <span class="vi">@answer</span> <span class="o">=</span> <span class="no">Answer</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">create_params</span><span class="p">)</span>
</span><span class="hll">  <span class="k">end</span>
</span>
  <span class="kp">private</span>
  <span class="k">def</span> <span class="nf">create_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:answer</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:question_id</span><span class="p">,</span> <span class="ss">:text</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="ss">user_id</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">ここでは、回答を投稿できるようにcreateアクションを定義しました。<br>
続いて、ビューを作成します。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/answers/create.html.erb</code>を作成してください。</h3>

<ul class="filetree ng-scope">
  <li class="t-folder"> app
    <ul>
      <li class="t-folder"> views
        <ul>
          <li class="t-folder"> answers
            <ul>
              <li class="t-file"> create.html.erb</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/answers/create.html.erb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">/app/views/answers/create.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row form"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-12"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h3&gt;</span>回答の作成が完了しました。<span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;span&gt;</span>他の人の回答を見る<span class="nt">&lt;/span&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"ホームに戻る"</span><span class="p">,</span> <span class="c1">#ホームへのルートパス </span><span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">上記のように更新ができたら5行目のホームへのルートパスを編集する必要がありますね。</p>

<div class="challenge ng-scope">
<h3>
<i class="icon crown"></i> 問題4：ホームへのルートパスを編集しましょう。</h3>

<h5>作業ファイル：app/views/answers/create.html.erb</h5>
<h5>ヒント： ターミナルでルーティングの確認を行いましょう。</h5>

<div class="code-frame" data-lang="html">
<div class="code-lang"><span class="bold">/app/views/answers/create.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row form"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-12"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h3&gt;</span>回答の作成が完了しました。<span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;span&gt;</span>他の人の回答を見る<span class="nt">&lt;/span&gt;</span>
<span class="hll">    <span class="err">&lt;</span>%= link_to "ホームに戻る", #ホームへのルートパス %&gt;
</span>  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>


<curriculum-question-container class="ng-scope" data-order="4"><button style="" class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button style="" class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
</div>

<h3 class="ng-scope">
<i class="icon pen"></i> それでは、回答を投稿してテーブルに保存されていることを確認してみましょう。</h3>

<p class="ng-scope"><img src="submit-answer.png" alt="text"></p>

<p class="ng-scope"><img src="create-page.png" alt="text"></p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="550" action="http://master.tech-camp.in/curriculums/149#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-793" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-793" name="check-793" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/controllers/answers_controller.rbを作成できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-794" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-794" name="check-794" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/views/answers/create.html.erbを作成し、編集できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-795" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-795" name="check-795" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">回答を投稿してテーブルに保存されていることを確認できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h1 id="11" class="ng-scope">一問一答形式にする</h1>

<p class="ng-scope">今のままだとProfyはひとつの質問に複数回、回答を投稿できてしまいます。最終的に目指したい形は「<strong>一問一答形式で質問と答えを出しあうサービス</strong>」です。そのためにこれから、同一の質問に二度以上回答できないよう条件分岐を指定していきます。</p>

<h2 id="12" class="ng-scope">未回答の質問にのみ「回答する」ボタンが表示されるようにする</h2>

<p class="ng-scope">現在、質問に回答するためにはトップページにある「回答する」ボタンを押す必要があります。ひとまず、このボタンを「現在ログインしているユーザーがその質問に回答していない場合のみ表示する」という条件に変えてあげれば良さそうです。回答ボタンが表示されない条件の場合には、以下の画像のように「※回答済み※」というメッセージを表示しましょう。また、データの有無を確かめたいときに以下の様なメソッドを使用することができます。</p>

<p class="ng-scope"><img src="answered_message.png" alt="※回答済み※"></p>

<h3 class="ng-scope">
<i class="icon information" id="term_505"></i> exists? / present? / blank? メソッド</h3>

<p class="ng-scope"><code>.exists?</code> とは、Railsアプリケーションを作成した際にデフォルトで読み込まれる <code>ActiveSupport</code> というgemが実現しているヘルパーメソッドです。メソッドを呼び出したレシーバの中から引数として渡した条件で検索をかけ、データが存在すれば <code>true</code> を、無ければ <code>false</code> を返り値とします。<br>
あくまでもRubyが元々持つ機能では無いので、irb上などでは動作しないことに注意してください。</p>

<p class="ng-scope">似たようなメソッドとして <code>.present?</code> や <code>.blank?</code> もあります。こちらは、レシーバが空であるか否かを判別するものです。例えば、以下のように使うことができます。</p>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">[例]コンソール</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="n">fruit1</span> <span class="o">=</span> <span class="o">[</span><span class="s2">"apple"</span><span class="o">]</span>
  <span class="c1">#=&gt; ["apple"]</span>

  <span class="n">fruit2</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="c1">#=&gt; []</span>

  <span class="c1">## 値が空であることの検証</span>
  <span class="n">fruit1</span><span class="o">.</span><span class="n">blank?</span>
  <span class="c1">#=&gt; false</span>
  <span class="n">fruit2</span><span class="o">.</span><span class="n">blank?</span>
  <span class="c1">#=&gt; true</span>

  <span class="c1">## 値が空でないことの検証</span>
  <span class="n">fruit1</span><span class="o">.</span><span class="n">present?</span>
  <span class="c1">#=&gt; true</span>
  <span class="n">fruit2</span><span class="o">.</span><span class="n">present?</span>
  <span class="c1">#=&gt; false</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">ちなみに、exists?/present?/blank?メソッドにおいて「空」とみなされる値は以下のとおりです。</p>

<ul class="ng-scope">
<li>値がnilまたはfalse</li>
<li>空白文字だけで構成された文字列</li>
<li>中身が空欄の配列またはハッシュオブジェクト</li>
</ul>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題5：部分テンプレートを編集して、まだ回答していない質問にのみ回答できるようにしてみましょう。</h3>

  <h5>作業ファイル：app/views/questions/_question.html.erb</h5>
  <h5>ヒント： 条件分岐を使用して、未回答の質問にのみ回答ボタンが表示されるようにします。</h5>

<div class="code-frame" data-lang="html">
<div class="code-lang"><span class="bold">app/views/questions/_question.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td>
<td class="code">
<div class="highlight"><pre>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"questioned"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span&gt;</span>回答<span class="err">&lt;</span>%= question.answers.count %&gt;件<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
<span class="hll">      <span class="err">&lt;</span>% その質問への回答の中に、今ログインしているユーザーが答えたものが無かった場合 %&gt;
</span>        <span class="err">&lt;</span>%= form_tag(new_answer_path, method: :get, class: "question_submit") do %&gt;
          <span class="err">&lt;</span>%= hidden_field_tag(:question_id, question.id) %&gt;
          <span class="err">&lt;</span>%= submit_tag("回答する") %&gt;
        <span class="err">&lt;</span>% end %&gt;
<span class="hll">      <span class="err">&lt;</span>% else %&gt;
</span><span class="hll">        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"answer_other"</span><span class="nt">&gt;</span>
</span><span class="hll">          <span class="nt">&lt;h4&gt;</span>※回答済み※<span class="nt">&lt;/h4&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/div&gt;</span>
</span><span class="hll">      <span class="err">&lt;</span>% end %&gt;
</span>    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

  <curriculum-question-container class="ng-scope" data-order="5"><button style="" class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button style="" class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
</div>

<h2 id="13" class="ng-scope">コントローラーにリダイレクトを設定する</h2>

<p class="ng-scope">上記の作業で一度回答した質問には「回答する」ボタンが表示されなくなりました。しかし、一度回答した質問であっても直接<code>/answers/new?question_id=1</code>というようなパスにアクセスすることで回答することができてしまいます。</p>

<p class="ng-scope">そこで、一度回答したユーザーが直接回答画面にアクセスしてきた際にはホーム画面に遷移するように設定を行ないます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/controllers/answers_controller.rb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/answers_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">AnswersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

<span class="hll">  <span class="n">before_action</span> <span class="ss">:redirect</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="ss">:new</span>
</span>
  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@question</span> <span class="o">=</span> <span class="no">Question</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:question_id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@answer</span> <span class="o">=</span> <span class="no">Answer</span><span class="o">.</span><span class="n">new</span>
    <span class="vi">@answer</span><span class="o">.</span><span class="n">question_id</span> <span class="o">=</span> <span class="vi">@question</span><span class="o">.</span><span class="n">id</span>
  <span class="k">end</span>

  <span class="c1">#中略</span>

  <span class="kp">private</span>
  <span class="k">def</span> <span class="nf">create_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:answer</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:question_id</span><span class="p">,</span> <span class="ss">:text</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="ss">user_id</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
  <span class="k">end</span>

<span class="hll">  <span class="k">def</span> <span class="nf">redirect</span>
</span><span class="hll">    <span class="k">if</span> <span class="no">Answer</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="ss">question_id</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:question_id</span><span class="o">]</span><span class="p">,</span> <span class="ss">user_id</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span class="hll">      <span class="n">redirect_to</span> <span class="ss">:root</span>
</span><span class="hll">    <span class="k">end</span>
</span><span class="hll">  <span class="k">end</span>
</span>
<span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h3 class="ng-scope">・3行目</h3>

<p class="ng-scope">before_actionメソッドを使って、newアクションの際にredirectメソッドを呼び出すように実装しました。</p>

<h3 class="ng-scope">・18行目〜22行目</h3>

<p class="ng-scope">exist?メソッドを用いてユーザーが回答済みかどうかを確認し、redirect_toメソッドを使い、回答済みの場合にはホーム画面に遷移させるようにしました。</p>

<p class="ng-scope">これで、ユーザーは質問に一度しか回答できないようになりました。</p>

<h3 class="ng-scope">
<i class="icon attention"></i> ここまでの記述に問題がなければ、Sequel Proから<strong>answersテーブルのレコードをすべて削除してください</strong>。</h3>

<h3 class="ng-scope">
<i class="icon pen"></i> 新たにトップページから質問に回答して表示を確認してみましょう。</h3>

<p class="ng-scope"><img src="answered_feed.png" alt="回答済みトップページ"></p>

<p class="ng-scope">これでひとつの質問に対しては、一度しか回答できないようになりました。</p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="1458" action="http://master.tech-camp.in/curriculums/149#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-2007" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-2007" name="check-2007" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">部分テンプレートを編集し、ひとつの質問に一度しか回答できないようにした</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h1 id="14" class="ng-scope">回答を閲覧できるようにする</h1>

<p class="ng-scope">せっかく回答を投稿できるようになっても閲覧できないと意味がありません。<br>
投稿した回答を閲覧できるように実装していきましょう。</p>

<h2 id="15" class="ng-scope">個別質問ページで回答を閲覧できるようにする</h2>

<p class="ng-scope">質問への回答は質問の個別ページで見れるようにします。<br>
質問への個別ページはトップページの「回答◯件」から遷移します。</p>

<p class="ng-scope"><img src="link-show-question.png" alt="text"></p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>config/routes.rb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">config/routes.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">devise_for</span> <span class="ss">:users</span>
  <span class="n">resources</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
  <span class="n">root</span> <span class="ss">to</span><span class="p">:</span> <span class="s2">"top#index"</span>
  <span class="n">resources</span> <span class="ss">:groups</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
<span class="hll">  <span class="n">resources</span> <span class="ss">:questions</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:create</span><span class="p">,</span> <span class="ss">:show</span><span class="o">]</span>
</span>  <span class="n">resources</span> <span class="ss">:answers</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:new</span><span class="p">,</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/controllers/questions_controller.rb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/questions_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">QuestionsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="no">Question</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">create_params</span><span class="p">)</span>
    <span class="n">redirect_to</span> <span class="ss">:root</span> <span class="ow">and</span> <span class="k">return</span>
  <span class="k">end</span>

<span class="hll">  <span class="k">def</span> <span class="nf">show</span>
</span><span class="hll">    <span class="vi">@question</span> <span class="o">=</span> <span class="no">Question</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class="hll">    <span class="vi">@answers</span> <span class="o">=</span> <span class="vi">@question</span><span class="o">.</span><span class="n">answers</span>
</span><span class="hll">  <span class="k">end</span>
</span>
  <span class="kp">private</span>
  <span class="k">def</span> <span class="nf">create_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:question</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:text</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="ss">user_id</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="ss">group_id</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">group_id</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">ここでは、質問への回答を見れるようにするためにshowアクションを定義しました。</p>

<p class="ng-scope">インスタンス変数<strong>@question</strong>には質問のレコードがひとつ入ります。トップページから質問個別ページヘのリンクを踏んだ際に、パラメーターとして送られる質問のidを利用し、同一の質問のレコードを取得しています。<strong>@answers</strong>には、@questionsに関係する回答を全て取得し定義しています。</p>

<p class="ng-scope">続いて、ビューファイルを作成します。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/questions/show.html.erb</code>を作成してください。</h3>

<ul class="filetree ng-scope">
  <li class="t-folder"> app
    <ul>
      <li class="t-folder"> views
        <ul>
          <li class="t-folder"> questions
            <ul>
              <li class="t-file">show.html.erb</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/questions/show.html.erb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/questions/show.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row form"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-12"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h3&gt;&lt;span&gt;</span>Q<span class="nt">&lt;/span&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@question</span><span class="o">.</span><span class="n">text</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"group_action panel panel-default"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-body"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%</span> <span class="k">unless</span> <span class="vi">@question</span><span class="o">.</span><span class="n">answers</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="ss">user_id</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="cp">%&gt;</span>
          <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'質問に回答する'</span><span class="p">,</span> <span class="n">new_answer_path</span><span class="p">(</span><span class="ss">question_id</span><span class="p">:</span> <span class="vi">@question</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%</span> <span class="k">else</span> <span class="cp">%&gt;</span>
          <span class="nt">&lt;h4&gt;</span>※回答済み※<span class="nt">&lt;/h4&gt;</span>
        <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">if</span> <span class="vi">@question</span><span class="o">.</span><span class="n">answers</span><span class="o">.</span><span class="n">present?</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;h3&gt;&lt;span&gt;</span>A<span class="nt">&lt;/span&gt;</span>この質問への回答<span class="nt">&lt;/h3&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial</span><span class="p">:</span> <span class="s2">"questions/answer"</span><span class="p">,</span> <span class="ss">collection</span><span class="p">:</span> <span class="vi">@answers</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h3 class="ng-scope">・6行目〜10行目</h3>

<p class="ng-scope">「回答する」ボタンの表示に対して条件分岐を設定しています。トップページの一覧に設定したのと同様に、既にユーザーがその質問に回答していた場合は回答ボタンが表示されず、代わりに「※回答済み※」と表示されます。</p>

<p class="ng-scope"><br>質問個別ページでは、その質問に関係する回答全てを表示します。繰り返し同じ型に当てはめて回答を表示したいので、部分テンプレートを用意してあげましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/questions/_answer.html.erb</code>を作成してください。</h3>

<ul class="filetree ng-scope">
  <li class="t-folder"> app
    <ul>
      <li class="t-folder"> views
        <ul>
          <li class="t-folder"> questions
            <ul>
              <li class="t-file">_answer.html.erb</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/questions/_answer.html.erb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/questions/_answer.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"col-md-12"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"sct_inner"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">answer</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">user_path</span><span class="p">(</span><span class="n">answer</span><span class="o">.</span><span class="n">user</span><span class="p">)</span> <span class="cp">%&gt;</span>さんの回答<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;h4&gt;</span>→<span class="cp">&lt;%=</span> <span class="n">answer</span><span class="o">.</span><span class="n">text</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h4&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/section&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">質問個別ページを表示するのに必要な要素が全て整いました。</p>

<p class="ng-scope">最後に「質問をタイムラインに表示する」のセクションで作成したテンプレートにも手を加え、質問個別ページへのリンクを生成します。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/questions/_question.html.erb</code>を以下のように更新し、質問個別ページヘのリンクを設定しましょう。</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/questions/_question.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"question_content top_content"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">"question_header"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"question_image icon_image"</span> <span class="na">style=</span><span class="s">"background-image: url(</span><span class="cp">&lt;%=</span> <span class="n">question</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">avatar</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="ss">:medium</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="s">);"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"question_user_info user_info"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">question</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">user_path</span><span class="p">(</span><span class="n">question</span><span class="o">.</span><span class="n">user</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;time&gt;</span><span class="cp">&lt;%=</span> <span class="n">time_ago_in_words</span> <span class="n">question</span><span class="o">.</span><span class="n">updated_at</span> <span class="cp">%&gt;</span><span class="nt">&lt;/time&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/header&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"question_body"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"question_box"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"q"</span><span class="nt">&gt;</span>Q<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"question_text"</span><span class="nt">&gt;</span><span class="cp">&lt;%=</span> <span class="n">question</span><span class="o">.</span><span class="n">text</span> <span class="cp">%&gt;</span><span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"questioned"</span><span class="nt">&gt;</span>
<span class="hll">      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"回答</span><span class="si">#{</span><span class="n">question</span><span class="o">.</span><span class="n">answers</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">件"</span><span class="p">,</span> <span class="n">question_path</span><span class="p">(</span><span class="n">question</span><span class="p">)</span> <span class="cp">%&gt;</span>
</span>    <span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">unless</span> <span class="n">question</span><span class="o">.</span><span class="n">answers</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="ss">user_id</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">form_tag</span><span class="p">(</span><span class="n">new_answer_path</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:get</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"question_submit"</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">hidden_field_tag</span><span class="p">(</span><span class="ss">:question_id</span><span class="p">,</span> <span class="n">question</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">submit_tag</span><span class="p">(</span><span class="s2">"回答する"</span><span class="p">)</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">else</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"answer_other"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h4&gt;</span>※回答済み※<span class="nt">&lt;/h4&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">質問回答後の画面の「他の人の回答を見る」という箇所のリンクもまだ、生成していませんでしたね。<br>
同様に質問個別ページヘのリンクを指定してあげましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/answers/create.html.erb</code>を以下のように更新し、質問個別ページヘのリンクを設定しましょう。</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">/app/views/answers/create.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row form"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-12"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h3&gt;</span>回答の作成が完了しました。<span class="nt">&lt;/h3&gt;</span>
<span class="hll">    <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"他の人の回答を見る"</span><span class="p">,</span> <span class="n">question_path</span><span class="p">(</span><span class="vi">@answer</span><span class="o">.</span><span class="n">question</span><span class="p">)</span> <span class="cp">%&gt;</span>
</span>    <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"ホームに戻る"</span><span class="p">,</span> <span class="n">root_path</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h3 class="ng-scope">
<i class="icon pen"></i> 個別質問ページの表示を確認してみましょう。</h3>

<p class="ng-scope">下の画像のように質問個別ページで回答が閲覧できるようになっていますね。</p>

<p class="ng-scope"><img src="show_question.png" alt="text"></p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="551" action="http://master.tech-camp.in/curriculums/149#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-796" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-796" name="check-796" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/controllers/questions_controller.rbを編集することができた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-797" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-797" name="check-797" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/views/questions/show.html.erbを作成し、編集することができた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-798" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-798" name="check-798" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/views/questions/_answer.html.erbを作成し、編集することができた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-799" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-799" name="check-799" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">個別質問ページの表示を確認できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope">無事回答を表示することができたでしょうか。段々とアプリケーションが出来てきましたね。</p>

<h2 id="16" class="ng-scope">ユーザーページで回答済みの質問を閲覧できるようにしよう</h2>

<p class="ng-scope">ユーザーページで「そのユーザーが既に答えた質問」を閲覧できるようにしましょう。<br>
指定したユーザーが答えた質問を取得するにはどうしたらいいでしょうか。ステップを踏んで考えてみます。</p>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">例</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="c1">#ユーザーが答えた回答を取得する(user_idを1とする)</span>
<span class="n">answers</span> <span class="o">=</span> <span class="no">Answer</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">user_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">#answersのquestion_idカラムの値で配列にする</span>
<span class="c1">#pluckメソッドで任意のカラムを配列として取得することが出来る</span>
<span class="n">question_ids</span> <span class="o">=</span> <span class="n">answers</span><span class="o">.</span><span class="n">pluck</span><span class="p">(</span><span class="ss">:question_id</span><span class="p">)</span>

<span class="c1">#ユーザーが答えた質問を重複なく取得する</span>
<span class="no">Question</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">question_ids</span><span class="p">)</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">上記のようにすれば取得することが可能ですが、ステップが多くで少しめんどうですよね。<br>
このAnswerを介したUserとQuestionの関係を<strong>多対多の関係</strong>と呼び、<strong>has_manyにthroughオプション</strong>を指定することで、1つテーブルを経由してインスタンスを取得することができます。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_506"></i> 多対多の関係</h3>

<p class="ng-scope">『Instagram』のようにひとつの写真に複数のタグ付けができるSNSをイメージしてみましょう。<br>
それぞれのテーブルに保存されているレコードの関係性は以下のようになります。</p>

<p class="ng-scope"><img src="many_to_many.png" alt="text"></p>

<p class="ng-scope">ひとつの写真には「東京／カフェ／おしゃれ」のように複数のタグが属しています。<br>
また同じ「東京」のタグに対してもたくさんの写真が投稿されるので、ひとつのタグに複数の写真が属しているとも言えます。<br>
このような関係を<strong>多対多の関係</strong>と呼びます。多対多の関係を表現するには、photos_tagsテーブルのような中間テーブルが必要です。</p>

<p class="ng-scope">中間テーブルには、<strong>「どの写真がどのタグと関連づいているか」</strong>という情報が全て記載されていることになります。<br>
ひとつのレコードには<strong>「photos_id × tags_id」の組み合わせがひとつ</strong>記録され、全ての写真とタグの組み合わせの数分、レコードが蓄積されていきます。10個の写真にそれぞれ3つずつタグが付いている場合、全ての関係性を表すのに中間テーブルのレコードは30個生成されるということになります。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_507"></i> has_many throughオプション</h3>

<p class="ng-scope">has_manyのthroughオプションは、モデルに多対多の関連を定義するときに利用します。<br>
<code>through</code>という名前のとおり、「〜を経由する」という意味です。</p>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">例</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="c1"># app/models/photo.rb</span>
<span class="k">class</span> <span class="nc">Photo</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:photos_tags</span>
<span class="hll">  <span class="n">has_many</span> <span class="ss">:tags</span><span class="p">,</span> <span class="ss">through</span><span class="p">:</span> <span class="ss">:photos_tags</span>
</span><span class="k">end</span>

<span class="c1"># app/models/tag.rb</span>
<span class="k">class</span> <span class="nc">Tag</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:photos_tags</span>
<span class="hll">  <span class="n">has_many</span> <span class="ss">:photos</span><span class="p">,</span> <span class="ss">through</span><span class="p">:</span> <span class="ss">:photos_tags</span>
</span><span class="k">end</span>

<span class="c1"># app/models/photos_tag.rb</span>
<span class="k">class</span> <span class="nc">PhotosTag</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:photo</span>
  <span class="n">belongs_to</span> <span class="ss">:tag</span>
<span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">上記のようなアソシエーションを定義することで、自動的に以下のようなメソッドが使えるようになります。</p>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">[例]</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="c1">#通常レコードの作成</span>
<span class="n">tag1</span> <span class="o">=</span> <span class="no">Tag</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"東京"</span><span class="p">)</span>
<span class="n">tag2</span> <span class="o">=</span> <span class="no">Tag</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"おしゃれ"</span><span class="p">)</span>
<span class="n">photo1</span> <span class="o">=</span> <span class="no">Photo</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">image</span><span class="p">:</span> <span class="s2">"cool_cafe.jpg"</span><span class="p">,</span> <span class="ss">location</span><span class="p">:</span> <span class="s2">"桜ヶ丘"</span><span class="p">)</span>


<span class="c1"># 多対多関係を定義したレコードの作成</span>
<span class="n">tag1</span><span class="o">.</span><span class="n">photos</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">image</span><span class="p">:</span> <span class="s2">"cute_shop.jpg"</span><span class="p">,</span> <span class="ss">location</span><span class="p">:</span> <span class="s2">"宇田川町"</span><span class="p">)</span>


<span class="c1"># リレーションの追加</span>
<span class="n">tag1</span><span class="o">.</span><span class="n">photos</span> <span class="o">&lt;&lt;</span> <span class="n">photo1</span>
<span class="n">photo1</span><span class="o">.</span><span class="n">tags</span> <span class="o">&lt;&lt;</span> <span class="n">tag2</span>


<span class="c1"># リレーションを利用したレコードの取得</span>
<span class="n">photo1</span><span class="o">.</span><span class="n">tags</span>
<span class="c1"># =&gt; #&lt;Tag id:1, name:"東京"&gt;,#&lt;Tag id:2, name:"おしゃれ"&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h3 class="ng-scope">・2〜4行目</h3>

<p class="ng-scope">ここでは単体のインスタンスを生成しています。今回使用する例は、nameプロパティを持ったtagインスタンスとimage及びlocationプロパティを持ったphotoインスタンスです。これらの間には多対多の関係が定義されています。</p>

<h3 class="ng-scope">・8行目</h3>

<p class="ng-scope">多対多の関係性を利用し、tag1に関係したphotoインスタンスを新たに生成しています。「 tag1<code>.photos</code>.create 」と、複数形になっていることに注意してください。</p>

<h3 class="ng-scope">・12〜13行目</h3>

<p class="ng-scope">後からインスタンス同士を関連付けることも可能です。「<a href="http://master.tech-camp.in/curriculums/154#term_64">&lt;&lt;メソッド</a>」を使用するとこのように簡単に実現することができます。</p>

<p class="ng-scope">12行目では、tag1と関係しているphotosの配列に、新たにPhotoクラスのインスタンスを追加することでリレーションを生成しています。<br>
また13行目では同様に、photo1と関係しているtagsの配列に対し、新たにtag2とのアソシエーションを追加しています。</p>

<h3 class="ng-scope">・17行目</h3>

<p class="ng-scope">リレーションしている要素を全て出力することもできます。上記の例だと、photo1は12・13行目でそれぞれtag1・tag2に関連付けられているので、返り値としてtag1ならびにtag2のインスタンスが出力されています。</p>

<p class="ng-scope"><br>また、has_manyメソッドには他にも次のようなオプションを指定できます。</p>

<table class="wide ng-scope">
  <tbody><tr>
    <th>オプション名</th>
    <th>用途</th>
  </tr>
  <tr>
    <td>class_name</td>
    <td>関連するモデルのクラス名を指定でき、関連名(photos_tags等、has_manyの直後に書くもの)と参照先のクラス名(PhotosTagのようなモデル名)を異なるものにできる。</td>
  </tr>
  <tr>
    <td>foreign_key</td>
    <td>参照先を参照する外部キーの名前を指定できる（デフォルトは、参照先のモデル名_id）</td>
  </tr>
  <tr>
    <td>dependent</td>
    <td>親モデルのデータを消したら関連するモデルのデータも連動して消したいときに使用します。destroyとdelete_allでひとつひとつ消していくか、一気に消すかを指定できる</td>
  </tr>
  <tr>
    <td>source</td>
    <td>関連テーブルから先のモデルにアクセスするための(関連モデルから見た)関連名を指定できる</td>
  </tr>
</tbody></table>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="552" action="http://master.tech-camp.in/curriculums/149#">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-800" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-800" name="check-800" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">多対多の関係について理解できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-801" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-801" name="check-801" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">has_manyのthroughオプションは、モデルに多対多の関連を定義するときに利用</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope">それでは、今学んだ<code>has_many through</code>オプションを利用して自分の答えた質問一覧を取得していきましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/controllers/users_controller.rb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/users_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
<span class="hll">    <span class="vi">@questions</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">answered_questions</span><span class="o">.</span><span class="n">uniq</span>
</span>  <span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h3 class="ng-scope">・4行目</h3>

<p class="ng-scope">ユーザーページでユーザーの答えた質問を表示するために、<code>@user.answered_questions</code>で has_many throughオプション を利用しQuestionクラスのインスタンス配列を取得しています。<br>
メソッド <code>answered_questions</code>はこれから定義していきます。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_508"></i> uniqメソッド</h3>

<p class="ng-scope">4行目末尾に使用しているuniqメソッドは、配列の中の重複する要素を取り除いた値を返してくれるメソッドです。</p>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">例</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="n">fruits</span> <span class="o">=</span> <span class="o">[</span><span class="s2">"apple"</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="s2">"banana"</span><span class="o">]</span>
<span class="nb">p</span> <span class="n">fruits</span><span class="o">.</span><span class="n">uniq</span>

<span class="c1"># =&gt;["apple", "orange", "banana"]</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/models/user.rb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/models/user.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>

  <span class="c1">#accessor</span>
  <span class="kp">attr_accessor</span> <span class="ss">:group_key</span>

  <span class="c1"># Include default devise modules. Others available are:</span>
  <span class="c1"># :confirmable, :lockable, :timeoutable and :omniauthable</span>
  <span class="n">devise</span> <span class="ss">:database_authenticatable</span><span class="p">,</span> <span class="ss">:registerable</span><span class="p">,</span>
         <span class="ss">:recoverable</span><span class="p">,</span> <span class="ss">:rememberable</span><span class="p">,</span> <span class="ss">:trackable</span><span class="p">,</span> <span class="ss">:validatable</span><span class="p">,</span>
         <span class="ss">:confirmable</span><span class="p">,</span> <span class="ss">:authentication_keys</span> <span class="o">=&gt;</span> <span class="o">[</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:group_key</span> <span class="o">]</span>

  <span class="c1">#validation</span>
  <span class="n">before_validation</span> <span class="ss">:group_key_to_id</span><span class="p">,</span> <span class="k">if</span><span class="p">:</span> <span class="ss">:has_group_key?</span>

  <span class="c1">#association</span>
  <span class="n">belongs_to</span> <span class="ss">:group</span>
  <span class="n">has_many</span> <span class="ss">:questions</span><span class="p">,</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="n">order</span><span class="p">(</span><span class="s2">"created_at DESC"</span><span class="p">)</span> <span class="p">}</span>
<span class="hll">  <span class="n">has_many</span> <span class="ss">:answers</span><span class="p">,</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="n">order</span><span class="p">(</span><span class="s2">"updated_at DESC"</span><span class="p">)</span> <span class="p">}</span>
</span>  <span class="n">has_many</span> <span class="ss">:answered_questions</span><span class="p">,</span> <span class="ss">through</span><span class="p">:</span> <span class="ss">:answers</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="ss">:question</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h3 class="ng-scope">・18行目</h3>

<p class="ng-scope"><code>has_many :answered_question, through: :answers, source: :question</code><br>
このアソシエーション定義では、「自分の回答した質問」を取得しています。<br>
usersテーブルとquestionsテーブル、２つのテーブルの関連は1対多の関係で以下のことが成り立ちます。</p>

<ul class="ng-scope">
<li>ユーザーは複数(has_many)の質問をしている</li>
<li>質問はいずれかのユーザーに所属(belongs_to)している</li>
</ul>

<p class="ng-scope">加えて、回答(answers)という概念が存在することにより以下２つも成り立ちます。</p>

<ul class="ng-scope">
<li><strong>ユーザーは回答した質問が複数(user has_many answers)ある</strong></li>
<li><strong>特定の質問に回答された答えは複数(question has_many answers)ある</strong></li>
</ul>

<p class="ng-scope">このことから、answersテーブルを関連させてみるとusersテーブルとquestionsテーブルには<strong>1対多だけではなく、多対多の関係も生まれている</strong>事がわかります。</p>

<p class="ng-scope"><img src="has_many_through.jpg" alt="has_many_through"></p>

<p class="ng-scope"><code>sourceオプション</code>は関連テーブル（answers）から先のモデルにアクセスするための関連名を指定しています。今回はanswersテーブルを通し、questionsテーブルの情報を取得しているので<code>:question</code>を指定しました。</p>

<p class="ng-scope">アソシエーションの名前と関連先テーブルが同じ名前の場合、省略することもできます。今回の場合<code>has_many :questions</code>というアソシエーション名にしてしまえばsourceオプションを書く必要はありません。しかし、それだと User と Question を紐付ける通常の1対多のアソシエーション定義とかぶってしまうので<code>answered_question</code>という違う名前にしました。</p>

<p class="ng-scope">「答えた質問」という意味でより分かりやすいですよね。</p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="554" action="http://master.tech-camp.in/curriculums/149#">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-804" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-804" name="check-804" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">sourceオプションは関連テーブル（answers）から先のモデルにアクセスするための関連名を指定している</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="553" action="http://master.tech-camp.in/curriculums/149#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-802" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-802" name="check-802" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/controllers/users_controller.rbを編集できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-803" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-803" name="check-803" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/model/user.rbを編集できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope"><a href="http://master.tech-camp.in/curriculums/14#term_194">renderメソッド</a>を使って次は問題を解いてもらうので、忘れてしまった場合は一度振り返ってから<strong>問題6</strong>に取り組りましょう。</p>

<div class="challenge ng-scope">
<h3>
<i class="icon crown"></i> 問題6：renderメソッドの部分を編集し、部分テンプレートが表示できるようにしてみましょう。</h3>

<h5>作業ファイル：app/views/users/show.html.erb</h5>
<h5>ヒント①： partialオプションとcollectionオプションを使用します。</h5>
<h5>ヒント②： 呼び出す部分テンプレートは後で定義するので、今はまだ存在しません。</h5>

<div class="code-frame" data-lang="html">
<div class="code-lang"><span class="bold">app/views/users/show.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row form user_profile"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-12"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"image"</span> <span class="na">style=</span><span class="s">"background-image: url(&lt;%= @user.avatar.url(:medium) %&gt;);"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;h2&gt;</span><span class="err">&lt;</span>%= @user.name %&gt;<span class="nt">&lt;span&gt;</span><span class="err">&lt;</span>%= @user.name_kana %&gt;<span class="nt">&lt;/span&gt;&lt;/h2&gt;</span>
    <span class="err">&lt;</span>% if current_user <span class="err">&amp;&amp;</span> current_user.id == @user.id %&gt;
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"profile_edit"</span><span class="nt">&gt;</span>
        <span class="err">&lt;</span>%= link_to 'プロフィール編集', edit_user_path(current_user), {:class =&gt; 'btn btn-primary withripple' }%&gt;
      <span class="nt">&lt;/div&gt;</span>
    <span class="err">&lt;</span>% end %&gt;
    <span class="err">&lt;</span>% if @questions.present? %&gt;
      <span class="nt">&lt;h3&gt;</span>このユーザーの回答した質問<span class="nt">&lt;/h3&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"clearfix"</span><span class="nt">&gt;</span>
<span class="hll">        <span class="err">&lt;</span>%= render @questionsの配列の個数分、部分テンプレート(views/users/_question.html.erb)を表示させましょう。 %&gt;
</span>      <span class="nt">&lt;/div&gt;</span>
    <span class="err">&lt;</span>% end %&gt;
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<curriculum-question-container class="ng-scope" data-order="6"><button style="" class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button style="" class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
</div>

<p class="ng-scope">renderメソッド内で指定した部分テンプレートを作成していきましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/users/_question.html.erb</code>を作成してください。</h3>

<ul class="filetree ng-scope">
  <li class="t-folder"> app
    <ul>
      <li class="t-folder"> views
        <ul>
          <li class="t-folder"> users
            <ul>
              <li class="t-file">_question.html.erb</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/users/_question.html.erb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/users/_question.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"question_content top_content"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"question_body"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"question_box"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"q"</span><span class="nt">&gt;</span>Q<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"question_text"</span><span class="nt">&gt;</span><span class="cp">&lt;%=</span> <span class="n">question</span><span class="o">.</span><span class="n">text</span> <span class="cp">%&gt;</span><span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"answer_box"</span> <span class="na">style=</span><span class="s">"margin-bottom: 10px;"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"a"</span><span class="nt">&gt;</span>A<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"answer_text"</span><span class="nt">&gt;</span><span class="cp">&lt;%=</span> <span class="n">question</span><span class="o">.</span><span class="n">user_answer</span><span class="p">(</span><span class="vi">@user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="cp">%&gt;</span><span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h3 class="ng-scope">・9行目</h3>

<p class="ng-scope">ここで呼び出している user_answerメソッド は、ある特定のquestionのidとuserのidを用いて、<strong>指定の質問に対するユーザーの回答をanswersテーブルから取得する</strong>メソッドです。ひとつの質問、つまりQuestionクラスのインスタンスに対して使用するため、Questionモデルにこのメソッドは定義していきます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/models/question.rb</code>を以下のように編集してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/models/question.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Question</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1">#association</span>
  <span class="n">belongs_to</span> <span class="ss">:user</span>
  <span class="n">belongs_to</span> <span class="ss">:group</span>
  <span class="n">has_many</span> <span class="ss">:answers</span><span class="p">,</span> <span class="ss">dependent</span><span class="p">:</span> <span class="ss">:destroy</span>

  <span class="c1">#validation</span>
  <span class="n">validates_presence_of</span> <span class="ss">:user_id</span><span class="p">,</span> <span class="ss">:text</span><span class="p">,</span> <span class="ss">:group_id</span>

<span class="hll">  <span class="k">def</span> <span class="nf">user_answer</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span><span class="hll">      <span class="no">Answer</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">user_id</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span> <span class="ss">question_id</span><span class="p">:</span> <span class="nb">id</span><span class="p">)</span>
</span><span class="hll">  <span class="k">end</span>
</span><span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h3 class="ng-scope">・11行目</h3>

<h3 class="ng-scope">
<i class="icon information" id="term_509"></i> find_byメソッド</h3>

<p class="ng-scope">user_answerメソッド内部で使用している <code>find_byメソッド</code> は、検索条件に該当したレコードを一件だけ取得するメソッドです。<br>
<a href="http://master.tech-camp.in/curriculums/19#term_242">findメソッド</a>がidのカラムに対してのみ検索をかけられるのに対し、 <code>find_byメソッド</code> は検索条件として複数のカラムを指定できるという特徴があります。<br>
今回の例でいうとanswersテーブルから <strong>user_idカラムの値が、引数として渡されている「現在ログインしているユーザーのid」と一致しかつ、question_idカラムの値が「メソッドを呼び出した元の質問のid」と一致する回答</strong>を検索し、取得しています。</p>

<p class="ng-scope"><br><br>
なお「question_id: id」 の id という部分は、self.id の self を省略した形です。</p>

<p class="ng-scope">あるインスタンスメソッド内において、そのインスタンスを利用したインスタンス自身（これをレシーバと言います）を参照する際は <code>self</code> という形で呼び出すことが出来ます。しかしこの self は省略することも可能なため、今回はメソッドを呼び出した質問の id を whereメソッド の引数に追加する際に「question_id: id」とだけ記述しています。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> ユーザーページに答えた質問が追加されたことを確認してみましょう。</h3>

<p class="ng-scope"><img src="add-questions-to-users.png" alt="text"></p>

<p class="ng-scope">無事表示されたことが確認できましたでしょうか。質問に答えるほどプロフィールが充実していくサービスになりました。</p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="555" action="http://master.tech-camp.in/curriculums/149#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-805" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-805" name="check-805" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/views/users/show.html.erbを編集できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-806" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-806" name="check-806" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/models/question.rbを編集できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-807" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-807" name="check-807" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">app/views/users/_question.html.erbを作成・編集できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-808" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-808" name="check-808" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">ユーザーページに答えた質問が追加されたことを確認できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h1 id="17" class="ng-scope">マイページから回答を編集できるようにする</h1>

<p class="ng-scope">さらに機能を追加して、Profyをより良いサービスにしていきましょう。<br>
一度回答した答えを編集する機能を、マイページの中に実装していきます。<br>
目標はマイページの回答一覧から、編集ページに飛んで回答の更新ができるようになることです。</p>

<p class="ng-scope"><img src="user_edit_link.png" alt="マイページから編集画面へのリンク"></p>

<p class="ng-scope">まずはルーティングの設定から始めていきましょう。</p>

<h2 id="18" class="ng-scope">回答の編集画面を作成する</h2>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>config/routes.rb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">config/routes.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">devise_for</span> <span class="ss">:users</span>
  <span class="n">resources</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
  <span class="n">root</span> <span class="ss">to</span><span class="p">:</span> <span class="s2">"top#index"</span>
  <span class="n">resources</span> <span class="ss">:groups</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
  <span class="n">resources</span> <span class="ss">:questions</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:create</span><span class="p">,</span> <span class="ss">:show</span><span class="o">]</span>
<span class="hll">  <span class="n">resources</span> <span class="ss">:answers</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:new</span><span class="p">,</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
</span></pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">editアクションは回答を編集する際に、updateアクションは編集した値でレコードを更新する際に用います。</p>

<p class="ng-scope">機能を追加していく際の流れは <strong>ルーティング</strong> → <strong>コントローラー</strong> → <strong>ビュー</strong> でしたね。<br>
ルーティングの設定が完了したら、次はコントローラーにアクションを定義していきます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/controllers/answers_controller.rb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/answers_controller.rb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">class</span> <span class="nc">AnswersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="n">before_action</span> <span class="ss">:redirect</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="ss">:new</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@question</span> <span class="o">=</span> <span class="no">Question</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:question_id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@answer</span> <span class="o">=</span> <span class="no">Answer</span><span class="o">.</span><span class="n">new</span>
    <span class="vi">@answer</span><span class="o">.</span><span class="n">question_id</span> <span class="o">=</span> <span class="vi">@question</span><span class="o">.</span><span class="n">id</span>
    <span class="k">if</span> <span class="vi">@question</span><span class="o">.</span><span class="n">answers</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="ss">user_id</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
      <span class="n">redirect_to</span> <span class="ss">:root</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@answer</span> <span class="o">=</span> <span class="no">Answer</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">create_params</span><span class="p">)</span>
  <span class="k">end</span>

<span class="hll">  <span class="k">def</span> <span class="nf">edit</span>
</span><span class="hll">    <span class="vi">@answer</span> <span class="o">=</span> <span class="no">Answer</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class="hll">    <span class="vi">@question</span> <span class="o">=</span> <span class="vi">@answer</span><span class="o">.</span><span class="n">question</span>
</span><span class="hll">  <span class="k">end</span>
</span>
<span class="hll">  <span class="k">def</span> <span class="nf">update</span>
</span><span class="hll">    <span class="vi">@answer</span> <span class="o">=</span> <span class="no">Answer</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class="hll">    <span class="vi">@question</span> <span class="o">=</span> <span class="vi">@answer</span><span class="o">.</span><span class="n">question</span>
</span><span class="hll">    <span class="vi">@answer</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">update_params</span><span class="p">)</span>
</span><span class="hll">  <span class="k">end</span>
</span>
<span class="kp">private</span>
  <span class="k">def</span> <span class="nf">create_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:answer</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:text</span><span class="p">,</span> <span class="ss">:question_id</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="ss">user_id</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">redirect</span>
    <span class="k">if</span> <span class="no">Answer</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="ss">question_id</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:question_id</span><span class="o">]</span><span class="p">,</span> <span class="ss">user_id</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
      <span class="n">redirect_to</span> <span class="ss">:root</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="hll">  <span class="k">def</span> <span class="nf">update_params</span>
</span><span class="hll">    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:answer</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:text</span><span class="p">)</span>
</span><span class="hll">  <span class="k">end</span>
</span><span class="k">end</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">実際に回答を編集する画面をつくっていきます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/answers/edit.html.erb</code>を作成してください。</h3>

<ul class="filetree ng-scope">
  <li class="t-folder"> app
    <ul>
      <li class="t-folder"> views
        <ul>
          <li class="t-folder"> answers
            <ul>
              <li class="t-file">edit.html.erb</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/answers/edit.html.erb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/answers/edit.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row form"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-12"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@answer</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;h3&gt;&lt;span&gt;</span>Q<span class="nt">&lt;/span&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@question</span><span class="o">.</span><span class="n">text</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h3&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_area</span> <span class="ss">:text</span><span class="p">,</span> <span class="ss">placeholder</span><span class="p">:</span> <span class="s2">"回答を入力してください"</span><span class="p">,</span> <span class="ss">cols</span><span class="p">:</span><span class="s2">"30"</span><span class="p">,</span> <span class="ss">rows</span><span class="p">:</span><span class="s2">"10"</span><span class="p">,</span> <span class="ss">autofocus</span><span class="p">:</span><span class="s2">"true"</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span><span class="s2">"form-control"</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">"回答する"</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span><span class="s2">"btn btn-primary withripple"</span><span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">これで回答を編集する画面を作成することができました。</p>

<p class="ng-scope">form_forを任意のモデルのインスタンスに対して使用すると、<strong>自動的にレコードの新規作成なのか更新なのかを判断し、<a href="http://master.tech-camp.in/curriculums/16#term_222">HTTPリクエスト</a>を変更してくれます。</strong></p>

<p class="ng-scope">form_forに渡す値が新規のレコードであれば、HTTPリクエストを <code>post</code> として実行し、コントローラーのcreateアクションにルーティングが走りレコードが新規保存されます。</p>

<p class="ng-scope">form_forに渡す値が既存のレコードである場合には、HTTPリクエストを <code>patch</code> として実行し、コントローラーのupdateアクションにルーティングが走ります。<br>
そのために今回は、HTTPメソッドを指定しなくとも入力した情報を送信後、自動でupdateアクションを実行してくれるのです。とても便利ですね！</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/answers/update.html.erb</code>を作成してください。</h3>

<ul class="filetree ng-scope">
  <li class="t-folder"> app
    <ul>
      <li class="t-folder"> views
        <ul>
          <li class="t-folder"> answers
            <ul>
              <li class="t-file">update.html.erb</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 class="ng-scope">
<i class="icon pen"></i> <code>app/views/answers/update.html.erb</code>を以下のように更新してみましょう。</h3>

<div class="code-frame ng-scope" data-lang="rhtml">
<div class="code-lang"><span class="bold">app/views/answers/update.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row form"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-12"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h3&gt;</span>質問「<span class="cp">&lt;%=</span> <span class="vi">@question</span><span class="o">.</span><span class="n">text</span> <span class="cp">%&gt;</span>」への回答を編集しました。<span class="nt">&lt;/h3&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"自分の回答を見る"</span><span class="p">,</span> <span class="n">user_path</span><span class="p">(</span><span class="n">current_user</span><span class="p">)</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"ホームに戻る"</span><span class="p">,</span> <span class="n">root_path</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">これで編集完了後の画面まで用意することができました。最後に、ユーザーページの回答一覧に編集画面へのリンクをつけてあげましょう。</p>

<h2 id="19" class="ng-scope">回答の編集画面へのリンクをマイページに生成する</h2>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題7：条件分岐を利用してマイページだけに編集画面へのリンクを生成しましょう。</h3>

  <h5>作業ファイル：app/views/users/_question.html.erb</h5>
  <h5>ヒント①： いまは全ユーザーのユーザーページにアクセスできてしまうため、マイページを閲覧しているときのみ回答編集画面へのリンクを表示しましょう。</h5>
  <h5>ヒント②： link_to を使用したリンクは相対URLではなくパス名指定にしてあげるとスッキリとします。</h5>

<div class="code-frame" data-lang="html">
<div class="code-lang"><span class="bold">app/views/users/_question.html.erb</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"question_content top_content"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"question_body"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"question_box"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"q"</span><span class="nt">&gt;</span>Q<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"question_text"</span><span class="nt">&gt;</span><span class="err">&lt;</span>%= question.text %&gt;<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"answer_box"</span> <span class="na">style=</span><span class="s">"margin-bottom: 10px;"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"a"</span><span class="nt">&gt;</span>A<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"answer_text"</span><span class="nt">&gt;</span><span class="err">&lt;</span>%= question.user_answer(@user.id).text %&gt;<span class="nt">&lt;/span&gt;</span>
<span class="hll">        <span class="err">&lt;</span>% マイページを見ている場合 %&gt;
</span><span class="hll">          <span class="nt">&lt;small</span> <span class="na">class=</span><span class="s">"edit"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="err">&lt;</span>%= 回答編集画面へのリンクを `link_to` を使って生成しましょう %&gt;
</span><span class="hll">          <span class="nt">&lt;/small&gt;</span>
</span><span class="hll">        <span class="err">&lt;</span>% end %&gt;
</span>      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

  <curriculum-question-container class="ng-scope" data-order="7"><button style="" class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button style="" class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
</div>

<p class="ng-scope">以上で、回答を編集するのに必要な準備はすべて整いました。</p>

<h2 id="20" class="ng-scope">回答を実際に編集してみる</h2>

<h3 class="ng-scope">
<i class="icon pen"></i> マイページから回答が編集できる事を確認してみましょう。</h3>

<p class="ng-scope"><img src="user_edit_link.png" alt="マイページから編集画面へのリンク"></p>

<p class="ng-scope">正しく編集画面へのリンクが表示されたら、実際に編集してみましょう。</p>

<p class="ng-scope"><img src="user_edit_page.png" alt="回答編集画面"></p>

<p class="ng-scope">回答を送信後、以下のように『<strong>質問「（対応する質問名）」への回答を編集しました。</strong>』と表示されたでしょうか。</p>

<p class="ng-scope"><img src="after_edit_page.png" alt="回答編集完了"></p>

<p class="ng-scope">『<strong>自分の回答を見る</strong>』というリンクからまた、マイページに戻る事ができます。</p>

<p class="ng-scope">きちんと編集後の回答が反映されていますね。</p>

<p class="ng-scope"><img src="after_edit_user.png" alt="回答編集後のマイページ"></p>

<p class="ng-scope"><form class="ng-pristine ng-valid ng-scope" data-id="1456" action="http://master.tech-camp.in/curriculums/149#">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-2008" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-2008" name="check-2008" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">editアクション / updateアクションを定義し、回答の保存機能を実装できた</span></label><!-- end ngRepeat: check in checkbox.checks --><label class="ng-scope" for="check-2009" ng-repeat="check in checkbox.checks"><input class="ng-pristine ng-untouched ng-valid" id="check-2009" name="check-2009" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox"><span class="ng-binding" ng-bind-html="check.text">マイページから実際に回答を編集し、情報が更新されることを確認できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>
</div>
          <!-- ngIf: curriculum.short_test -->
        </div>
      </div>
      <div class="col-md-3 col-sm-12" id="curriculumSideContainer">
        <curriculum-side-wrap id="sideWrap">
          <ul style="max-height: 295px;" class="list-group toc-tree" id="curriculumContents">
  <li class="list-group-item disabled">
    目次
  </li>
  <!-- ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding current" id="contents1" ng-click="clickContent(content.h1.id)">開発するタイムラインについて理解する</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents2" ng-click="clickContent(content.h1.id)">質問のタイムラインを作る</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents3" ng-click="clickContent(h2.id)">質問用のモデルを生成し、アソシエーションをそれぞれ定義する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents4" ng-click="clickContent(h2.id)">質問を投稿できるようにする</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents5" ng-click="clickContent(h2.id)">質問をタイムラインに表示する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents6" ng-click="clickContent(content.h1.id)">質問に回答できるようにする</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents7" ng-click="clickContent(h2.id)">回答用のモデルを生成する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents8" ng-click="clickContent(h2.id)">質問に回答ボタンをつける</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents9" ng-click="clickContent(h2.id)">回答ページを作成する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents10" ng-click="clickContent(h2.id)">回答を投稿できるようにする</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents11" ng-click="clickContent(content.h1.id)">一問一答形式にする</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents12" ng-click="clickContent(h2.id)">未回答の質問にのみ「回答する」ボタンが表示されるようにする</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents13" ng-click="clickContent(h2.id)">コントローラーにリダイレクトを設定する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents14" ng-click="clickContent(content.h1.id)">回答を閲覧できるようにする</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents15" ng-click="clickContent(h2.id)">個別質問ページで回答を閲覧できるようにする</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents16" ng-click="clickContent(h2.id)">ユーザーページで回答済みの質問を閲覧できるようにしよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li class="ng-scope" ng-repeat="content in contents">
    <a class="content-link ng-binding" id="contents17" ng-click="clickContent(content.h1.id)">マイページから回答を編集できるようにする</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents18" ng-click="clickContent(h2.id)">回答の編集画面を作成する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents19" ng-click="clickContent(h2.id)">回答の編集画面へのリンクをマイページに生成する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li class="ng-scope" ng-repeat="h2 in content.h2 track by $index">
        <a class="content-link ng-binding" id="contents20" ng-click="clickContent(h2.id)">回答を実際に編集してみる</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents -->
</ul>
          <div style="" ng-show="check_count > 0" class="progress_box ng-scope">
  <!-- ngIf: showTroubleShooting() --><p class="terms ng-scope" ng-if="showTroubleShooting()">
    エラーが解決できない時：<br><a href="http://master.tech-camp.in/curriculums/25" target="_brank">トラブルシューティング</a>
  </p><!-- end ngIf: showTroubleShooting() -->
  <!-- ngIf: courseId != 9 && courseId != 10 --><p class="terms ng-scope" ng-if="courseId != 9 &amp;&amp; courseId != 10">
    分からない用語がある時：<br><a href="http://master.tech-camp.in/terms" target="_brank">用語一覧集</a>
  </p><!-- end ngIf: courseId != 9 && courseId != 10 -->
  <h4>
    進捗度<i class="ng-binding" id="numerator">0 / 43<span id="denominaotr"></span></i>
  </h4>
  <div class="progress">
    <div aria-valuemax="100" aria-valuemin="0" aria-valuenow="0" class="pregress-bar progress-bar-info ng-binding" role="progressbar" style="width: 0%;">
      0%
    </div>
  </div>
</div>
          <curriculum-glossary class="ng-hide" ng-show="curriculum.curriculum_type == 2 || curriculum.curriculum_type == 3"></curriculum-glossary>
          <button class="curriculum-report-button" ng-click="show_curriculum_report()">
            <img src="idea.svg" height="20px" width="20px">
            | このカリキュラムへのご要望
          </button>
        </curriculum-side-wrap>
      </div>
    </div>
    <ul style="" class="pager" ng-hide="loading">
  <li class="previous">
    <a style="" class="" ng-click="go_previous()" ng-show="curriculum.previous_id">前のカリキュラム</a>
  </li>
  <li class="next">
    <a style="" class="" ng-class="{ disable: curriculum.short_test.can_see_next_curriculum == false }" ng-click="go_next()" ng-show="curriculum.next_id">次のカリキュラム</a>
  </li>
</ul>
  </div>
</curriculum>
<div style="" class="ng-scope ng-isolate-scope ng-hide" id="loading" ng-show="loading">
  <svg height="44" stroke="#444" viewBox="0 0 44 44" width="44" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" strole-width="2"><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="0s" calcMode="spline" dur="1.8s" keySplines="0.165, 0.84, 0.44, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 20"></animate><animate attributeName="stroke-opacity" begin="0s" calcMode="spline" dur="1.8s" keySplines="0.3, 0.61, 0.355, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 0"></animate></circle><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="-0.9s" calcMode="spline" dur="1.8s" keySplines="0.165, 0.84, 0.44, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 20"></animate><animate attributeName="stroke-opacity" begin="-0.9s" calcMode="spline" dur="1.8s" keySplines="0.3, 0.61, 0.355, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 0"></animate></circle></g></svg>
</div>

<div class="curriculum-image__modal modal ng-scope" id="curriculum-image__modal" role="dialog" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button class="close" data-dismiss="modal" ng-click="close()"><span aria-hidden="true">×</span></button>
      </div>
      <div class="modal-body">
        <div class="curriculum-image__img__body">
          <img class="curriculum-image__img zoom-out" id="curriculum-image__img">
        </div>
      </div>
    </div>
  </div>
</div>


</div><div class="chat-window ng-scope" ng-controller="SupportChatController" ng-init="init('大宅誠人', '/uploads/noimage.png', 1867, 2988, 0, 'accepted_questions', 'machi4271', '2')"><div aria-hidden="true" aria-labelledby="myLargeModalLabel" class="modal fade" id="chats-modal" role="dialog" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="wrapper">
  <header class="chat-header">
    <div class="row">
      <div class="col-md-6 col-xs-12 chat-header-left">
        <h2>
          質問チャット
        </h2>
        <div class="chat-support-state active in-support ng-binding">
          <img src="icn_qsupport.png" width="16">質問受付中
        </div>
      </div>
    </div>
  </header>
  <div class="chat-layout" load-more="load-more">
    <!-- ngRepeat: message in messages -->
  </div>
</div><footer class="chat-footer"><form accept-charset="UTF-8" action="http://master.tech-camp.in/api/chat_messages" class="new_chat_message ng-pristine ng-valid" data-remote="true" enctype="multipart/form-data" id="new_chat_message" method="post" ng_submit="afterSubmitted()"><div style="display: none;"><input name="utf8" value="✓" type="hidden"></div><input id="chat_message_chat_id" name="chat_message[chat_id]" value="2988" type="hidden"><div class="chat-box"><div class="row"><div class="chat-upload col-xs-1"><div class="chat-upload-btn"><img class="chat-upload-icn" src="icn_fileupload.png"><input class="ng-pristine ng-untouched ng-valid" id="chat_message_file" name="chat_message[file]" ng_model="file" onchange="angular.element(this).scope().showSubmitButtonAndHideSkypeButtonAndPreview()" type="file"><div class="chat-uploading-image ng-hide" ng-show="isUploading" ng-style="isUploadingStyle"><div class="image_del ng-hide" ng-click="clearImage()" ng-show="imageDeletable"><img alt="close" src="icon_close_red.svg"></div></div></div></div><div class="chat-textarea col-xs-8"><textarea class="form-control ng-pristine ng-untouched ng-valid" id="chat_message_content" name="chat_message[content]" ng_model="content" placeholder="次のコードの意味がよくわからないので教えていただけないでしょうか？" row="3"></textarea></div><div class="chat-submit col-xs-3"><input style="display: none;" class="submit-btn" id="submit_chat_message" name="commit" value="送信" type="submit"><div class="skype-popup"><a title="" data-original-title="" class="trigger btn btn-default" href="#">Skypeで直接聞く</a><div class="head hide">Skype質問を申請すると<br>担当メンターから着信が届きます。<br>以下の項目をご確認ください。</div><div class="content hide"><p class="ng-binding">あなたのSkypeID:　machi4271<br>質問箇所: <small>※スマートフォン、タブレットでのSkypeはご遠慮ください<br>※通話が始まったらすぐに画面共有をお願いします</small></p><a class="skype-support" href="http://master.tech-camp.in/curriculums/149">Skype質問を申請する</a><div class="close">×</div></div></div></div></div></div></form></footer></div></div></div><div class="chat-dock" ng-click="getMessages(); showModal()">質問サポート<!-- ngIf: unreadSize != 0 --><span class="dock-support-state_text in-support ng-binding"><img class="icn_qsupport" src="icn_qsupport_white.png" width="10">質問受付中</span></div></div></body>
</html>
